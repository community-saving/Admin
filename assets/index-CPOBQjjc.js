import{o as Ce}from"./rolldown-runtime-O3PcEg2i.js";import{a as Le,c as Ae,d as Nt,i as Pe,l as Ee,n as Je,o as Fe,r as Ue,s as Be,t as wt}from"./charting-BTEZ5LFh.js";import{t as vt}from"./react-dom-B_yxW9B6.js";import{a as oe,c as Ie,i as St,n as Re,o as Dt,r as et,s as Ct,t as kt}from"./react-router-DN1Q4BFP.js";import{_ as Lt,a as ge,b as At,c as ie,d as he,f as tt,g as Pt,h as Et,i as Ve,l as ce,m as xe,n as X,o as Ft,p as me,r as re,s as Ut,t as Tt,u as te,v as It,y as Rt}from"./firebase-CyM-FwhB.js";import{a as Mt,c as zt,i as $t,l as Yt,n as Ot,o as _t,r as Bt,s as Vt,t as Wt,u as qt}from"./react-CbSgh8yl.js";import{C as Gt,E as Kt,S as Zt,T as Ht,_ as ve,a as ye,b as Te,c as Qt,d as Xt,f as st,g as Se,h as at,i as Jt,l as We,m as Me,n as es,o as ts,p as ss,r as rt,s as as,t as De,u as rs,v as nt,w as ns,x as is,y as fe}from"./lucide-icons-Bp_f-v-j.js";import{Bt as it,Ft as ls,Ht as os,It as ds,Lt as cs,Rt as ms,Vt as xs,zt as us}from"./vendor-C04N904u.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))h(f);new MutationObserver(f=>{for(const x of f)if(x.type==="childList")for(const b of x.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&h(b)}).observe(document,{childList:!0,subtree:!0});function a(f){const x={};return f.integrity&&(x.integrity=f.integrity),f.referrerPolicy&&(x.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?x.credentials="include":f.crossOrigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function h(f){if(f.ep)return;f.ep=!0;const x=a(f);fetch(f.href,x)}})();var hs=Ce(vt()),t=Ce(Nt()),lt=At({apiKey:"AIzaSyAGm3bzsCxYSARcgVn41ta_EOut9fauWr0",authDomain:"ecommerce-74229.firebaseapp.com",projectId:"ecommerce-74229",storageBucket:"ecommerce-74229.firebasestorage.app",messagingSenderId:"47160479095",appId:"1:47160479095:web:0dd3a844d5d5c3847ea572",measurementId:"G-47FYXTR59Z"}),we=Pt(lt),U=Ft(lt),e=Ce(qt()),ot=(0,t.createContext)();const ue=()=>(0,t.useContext)(ot),gs=({children:s})=>{const[l,a]=(0,t.useState)(null),[h,f]=(0,t.useState)(!0),x=(m,g)=>Et(we,m,g),b=(m,g)=>It(we,m,g),u=()=>Rt(we);(0,t.useEffect)(()=>Lt(we,m=>{a(m),f(!1)}),[]);const C={currentUser:l,signup:x,login:b,logout:u};return(0,e.jsx)(ot.Provider,{value:C,children:h?(0,e.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):s})};function ps(){const s=(0,t.useRef)(),l=(0,t.useRef)(),{login:a}=ue(),h=Ie(),[f,x]=(0,t.useState)(""),[b,u]=(0,t.useState)(!1),C=async m=>{m.preventDefault();try{x(""),u(!0),await a(s.current.value,l.current.value),h("/dashboard")}catch{x("Failed to sign in. Please check your credentials and try again.")}u(!1)};return(0,e.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-400 to-gray-100 p-4",children:(0,e.jsx)("div",{className:"w-full max-w-md",children:(0,e.jsxs)("form",{onSubmit:C,className:"bg-white p-8 rounded-2xl shadow-lg border border-gray-100",children:[(0,e.jsxs)("div",{className:"text-center mb-8",children:[(0,e.jsx)("div",{className:"mx-auto w-16 h-16 bg-indigo-600 rounded-full flex items-center justify-center mb-4",children:(0,e.jsx)("span",{className:"text-white font-bold text-xl",children:"MB"})}),(0,e.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Welcome Back"}),(0,e.jsx)("p",{className:"text-gray-600 mt-2",children:"Sign in to your account"})]}),f&&(0,e.jsx)("div",{className:"bg-red-50 text-red-700 p-3 rounded-lg mb-6 text-sm",children:f}),(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,e.jsx)("input",{type:"email",id:"email",ref:s,placeholder:"Enter your email",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,e.jsx)("input",{type:"password",id:"password",ref:l,placeholder:"Enter your password",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,e.jsx)("button",{disabled:b,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white p-2 rounded-lg transition-colors duration-200 disabled:opacity-50",children:b?"Signing In...":"Sign In"}),(0,e.jsxs)("p",{className:"mt-6 text-center text-gray-600",children:["Don't have an account?"," ",(0,e.jsx)(Re,{to:"/signup",className:"text-indigo-600 hover:text-indigo-800 font-medium",children:"Sign Up"})]})]})})})}function fs(){const s=(0,t.useRef)(),l=(0,t.useRef)(),a=(0,t.useRef)(),{signup:h}=ue(),f=Ie(),[x,b]=(0,t.useState)(""),[u,C]=(0,t.useState)(!1),m=async g=>{if(g.preventDefault(),l.current.value!==a.current.value)return b("Passwords do not match");if(l.current.value.length<6)return b("Password should be at least 6 characters");try{b(""),C(!0),await h(s.current.value,l.current.value),f("/dashboard")}catch{b("Failed to create an account. Please try again.")}C(!1)};return(0,e.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-400 to-gray-100 p-4",children:(0,e.jsx)("div",{className:"w-full max-w-md",children:(0,e.jsxs)("form",{onSubmit:m,className:"bg-white p-8 rounded-2xl shadow-lg border border-gray-100",children:[(0,e.jsxs)("div",{className:"text-center mb-8",children:[(0,e.jsx)("div",{className:"mx-auto w-16 h-16 bg-indigo-600 rounded-full flex items-center justify-center mb-4",children:(0,e.jsx)("span",{className:"text-white font-bold text-xl",children:"MB"})}),(0,e.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Create Account"}),(0,e.jsx)("p",{className:"text-gray-600 mt-2",children:"Sign up to get started"})]}),x&&(0,e.jsx)("div",{className:"bg-red-50 text-red-700 p-3 rounded-lg mb-6 text-sm",children:x}),(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,e.jsx)("input",{type:"email",id:"email",ref:s,placeholder:"Enter your email",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,e.jsx)("input",{type:"password",id:"password",ref:l,placeholder:"Create a password",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm Password"}),(0,e.jsx)("input",{type:"password",id:"confirmPassword",ref:a,placeholder:"Confirm your password",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,e.jsx)("button",{disabled:u,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white p-2 rounded-lg transition-colors duration-200 disabled:opacity-50",children:u?"Creating Account...":"Sign Up"}),(0,e.jsxs)("p",{className:"mt-6 text-center text-gray-600",children:["Already have an account?"," ",(0,e.jsx)(Re,{to:"/login",className:"text-indigo-600 hover:text-indigo-800 font-medium",children:"Sign In"})]})]})})})}var ys=()=>(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{children:[(0,e.jsx)("h1",{children:"Create your porfile"}),(0,e.jsxs)("form",{action:"",children:[(0,e.jsx)("input",{type:"text",placeholder:"Your full name "}),(0,e.jsx)("input",{type:"email",placeholder:"Your email",name:"",id:""}),(0,e.jsx)("input",{type:"number",placeholder:"You phone number ",name:"",id:""}),(0,e.jsx)("input",{type:"number",placeholder:"You Age  ",name:"",id:""}),(0,e.jsxs)("option",{value:"",children:[(0,e.jsx)("select",{name:"male",id:"",children:"Male"}),(0,e.jsx)("select",{name:"female",id:"",children:"Female"})]}),(0,e.jsx)("input",{type:"file",placeholder:"Upload your photo"}),(0,e.jsx)("button",{type:"submit",children:"Create account"})]})]})}),js=ys,bs=()=>{const[s,l]=(0,t.useState)(0),[a,h]=(0,t.useState)(0),[f,x]=(0,t.useState)(0),[b,u]=(0,t.useState)(0),[C,m]=(0,t.useState)(!1),[g,F]=(0,t.useState)(!1),[P,N]=(0,t.useState)(!1),[T,I]=(0,t.useState)([]),[w,c]=(0,t.useState)([]),[S,v]=(0,t.useState)([]),[R,_]=(0,t.useState)(!0),[E,$]=(0,t.useState)({width:window.innerWidth,height:window.innerHeight});(0,t.useEffect)(()=>{const d=()=>{$({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",d),()=>window.removeEventListener("resize",d)},[]);const o=d=>new Date(d).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",hour12:!0});(0,t.useEffect)(()=>{if(!U){N("Firestore instance not available"),_(!1);return}const d=te(X(U,"users"),ce("createdAt","desc")),z=ie(d,B=>{try{const W=B.docs.map(V=>({id:V.id,...V.data()}));v(W),u(W.length),_(!1),N(!1)}catch(W){console.error("Error processing users snapshot:",W),N("Failed to process users data"),_(!1)}},B=>{console.error("Error fetching users:",B),B.code==="permission-denied"?N("Permission denied. Check Firestore rules."):N("Failed to load users: "+(B.message||"Unknown error")),_(!1)});return()=>z()},[]);const L=({active:d,payload:z,label:B})=>{if(d&&z&&z.length){const W=z[0].payload,V=E.width<768;return(0,e.jsxs)("div",{className:`bg-white border border-gray-200 shadow-lg rounded-md ${V?"p-2":"p-4"}`,children:[(0,e.jsx)("p",{className:`font-medium text-gray-900 ${V?"text-xs":"text-sm"}`,children:o(W.timestamp)}),(0,e.jsxs)("p",{className:`text-indigo-600 ${V?"text-xs":"text-sm"}`,children:["Deposits: $",W.deposits.toFixed(2)]}),(0,e.jsxs)("p",{className:`text-red-600 ${V?"text-xs":"text-sm"}`,children:["loans: $",W.loans.toFixed(2)]})]})}return null},i=(d,z,B=20)=>{const W=[];return d.forEach(V=>{const r=V.timestamp?.toDate?.()||new Date(V.timestamp);W.push({timestamp:r,name:r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),deposits:Number(V.amount)||0,loans:0})}),z.forEach(V=>{const r=V.timestamp?.toDate?.()||new Date(V.timestamp);W.push({timestamp:r,name:r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),deposits:0,loans:Number(V.amount)||0})}),W.sort((V,r)=>V.timestamp-r.timestamp),W.slice(-B)};(0,t.useEffect)(()=>{if(!U){console.error("Firestore database instance not available"),m(!0),F(!0);return}let d=[],z=[];const B=te(X(U,"deposits"),ce("timestamp","desc")),W=ie(B,Y=>{try{let M=0;d=[],Y.forEach(G=>{const se=G.data();se.amount&&(M+=parseFloat(se.amount)),d.push({id:G.id,...se,timestamp:se.timestamp})}),l(M),m(!1);const J=i(d,z);I(J),c(G=>[...d.slice(0,3).map(se=>({id:se.id,type:"deposit",userId:se.userId,amount:se.amount,timestamp:se.timestamp?.toDate?.()||new Date})),...G].slice(0,6))}catch(M){console.error("Error processing deposits data:",M),m(!0)}},Y=>{console.error("Error fetching deposits:",Y),m(!0)}),V=te(X(U,"loans"),ce("timestamp","desc")),r=ie(V,Y=>{try{let M=0,J=0;z=[],Y.forEach(se=>{const le=se.data();le.amount&&(M+=parseFloat(le.amount)),le.status==="pending"&&(J+=1),z.push({id:se.id,...le,timestamp:le.timestamp})}),h(M),x(J),F(!1);const G=i(d,z);I(G),c(se=>[...z.slice(0,3).map(le=>({id:le.id,type:"cashout",userId:le.userId,amount:le.amount,status:le.status,timestamp:le.timestamp?.toDate?.()||new Date})),...se].slice(0,6))}catch(M){console.error("Error processing loans data:",M),F(!0)}},Y=>{console.error("Error fetching loans:",Y),F(!0)});return()=>{W(),r()}},[]);const j=d=>`$${d.toFixed(2)}`,k=d=>new Date(d).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),D=[{id:1,name:"Total Deposits",value:C?"N/A":j(s),change:"+12.5%",changeType:"positive",icon:Se,iconColor:"bg-indigo-500"},{id:2,name:"Total loans",value:g?"N/A":j(a),change:"+8.2%",changeType:"positive",icon:ve,iconColor:"bg-red-500"},{id:3,name:"Pending loans",value:g?"N/A":f,change:"+3.1%",changeType:"negative",icon:Kt,iconColor:"bg-yellow-500"},{id:4,name:"Total Users",value:P?"N/A":b,change:"+5.4%",changeType:"positive",icon:rt,iconColor:"bg-green-500"}],p=(()=>{const d=E.width<768,z=E.width>=768&&E.width<1024;return{margin:{top:d?5:10,right:d?10:30,left:d?5:20,bottom:d?10:5},tickFontSize:d?8:z?10:12,interval:d?"preserveStartEnd":0,minTickGap:d?10:15,barSize:d?10:15,animationDuration:d?500:800,gridStrokeDasharray:d?"2 2":"3 3"}})();return R?(0,e.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading dashboard..."})]})}):(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6",children:D.map(d=>(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-4 sm:p-6 transition-all duration-200 hover:shadow-md",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-xs sm:text-sm font-medium text-gray-500",children:d.name}),(0,e.jsx)("p",{className:"mt-1 sm:mt-2 text-2xl sm:text-3xl font-bold text-gray-900",children:d.value})]}),(0,e.jsx)("div",{className:`p-2 sm:p-3 rounded-full ${d.iconColor}`,children:(0,e.jsx)(d.icon,{className:"h-5 w-5 sm:h-6 sm:w-6 text-white"})})]}),(0,e.jsxs)("div",{className:"mt-3 sm:mt-4 flex items-center",children:[d.changeType==="positive"?(0,e.jsx)(ns,{className:"h-3 w-3 sm:h-4 sm:w-4 text-green-500"}):(0,e.jsx)(Ht,{className:"h-3 w-3 sm:h-4 sm:w-4 text-red-500"}),(0,e.jsx)("span",{className:`ml-1 text-xs sm:text-sm font-medium ${d.changeType==="positive"?"text-green-500":"text-red-500"}`,children:d.change}),(0,e.jsx)("span",{className:"ml-1 sm:ml-2 text-xs sm:text-sm text-gray-500",children:"from last month"})]})]},d.id))}),(0,e.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-4 sm:p-6",children:[(0,e.jsx)("h3",{className:"text-base sm:text-lg font-medium text-gray-900 mb-3 sm:mb-4",children:"Live Transactions"}),(0,e.jsx)("div",{className:"h-64 sm:h-80 overflow-x-auto",children:(0,e.jsx)(Ee,{width:"100%",height:"100%",minWidth:300,children:(0,e.jsxs)(wt,{data:T,margin:p.margin,children:[(0,e.jsx)(Fe,{strokeDasharray:p.gridStrokeDasharray}),(0,e.jsx)(Pe,{dataKey:"name",tick:{fontSize:p.tickFontSize},interval:p.interval,minTickGap:p.minTickGap}),(0,e.jsx)(Ue,{tick:{fontSize:p.tickFontSize}}),(0,e.jsx)(Ae,{content:(0,e.jsx)(L,{})}),(0,e.jsx)(Be,{dataKey:"deposits",fill:"#4f46e5",name:"Deposits",barSize:p.barSize,isAnimationActive:!0,animationDuration:p.animationDuration,animationEasing:"ease-in-out"}),(0,e.jsx)(Be,{dataKey:"loans",fill:"#ef4444",name:"loans",barSize:p.barSize,isAnimationActive:!0,animationDuration:p.animationDuration,animationEasing:"ease-in-out"})]})})})]}),(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-4 sm:p-6",children:[(0,e.jsx)("h3",{className:"text-base sm:text-lg font-medium text-gray-900 mb-3 sm:mb-4",children:"Transaction Trend"}),(0,e.jsx)("div",{className:"h-64 sm:h-80 overflow-x-auto",children:(0,e.jsx)(Ee,{width:"100%",height:"100%",minWidth:300,children:(0,e.jsxs)(Je,{data:T,margin:p.margin,children:[(0,e.jsx)(Fe,{strokeDasharray:p.gridStrokeDasharray}),(0,e.jsx)(Pe,{dataKey:"name",tick:{fontSize:p.tickFontSize},interval:p.interval,minTickGap:p.minTickGap}),(0,e.jsx)(Ue,{tick:{fontSize:p.tickFontSize}}),(0,e.jsx)(Ae,{content:(0,e.jsx)(L,{})}),(0,e.jsx)(Le,{type:"monotone",dataKey:"deposits",stroke:"#4f46e5",activeDot:{r:E.width<768?4:8},name:"Deposits",strokeWidth:E.width<768?1.5:2,isAnimationActive:!0,animationDuration:p.animationDuration,animationEasing:"ease-in-out"}),(0,e.jsx)(Le,{type:"monotone",dataKey:"loans",stroke:"#ef4444",name:"loans",strokeWidth:E.width<768?1.5:2,isAnimationActive:!0,animationDuration:p.animationDuration,animationEasing:"ease-in-out"})]})})})]})]}),(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-4 sm:p-6",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:[(0,e.jsx)("h3",{className:"text-base sm:text-lg font-medium text-gray-900",children:"Recent Activity"}),(0,e.jsx)("button",{className:"text-sm font-medium text-indigo-600 hover:text-indigo-800",children:"View all"})]}),(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{scope:"col",className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),(0,e.jsx)("th",{scope:"col",className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User ID"}),(0,e.jsx)("th",{scope:"col",className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,e.jsx)("th",{scope:"col",className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{scope:"col",className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:w.length>0?w.map(d=>(0,e.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[(0,e.jsx)("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap",children:(0,e.jsxs)("div",{className:"flex items-center",children:[d.type==="deposit"?(0,e.jsx)("div",{className:"w-6 h-6 sm:w-8 sm:h-8 rounded-full bg-indigo-100 flex items-center justify-center",children:(0,e.jsx)(Se,{className:"h-3 w-3 sm:h-4 sm:w-4 text-indigo-600"})}):(0,e.jsx)("div",{className:"w-6 h-6 sm:w-8 sm:h-8 rounded-full bg-red-100 flex items-center justify-center",children:(0,e.jsx)(ve,{className:"h-3 w-3 sm:h-4 sm:w-4 text-red-600"})}),(0,e.jsx)("span",{className:"ml-2 sm:ml-3 text-xs sm:text-sm font-medium text-gray-900 capitalize",children:d.type})]})}),(0,e.jsx)("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500",children:d.userId||"N/A"}),(0,e.jsx)("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm font-medium text-gray-900",children:j(d.amount||0)}),(0,e.jsx)("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap",children:d.type==="deposit"?(0,e.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800",children:"Completed"}):(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${d.status==="Pending"?"bg-yellow-100 text-yellow-800":d.status==="Accepted"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:d.status||"Pending"})}),(0,e.jsx)("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500",children:k(d.timestamp)})]},d.id)):(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:"5",className:"px-3 sm:px-6 py-3 sm:py-4 text-center text-xs sm:text-sm text-gray-500",children:"No recent activity"})})})]})})]})]})},qe=bs,Ns=()=>{const{currentUser:s}=ue(),[l,a]=(0,t.useState)([]),[h,f]=(0,t.useState)([]),[x,b]=(0,t.useState)(!0),[u,C]=(0,t.useState)(null),[m,g]=(0,t.useState)(""),[F,P]=(0,t.useState)(null),[N,T]=(0,t.useState)(!1),[I,w]=(0,t.useState)(new Set);(0,t.useEffect)(()=>{if(!s)return;const i=ie(X(U,"users"),j=>{const k=[];j.forEach(D=>{k.push({id:D.id,...D.data()})}),f(k)},j=>{console.error("Error fetching users:",j)});return()=>i()},[s]),(0,t.useEffect)(()=>{if(!s)return;const i=ie(X(U,"loans"),j=>{const k=[];j.forEach(D=>{k.push({id:D.id,...D.data()})}),k.sort((D,n)=>{const p=D.paymentTimestamp?.toDate?.()||new Date(0);return(n.paymentTimestamp?.toDate?.()||new Date(0))-p}),a(k),b(!1)},j=>{console.error("Error fetching paybacks:",j),b(!1)});return()=>i()},[s]);const c=l.map(i=>{const j=h.find(k=>k.uid===i.userId);return{...i,userName:j?.fullName||"Unknown User",userEmail:j?.email||"No email provided"}}),S=(i,j)=>{C({message:i,type:j}),setTimeout(()=>{C(null)},3e3)},v=async i=>{try{w(j=>new Set(j).add(i)),setTimeout(async()=>{const j=re(U,"loans",i);await me(j,{paymentStatus:"approved",adminReviewedAt:he()}),setTimeout(()=>{w(k=>{const D=new Set(k);return D.delete(i),D})},300),S("Payment approved successfully!","success")},100)}catch(j){console.error("Error approving payment:",j),S("Failed to approve payment. Please try again.","error"),w(k=>{const D=new Set(k);return D.delete(i),D})}},R=async i=>{try{w(j=>new Set(j).add(i)),setTimeout(async()=>{const j=re(U,"loans",i);await me(j,{paymentStatus:"denied",adminReviewedAt:he()}),setTimeout(()=>{w(k=>{const D=new Set(k);return D.delete(i),D})},300),S("Payment denied.","error")},100)}catch(j){console.error("Error denying payment:",j),S("Failed to deny payment. Please try again.","error"),w(k=>{const D=new Set(k);return D.delete(i),D})}},_=i=>{P(i),T(!0)},E=()=>{T(!1),P(null)},$=i=>{if(!i)return"N/A";const j=i.toDate(),k=j.getDate().toString().padStart(2,"0"),D=(j.getMonth()+1).toString().padStart(2,"0"),n=j.getFullYear(),p=j.getHours().toString().padStart(2,"0"),d=j.getMinutes().toString().padStart(2,"0");return`${k}/${D}/${n} ${p}:${d}`},o=c.filter(i=>{if(i.status!=="accepted")return!1;const j=i.userName||"",k=m.toLowerCase();return j.toLowerCase().includes(k)}),L=c.filter(i=>i.status==="accepted"&&i.paymentStatus==="pending").length;return(0,e.jsxs)("div",{className:"min-h-screen bg-gray-50 py-8",children:[u&&(0,e.jsx)("div",{className:`fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-lg transform transition-all duration-300 ${u.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:u.message}),(0,e.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,e.jsxs)("div",{className:"mb-8",children:[(0,e.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Loan Repayment Management"}),(0,e.jsx)("p",{className:"mt-2 text-gray-600",children:"Review and manage loan repayments for accepted loans"})]}),(0,e.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6 mb-6",children:(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,e.jsx)(ye,{className:"h-5 w-5 text-gray-400"})}),(0,e.jsx)("input",{type:"text",placeholder:"Search by user name...",value:m,onChange:i=>g(i.target.value),className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]})}),(0,e.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[(0,e.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,e.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Accepted Loan Repayments"}),(0,e.jsxs)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800",children:[L," pending"]})]}),x?(0,e.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mb-4"}),(0,e.jsx)("p",{className:"text-gray-600",children:"Loading loan repayments..."})]}):o.length===0?(0,e.jsxs)("div",{className:"text-center py-12",children:[(0,e.jsx)("div",{className:"mx-auto h-16 w-16 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:(0,e.jsx)(ye,{className:"h-8 w-8 text-gray-400"})}),(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No accepted loans found"}),(0,e.jsx)("p",{className:"text-gray-500",children:"There are no accepted loans at the moment."})]}):(0,e.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:o.map(i=>{const j=I.has(i.id),k=!i.paymentStatus||i.paymentStatus==="pending";return(0,e.jsx)("div",{className:`bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden transition-all duration-300 hover:shadow-md ${j?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:(0,e.jsxs)("div",{className:"p-6",children:[(0,e.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-indigo-100 flex items-center justify-center",children:(0,e.jsx)("span",{className:"text-indigo-800 font-medium",children:i.userName?.charAt(0)?.toUpperCase()||"U"})}),(0,e.jsxs)("div",{className:"ml-3",children:[(0,e.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:i.userName||"Unknown User"}),(0,e.jsx)("p",{className:"text-sm text-gray-500",children:i.userEmail||"No email provided"})]})]}),(0,e.jsx)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                            ${i.paymentStatus==="approved"?"bg-green-100 text-green-800":i.paymentStatus==="denied"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:i.paymentStatus?.charAt(0)?.toUpperCase()+i.paymentStatus?.slice(1)||"Pending"})]}),(0,e.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Loan Amount"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",i.amount]})]}),(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Interest (10%)"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",(i.amount*.1).toFixed(2)]})]}),(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Total Payable"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",i.totalPayable?.toFixed(2)||(i.amount*1.1).toFixed(2)]})]}),(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Paid Amount"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",i.paidAmount]})]}),(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Payment Date"}),(0,e.jsx)("span",{className:"text-sm font-medium text-gray-900",children:$(i.paymentTimestamp)})]}),i.adminReviewedAt&&(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Reviewed At"}),(0,e.jsx)("span",{className:"text-sm font-medium text-gray-900",children:$(i.adminReviewedAt)})]})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("span",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Proof of Payment"}),i.proofImageUrl?(0,e.jsxs)("div",{className:"relative w-full h-32 rounded-lg overflow-hidden cursor-pointer border border-gray-200",onClick:()=>_(i.proofImageUrl),children:[(0,e.jsx)("img",{src:i.proofImageUrl,alt:"Proof of payment",className:"w-full h-full object-cover"}),(0,e.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity",children:(0,e.jsx)(Me,{className:"h-6 w-6 text-white"})})]}):(0,e.jsx)("div",{className:"w-full h-32 rounded-lg bg-gray-100 flex items-center justify-center border border-gray-200",children:(0,e.jsx)("span",{className:"text-gray-500 text-sm",children:"No proof provided"})})]}),(0,e.jsxs)("div",{className:"flex space-x-3",children:[(0,e.jsxs)("button",{className:`flex-1 inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg transition-colors ${k?"text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500":"text-gray-400 bg-gray-100 cursor-not-allowed"}`,onClick:()=>v(i.id),disabled:!k,children:[(0,e.jsx)(is,{className:"-ml-1 mr-2 h-4 w-4"}),"Approve"]}),(0,e.jsxs)("button",{className:`flex-1 inline-flex items-center justify-center px-4 py-2 border text-sm font-medium rounded-lg transition-colors ${k?"text-gray-700 bg-white border-gray-300 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500":"text-gray-400 bg-gray-100 border-gray-200 cursor-not-allowed"}`,onClick:()=>R(i.id),disabled:!k,children:[(0,e.jsx)(De,{className:"-ml-1 mr-2 h-4 w-4"}),"Deny"]})]})]})},i.id)})})]})]}),N&&(0,e.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",onClick:E,children:(0,e.jsxs)("div",{className:"relative max-w-4xl max-h-full",onClick:i=>i.stopPropagation(),children:[(0,e.jsx)("button",{className:"absolute -top-12 right-0 text-white hover:text-gray-300 focus:outline-none",onClick:E,children:(0,e.jsx)(De,{className:"h-8 w-8"})}),(0,e.jsx)("img",{src:F,alt:"Proof of payment",className:"max-w-full max-h-screen rounded-lg"})]})})]})},ws=Ns,vs=()=>{const[s,l]=(0,t.useState)([]),[a,h]=(0,t.useState)([]),[f,x]=(0,t.useState)(!0),[b,u]=(0,t.useState)(null),[C,m]=(0,t.useState)(""),[g,F]=(0,t.useState)("All"),[P,N]=(0,t.useState)(null),[T,I]=(0,t.useState)(!1),[w,c]=(0,t.useState)({});(0,t.useEffect)(()=>{const n=te(X(U,"users")),p=ie(n,d=>{const z=d.docs.map(B=>({id:B.id,...B.data()}));h(z)},d=>{console.error("Error loading users:",d),u("Failed to load users: "+d.message)});return()=>p()},[]),(0,t.useEffect)(()=>{const n=te(X(U,"deposits"),ce("timestamp","desc")),p=ie(n,d=>{try{const z=d.docs.map(B=>({id:B.id,...B.data()})).map(B=>{const W=a.find(V=>V.uid===B.userId);return{...B,userName:W?W.fullName||"Unnamed User":"Unknown User"}});l(z),x(!1)}catch(z){console.error("Error merging deposit data:",z),u("Error processing deposit data: "+z.message),x(!1)}},d=>{console.error("Firestore error:",d),u("Failed to load deposits: "+d.message),x(!1)});return()=>p()},[a]);const S=n=>{switch(n){case"accepted":return"bg-green-100 text-green-800";case"denied":return"bg-red-100 text-red-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},v=async(n,p)=>{try{const d=re(U,"deposits",n);await me(d,{status:p}),console.log(`Deposit ${n} status updated to ${p}`)}catch(d){console.error("Error updating deposit status:",d),u("Failed to update deposit status: "+d.message)}},R=n=>{if(!n)return"N/A";if(n.seconds){const p=new Date(n.seconds*1e3);return p.toLocaleDateString()+" "+p.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}if(n.toDate){const p=n.toDate();return p.toLocaleDateString()+" "+p.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}return n.toString()},_=s.reduce((n,p)=>n+(parseFloat(p.amount)||0),0),E=s.filter(n=>n.status==="pending").length,$=s.filter(n=>n.status==="accepted").length,o=s.filter(n=>n.status==="denied").length,L=s.filter(n=>n.status==="accepted").reduce((n,p)=>n+(parseFloat(p.amount)||0),0),i=s.filter(n=>n.status==="denied").reduce((n,p)=>n+(parseFloat(p.amount)||0),0),j=s.filter(n=>{const p=n.userName?.toLowerCase().includes(C.toLowerCase())||n.userId?.toLowerCase().includes(C.toLowerCase())||n.message?.toLowerCase().includes(C.toLowerCase()),d=g==="All"||n.status===g;return p&&d}),k=n=>{N(n),I(!0)},D=()=>{I(!1),N(null)};return f?(0,e.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading deposits..."})]})}):b?(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6 text-center",children:[(0,e.jsxs)("p",{className:"text-red-500",children:["Error: ",b]}),(0,e.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200",children:"Retry"})]}):(console.log("DepositsPage: Rendering with deposits array length:",s.length),(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:[(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Deposits"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",_.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-indigo-100",children:(0,e.jsx)(Se,{className:"h-6 w-6 text-indigo-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Pending Deposits"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:E})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-yellow-100",children:(0,e.jsx)(nt,{className:"h-6 w-6 text-yellow-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Approved Deposits"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:$})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,e.jsx)(Te,{className:"h-6 w-6 text-green-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Denied Deposits"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:o})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-red-100",children:(0,e.jsx)(fe,{className:"h-6 w-6 text-red-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Accepted Amount"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",L.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,e.jsx)(Te,{className:"h-6 w-6 text-green-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Declined Amount"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",i.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-red-100",children:(0,e.jsx)(fe,{className:"h-6 w-6 text-red-600"})})]})})]}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[(0,e.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Deposit Records"}),(0,e.jsxs)("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4",children:[(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,e.jsx)(ye,{className:"h-5 w-5 text-gray-400"})}),(0,e.jsx)("input",{type:"text",placeholder:"Search by name, user ID or message...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:C,onChange:n=>m(n.target.value)})]}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsxs)("select",{className:"block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-lg bg-gray-50",value:g,onChange:n=>F(n.target.value),children:[(0,e.jsx)("option",{value:"All",children:"All Statuses"}),(0,e.jsx)("option",{value:"pending",children:"Pending"}),(0,e.jsx)("option",{value:"accepted",children:"Accepted"}),(0,e.jsx)("option",{value:"denied",children:"Denied"})]}),(0,e.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:(0,e.jsx)(st,{className:"h-5 w-5 text-gray-400"})})]})]})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm overflow-scroll",children:(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User Name"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Proof"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:j.length>0?j.map(n=>(0,e.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[(0,e.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,e.jsx)("div",{className:"text-sm font-medium text-gray-900",children:n.userName}),(0,e.jsxs)("div",{className:"text-xs text-gray-500 italic",children:["ID: ",n.userId]})]}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsxs)("div",{className:"text-sm font-semibold text-gray-900",children:["$",n.amount?parseFloat(n.amount).toFixed(2):"0.00"]})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${S(n.status||"pending")}`,children:n.status||"pending"})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:n.imageUrl?(0,e.jsxs)("button",{onClick:()=>k(n),className:"text-indigo-600 hover:text-indigo-900 flex items-center",children:[(0,e.jsx)(Me,{className:"h-4 w-4 mr-1"}),"View"]}):(0,e.jsx)("span",{className:"text-gray-400",children:"No proof"})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:R(n.timestamp)}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,e.jsxs)("div",{className:"flex items-center space-x-3",children:[n.status==="pending"?(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)("button",{disabled:!!w[n.id],onClick:async()=>{if(window.confirm("Mark this deposit as Accepted?")){c(p=>({...p,[n.id]:!0}));try{await v(n.id,"accepted"),console.log("Deposit accepted:",n.id)}finally{c(p=>{const d={...p};return delete d[n.id],d})}}},className:"px-3 py-1 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors duration-200 disabled:opacity-50",children:w[n.id]?"Processing...":"Approve"}),(0,e.jsx)("button",{disabled:!!w[n.id],onClick:async()=>{if(window.confirm("Mark this deposit as Denied?")){c(p=>({...p,[n.id]:!0}));try{await v(n.id,"denied"),console.log("Deposit denied:",n.id)}finally{c(p=>{const d={...p};return delete d[n.id],d})}}},className:"px-3 py-1 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors duration-200 disabled:opacity-50",children:w[n.id]?"Processing...":"Deny"})]}):(0,e.jsx)("span",{className:"text-sm text-gray-500",children:n.status||"No actions"}),n.imageUrl?(0,e.jsx)("button",{onClick:()=>window.open(n.imageUrl,"_blank"),className:"text-indigo-600 hover:text-indigo-900 flex items-center",title:"View proof in new tab",children:(0,e.jsx)(at,{className:"h-4 w-4"})}):null]})})]},n.id)):(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:"6",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No deposits found."})})})]})})}),T&&P&&(0,e.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,e.jsxs)("div",{className:"bg-white  rounded-2xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-scroll",children:[(0,e.jsxs)("div",{className:"p-6 border-b border-gray-200 flex justify-between items-center",children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Deposit Proof"}),(0,e.jsx)("button",{onClick:D,className:"text-gray-400 hover:text-gray-500",children:(0,e.jsx)(fe,{className:"h-6 w-6"})})]}),(0,e.jsxs)("div",{className:"p-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"User Name"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:P.userName||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"User ID"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:P.userId||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Amount"}),(0,e.jsxs)("p",{className:"text-sm text-gray-900",children:["$",P.amount?parseFloat(P.amount).toFixed(2):"0.00"]})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Status"}),(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${S(P.status||"pending")}`,children:P.status||"pending"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Date"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:R(P.timestamp)})]}),(0,e.jsxs)("div",{className:"md:col-span-2",children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Message"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:P.message||"No message"})]})]}),(0,e.jsxs)("div",{className:"mt-6",children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Proof Image"}),(0,e.jsx)("div",{className:"border border-gray-200 rounded-lg ",children:P.imageUrl?(0,e.jsx)("img",{src:P.imageUrl,alt:"Deposit Proof",className:"w-full h-auto max-h-[60vh] object-contain",onError:n=>{n.target.style.display="none"}}):(0,e.jsx)("div",{className:"flex items-center justify-center h-64 bg-gray-100 text-gray-500",children:"No image available"})})]}),(0,e.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,e.jsx)("button",{onClick:D,className:"px-4 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50",children:"Close"}),P.status==="pending"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("button",{onClick:()=>{v(P.id,"accepted"),D()},className:"px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-green-600 hover:bg-green-700",children:"Approve"}),(0,e.jsx)("button",{onClick:()=>{v(P.id,"denied"),D()},className:"px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-red-600 hover:bg-red-700",children:"Deny"})]})]})]})]})})]}))},Ss=vs;function Ds(){const{currentUser:s}=ue(),[l,a]=(0,t.useState)([]),[h,f]=(0,t.useState)(""),[x,b]=(0,t.useState)(!0),[u,C]=(0,t.useState)({}),[m,g]=(0,t.useState)({}),F=(0,t.useRef)(),P=(0,t.useRef)(),N=w=>{if(!w)return!1;const c=w.toDate?w.toDate():new Date(w);return(new Date-c)/(1e3*60)<2};(0,t.useEffect)(()=>{if(!s)return;(async()=>{try{const S=re(U,"users",s.uid);await me(S,{isOnline:!0,lastActive:he()})}catch(S){console.error("Error setting user online:",S)}})(),P.current=setInterval(async()=>{try{const S=re(U,"users",s.uid);await me(S,{lastActive:he()})}catch(S){console.error("Error updating lastActive:",S)}},3e4);const c=async()=>{try{const S=re(U,"users",s.uid);await me(S,{isOnline:!1,lastActive:he()})}catch(S){console.error("Error setting user offline:",S)}};return window.addEventListener("beforeunload",c),()=>{clearInterval(P.current),window.removeEventListener("beforeunload",c),s&&(async()=>{try{const v=re(U,"users",s.uid);await me(v,{isOnline:!1,lastActive:he()})}catch(v){console.error("Error setting user offline:",v)}})()}},[s]),(0,t.useEffect)(()=>{if(!s){b(!1);return}const w=te(X(U,"messages"),ce("timestamp","asc"));return ie(w,c=>{a(c.docs.map(S=>({id:S.id,...S.data()}))),b(!1)})},[s]),(0,t.useEffect)(()=>{if(s)return ie(X(U,"users"),w=>{const c={},S={};w.forEach(v=>{const R=v.data();c[v.id]=R,N(R.lastActive)&&(S[v.id]={displayName:R.displayName||R.email?.split("@")[0]||"Unknown",isOnline:R.isOnline||!1,lastActive:R.lastActive})}),g(c),C(S)})},[s]);const T=async w=>{if(w.preventDefault(),!(!s||!h.trim()))try{await Tt(X(U,"messages"),{text:h,userId:s.uid,userName:s.email?s.email.split("@")[0]:"Anonymous",timestamp:he()}),f("")}catch(c){console.error("Error sending message:",c)}};(0,t.useEffect)(()=>{F.current?.scrollIntoView({behavior:"smooth"})},[l]);const I=w=>w?w.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"";return s?(0,e.jsxs)("div",{className:"flex flex-col  h-screen bg-gradient-to-b from-gray-50 to-gray-100 font-sans text-gray-800 max-w-4xl mx-auto w-full",children:[(0,e.jsx)("div",{className:"mx-4 mb-2 bg-white/70 backdrop-blur-md rounded-xl shadow-sm p-3",children:(0,e.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,e.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,e.jsxs)("span",{className:"text-xs text-gray-600",children:[Object.keys(u).length," online"]}),(0,e.jsx)("br",{}),(0,e.jsxs)("p",{className:"text-sm text-gray-500",children:[l.length," Messages"]})]})}),(0,e.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 flex flex-col gap-4 max-w-full",children:[x?(0,e.jsx)("div",{className:"flex justify-center p-6",children:(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)("div",{className:"w-2.5 h-2.5 bg-indigo-500 rounded-full animate-bounce"}),(0,e.jsx)("div",{className:"w-2.5 h-2.5 bg-indigo-500 rounded-full animate-bounce",style:{animationDelay:"0.16s"}}),(0,e.jsx)("div",{className:"w-2.5 h-2.5 bg-indigo-500 rounded-full animate-bounce",style:{animationDelay:"0.32s"}})]})}):l.length===0?(0,e.jsxs)("div",{className:"flex flex-col items-center justify-center text-gray-500 p-10 bg-white rounded-2xl shadow-lg m-5",children:[(0,e.jsx)("div",{className:"text-4xl mb-3 opacity-70",children:"ðŸ’¬"}),(0,e.jsx)("div",{className:"text-sm text-center max-w-xs",children:"No messages yet. Start a conversation!"})]}):l.map(w=>(0,e.jsxs)("div",{className:`flex ${w.userId===s.uid?"justify-end":"justify-start"} animate-fade-in`,children:[w.userId!==s.uid&&(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"w-9 h-9 rounded-full flex items-center justify-center bg-white text-indigo-600 font-bold flex-shrink-0 shadow-sm mr-2",children:w.userName?w.userName.charAt(0).toUpperCase():"U"}),(0,e.jsx)("div",{className:`absolute bottom-[60px] right-7 w-3.5 h-3.5 rounded-full border-2 border-white ${u[w.userId]?"bg-green-500":"bg-gray-400"}`,title:u[w.userId]?"Online":"Offline"})]}),(0,e.jsxs)("div",{className:`max-w-[72%] p-3 rounded-2xl relative shadow-md transition-all duration-300 hover:shadow-lg ${w.userId===s.uid?"bg-gradient-to-br from-indigo-50 to-indigo-100 border border-indigo-100 rounded-br-md":"bg-white border border-gray-200 rounded-bl-md"}`,children:[(0,e.jsx)("div",{className:"text-sm text-gray-800 leading-relaxed",children:w.text}),(0,e.jsx)("div",{className:"text-xs text-gray-400 text-right mt-2",children:I(w.timestamp)})]}),w.userId===s.uid&&(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"w-9 h-9 rounded-full flex items-center justify-center bg-gradient-to-br from-indigo-500 to-indigo-600 text-white font-bold flex-shrink-0 shadow-sm ml-2",children:w.userName?w.userName.charAt(0).toUpperCase():"U"}),(0,e.jsx)("div",{className:`absolute bottom-[60px] right-6 w-3.5 h-3.5 rounded-full border-2 border-white ${N(m[s?.uid]?.lastActive)?"bg-green-500":"bg-gray-400"}`,title:N(m[s?.uid]?.lastActive)?"Online":"Offline"})]})]},w.id)),(0,e.jsx)("div",{ref:F})]}),(0,e.jsxs)("form",{onSubmit:T,className:"flex items-center p-4 gap-3 sticky bottom-0 bg-white/70 backdrop-blur-md border-t border-gray-200",children:[(0,e.jsx)("div",{className:"flex-1 flex items-center bg-white p-2 pl-4 rounded-full shadow-md transition-all duration-300 focus-within:shadow-lg focus-within:border focus-within:border-indigo-500",children:(0,e.jsx)("input",{type:"text",className:"flex-1 border-0 outline-none p-2 bg-transparent text-sm text-gray-800",placeholder:"Type a message...",value:h,onChange:w=>f(w.target.value)})}),(0,e.jsx)("button",{type:"submit",className:"w-11 h-11 rounded-full flex items-center justify-center bg-gradient-to-br from-indigo-500 to-indigo-600 text-white border-none cursor-pointer shadow-md transition-all duration-300 hover:shadow-lg hover:-translate-y-0.5 active:translate-y-0 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",disabled:!h.trim(),children:(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-4.5 h-4.5",children:(0,e.jsx)("path",{d:"M3.478 2.404a.75.75 0 0 0-.926.941l2.432 7.905H13.5a.75.75 0 0 1 0 1.5H4.984l-2.432 7.905a.75.75 0 0 0 .926.94 60.519 60.519 0 0 0 18.445-8.986.75.75 0 0 0 0-1.218A60.517 60.517 0 0 0 3.478 2.404Z"})})})]})]}):(0,e.jsx)("div",{className:"flex flex-col h-screen bg-gradient-to-b from-gray-50 to-gray-100 items-center justify-center font-sans text-gray-800",children:(0,e.jsxs)("div",{className:"text-center p-6 bg-white rounded-2xl shadow-lg max-w-md",children:[(0,e.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Please log in to use chat"}),(0,e.jsx)("p",{className:"text-gray-600",children:"You need to be logged in to send and receive messages."})]})})}var Cs=()=>(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(Ds,{})}),ks=Cs,Ls=()=>{const[s,l]=(0,t.useState)(!1),{currentUser:a}=ue(),h=Ct(),f=Ie(),{logout:x}=ue(),b=async()=>{try{await x(),f("/login")}catch(m){console.error("Failed to log out",m)}};(0,t.useEffect)(()=>{const m=()=>{window.innerWidth>=1024&&l(!1)};return window.addEventListener("resize",m),()=>window.removeEventListener("resize",m)},[]),(0,t.useEffect)(()=>{const m=g=>{s&&!g.target.closest(".sidebar-content")&&!g.target.closest(".sidebar-toggle")&&l(!1)};return document.addEventListener("click",m),()=>document.removeEventListener("click",m)},[s]),(0,t.useEffect)(()=>{l(!1)},[h.pathname]);const u=[{name:"Dashboard",href:"/dashboard",icon:rs},{name:"Deposits",href:"/deposits",icon:ts},{name:"loans",href:"/loans",icon:Xt},{name:"Chat",href:"/chat",icon:as},{name:"Users",href:"/users",icon:rt},{name:"Payback",href:"/payback",icon:Gt},{name:"Settings",href:"/settings",icon:Jt},{name:"Annual Reports",href:"/annual-reports",icon:ve}],C=m=>h.pathname===m;return(0,e.jsxs)("div",{className:"flex h-screen w-screen max-w-full bg-gray-50",children:[(0,e.jsx)("div",{className:`fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-lg transform ${s?"translate-x-0":"-translate-x-full"} transition-transform duration-300 ease-in-out lg:translate-x-0 lg:static lg:inset-0 sidebar-content`,children:(0,e.jsxs)("div",{className:"flex flex-col h-full",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between h-16 px-6 border-b border-gray-200",children:[(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("div",{className:"flex-shrink-0",children:(0,e.jsx)("div",{className:"w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center",children:(0,e.jsx)("span",{className:"text-white font-bold",children:"MB"})})}),(0,e.jsx)("div",{className:"ml-3",children:(0,e.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"MoneyBox"})})]}),(0,e.jsx)("button",{onClick:()=>l(!1),className:"lg:hidden text-gray-500 hover:text-gray-700",children:(0,e.jsx)(De,{size:20})})]}),(0,e.jsx)("nav",{className:"flex-1 px-4 py-6 overflow-y-auto",children:(0,e.jsx)("ul",{className:"space-y-1",children:u.map(m=>(0,e.jsx)("li",{children:(0,e.jsxs)(Re,{to:m.href,className:`flex items-center px-4 py-3 text-sm font-medium rounded-lg transition-all duration-200 ${C(m.href)?"bg-indigo-50 text-indigo-700":"text-gray-700 hover:bg-gray-100"}`,children:[(0,e.jsx)(m.icon,{className:"mr-3 h-5 w-5"}),m.name]})},m.name))})}),(0,e.jsxs)("div",{className:"px-4 py-6 border-t border-gray-200",children:[(0,e.jsxs)("div",{className:"flex items-center mb-4",children:[(0,e.jsx)("div",{className:"flex-shrink-0",children:(0,e.jsx)("div",{className:"w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center",children:(0,e.jsx)("div",{className:"w-11 h-11 rounded-full flex items-center justify-center bg-gradient-to-br from-indigo-500 to-indigo-600 text-white font-bold shadow-md",children:a?.email?.charAt(0).toUpperCase()||"U"})})}),(0,e.jsxs)("div",{className:"ml-3",children:[(0,e.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:["Admin  is           ",a?.email?.slice(0,5).toUpperCase()||"U"]}),(0,e.jsx)("p",{className:"text-xs text-gray-500",children:a?.email?.slice(0,104).toLowerCase()||"U"})]})]}),(0,e.jsxs)("button",{onClick:b,className:"flex items-center w-full px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors duration-200",children:[(0,e.jsx)(We,{className:"mr-3 h-5 w-5"}),"Logout"]})]})]})}),(0,e.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,e.jsx)("header",{className:"bg-white shadow-sm z-10",children:(0,e.jsxs)("div",{className:"flex items-center justify-between h-16 px-6",children:[(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("button",{onClick:()=>l(!0),className:"lg:hidden text-gray-500 hover:text-gray-700 mr-4 sidebar-toggle",children:(0,e.jsx)(Qt,{size:20})}),(0,e.jsxs)("h2",{className:"text-xl font-semibold text-gray-800",children:[h.pathname==="/dashboard"&&"ðŸ’° Dashboard",h.pathname==="/deposits"&&"ðŸ’° Deposits Overview",h.pathname==="/loans"&&"ðŸ’¸ loans Overview",h.pathname==="/users"&&"ðŸ‘¥ Users Overview",h.pathname==="/chat"&&"ðŸ‘¥ Users Overview"]})]}),(0,e.jsx)("div",{className:"flex items-center space-x-4",children:(0,e.jsxs)("button",{onClick:b,className:"flex items-center text-sm font-medium text-gray-700 hover:text-gray-900",children:[(0,e.jsx)(We,{className:"mr-2 h-5 w-5"}),"Logout"]})})]})}),(0,e.jsx)("main",{className:"flex-1 overflow-y-auto bg-gray-50 p-6",children:(0,e.jsx)("div",{className:"h-full w-full",children:(0,e.jsx)(St,{})})})]})]})},As=Ls,Ps=()=>{const[s,l]=(0,t.useState)([]),[a,h]=(0,t.useState)([]),[f,x]=(0,t.useState)(!0),[b,u]=(0,t.useState)(null),[C,m]=(0,t.useState)(""),[g,F]=(0,t.useState)("All"),[P,N]=(0,t.useState)({});(0,t.useEffect)(()=>{const o=te(X(U,"users")),L=ie(o,i=>{const j=i.docs.map(k=>({id:k.id,...k.data()}));h(j)},i=>{console.error("Error loading users:",i),u("Failed to load users: "+i.message)});return()=>L()},[]),(0,t.useEffect)(()=>{const o=te(X(U,"loans"),ce("timestamp","desc")),L=ie(o,i=>{try{const j=i.docs.map(k=>({id:k.id,...k.data()})).map(k=>{const D=a.find(n=>n.uid===k.userId);return{...k,userName:D?D.fullName||"Unnamed User":"Unknown User"}});l(j),x(!1)}catch(j){console.error("Error merging loan data:",j),u("Error processing loan data: "+j.message),x(!1)}},i=>{console.error("Firestore error:",i),u("Failed to load loans: "+i.message),x(!1)});return()=>L()},[a]);const T=o=>{switch(o){case"accepted":return"bg-green-100 text-green-800";case"denied":return"bg-red-100 text-red-800";case"Pending":case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},I=async(o,L)=>{try{const i=re(U,"loans",o);await me(i,{status:L}),console.log(`Loan ${o} status updated to ${L}`)}catch(i){console.error("Error updating loan status:",i),u("Failed to update loan status: "+i.message)}},w=o=>{if(!o)return"N/A";if(o.seconds){const L=new Date(o.seconds*1e3);return L.toLocaleDateString()+" "+L.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}if(o.toDate){const L=o.toDate();return L.toLocaleDateString()+" "+L.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}return o.toString()},c=s.reduce((o,L)=>o+(parseFloat(L.amount)||0),0),S=s.filter(o=>o.status==="pending").length,v=s.filter(o=>o.status==="accepted").length,R=s.filter(o=>o.status==="denied").length,_=s.filter(o=>o.status==="accepted").reduce((o,L)=>o+(parseFloat(L.amount)||0),0),E=s.filter(o=>o.status==="denied").reduce((o,L)=>o+(parseFloat(L.amount)||0),0),$=s.filter(o=>{const L=o.userName?.toLowerCase().includes(C.toLowerCase())||o.userId?.toLowerCase().includes(C.toLowerCase())||o.message?.toLowerCase().includes(C.toLowerCase()),i=g==="All"||o.status===g;return L&&i});return f?(0,e.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading loans..."})]})}):b?(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6 text-center",children:[(0,e.jsxs)("p",{className:"text-red-500",children:["Error: ",b]}),(0,e.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200",children:"Retry"})]}):(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total loans"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",c.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-blue-100",children:(0,e.jsx)(ve,{className:"h-6 w-6 text-blue-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Pending loans"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:S})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-yellow-100",children:(0,e.jsx)(nt,{className:"h-6 w-6 text-yellow-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Paid loans"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:v})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,e.jsx)(Zt,{className:"h-6 w-6 text-green-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Declined loans"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:R})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-red-100",children:(0,e.jsx)(fe,{className:"h-6 w-6 text-red-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Accepted Amount"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",_.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,e.jsx)(Te,{className:"h-6 w-6 text-green-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Declined Amount"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",E.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-red-100",children:(0,e.jsx)(fe,{className:"h-6 w-6 text-red-600"})})]})})]}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[(0,e.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Loans Records"}),(0,e.jsxs)("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4",children:[(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,e.jsx)(ye,{className:"h-5 w-5 text-gray-400"})}),(0,e.jsx)("input",{type:"text",placeholder:"Search by name, user ID or message...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:C,onChange:o=>m(o.target.value)})]}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsxs)("select",{className:"block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-lg bg-gray-50",value:g,onChange:o=>F(o.target.value),children:[(0,e.jsx)("option",{value:"All",children:"All Statuses"}),(0,e.jsx)("option",{value:"Pending",children:"Pending"}),(0,e.jsx)("option",{value:"accepted",children:"Paid"}),(0,e.jsx)("option",{value:"denied",children:"Declined"})]}),(0,e.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:(0,e.jsx)(st,{className:"h-5 w-5 text-gray-400"})})]})]})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden",children:(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User Name"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:$.length>0?$.map(o=>(0,e.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[(0,e.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,e.jsx)("div",{className:"text-sm font-semibold text-gray-900",children:o.userName}),(0,e.jsxs)("div",{className:"text-xs text-gray-500 italic",children:["ID: ",o.userId]})]}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsxs)("div",{className:"text-sm font-semibold text-gray-900",children:["$",o.amount?parseFloat(o.amount).toFixed(2):"0.00"]})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${T(o.status)}`,children:o.status==="accepted"?"Paid":o.status||"Pending"})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:w(o.timestamp)}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,e.jsxs)("div",{className:"flex items-center space-x-3",children:[o.status==="pending"?(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)("button",{disabled:!!P[o.id],onClick:async()=>{if(window.confirm("Mark this loan as Paid?")){N(L=>({...L,[o.id]:!0}));try{await I(o.id,"accepted")}finally{N(L=>{const i={...L};return delete i[o.id],i})}}},className:"px-3 py-1 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors duration-200 disabled:opacity-50",children:P[o.id]?"Processing...":"Pay"}),(0,e.jsx)("button",{disabled:!!P[o.id],onClick:async()=>{if(window.confirm("Mark this loan as Declined?")){N(L=>({...L,[o.id]:!0}));try{await I(o.id,"denied")}finally{N(L=>{const i={...L};return delete i[o.id],i})}}},className:"px-3 py-1 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors duration-200 disabled:opacity-50",children:P[o.id]?"Processing...":"Decline"})]}):(0,e.jsx)("span",{className:"text-sm text-gray-500",children:o.status==="accepted"?"Paid":o.status}),o.imageUrl&&(0,e.jsx)("button",{onClick:()=>window.open(o.imageUrl,"_blank"),className:"text-indigo-600 hover:text-indigo-900 flex items-center",title:"View proof",children:(0,e.jsx)(es,{className:"h-4 w-4"})})]})})]},o.id)):(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:"5",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No loans found."})})})]})})})]})},Es=Ps,Fs=()=>{const[s,l]=(0,t.useState)([]),[a,h]=(0,t.useState)(!0),[f,x]=(0,t.useState)(null),[b,u]=(0,t.useState)(""),[C,m]=(0,t.useState)(!1),[g,F]=(0,t.useState)(null),[P,N]=(0,t.useState)([]),[T,I]=(0,t.useState)([]),[w,c]=(0,t.useState)(!1),[S,v]=(0,t.useState)(!1),[R,_]=(0,t.useState)(null),[E,$]=(0,t.useState)(null),[o,L]=(0,t.useState)({}),i=(0,t.useRef)(null),j=(0,t.useRef)(null);(0,t.useEffect)(()=>{if(!U){x("Firestore instance not available"),h(!1);return}const r=te(X(U,"users"),ce("createdAt","desc")),Y=ie(r,M=>{try{const J=M.docs.map(G=>({id:G.id,...G.data()}));l(J),h(!1)}catch(J){console.error("Error processing users snapshot:",J),x("Failed to process users data"),h(!1)}},M=>{console.error("Error fetching users:",M),M.code==="permission-denied"?x("Permission denied. Check Firestore rules."):x("Failed to load users: "+(M.message||"Unknown error")),h(!1)});return()=>Y()},[]),(0,t.useEffect)(()=>{if(i.current&&(i.current(),i.current=null),j.current&&(j.current(),j.current=null),!g){N([]),I([]);return}c(!0),_(null);const r=te(X(U,"deposits"),ce("timestamp","desc"));i.current=ie(r,M=>{try{const J=M.docs.map(G=>({id:G.id,...G.data()})).filter(G=>G.userId===g.uid);N(J),c(!1)}catch(J){console.error("Error processing deposits snapshot:",J),_("Failed to process deposits data"),c(!1)}},M=>{console.error("Error fetching deposits:",M),_("Failed to load deposits: "+(M.message||"Unknown error")),c(!1)}),v(!0),$(null);const Y=te(X(U,"loans"),ce("timestamp","desc"));return j.current=ie(Y,M=>{try{const J=M.docs.map(G=>({id:G.id,...G.data()})).filter(G=>G.userId===g.uid);I(J),v(!1)}catch(J){console.error("Error processing loans snapshot:",J),$("Failed to process loans data"),v(!1)}},M=>{console.error("Error fetching loans:",M),$("Failed to load loans: "+(M.message||"Unknown error")),v(!1)}),()=>{i.current&&(i.current(),i.current=null),j.current&&(j.current(),j.current=null)}},[g]);const k=r=>{if(!r)return"N/A";if(r.seconds)return new Date(r.seconds*1e3).toLocaleString();if(r.toDate)return r.toDate().toLocaleString();try{return new Date(r).toLocaleString()}catch{return String(r)}},D=r=>{switch(r?.toLowerCase()){case"accepted":return"bg-green-100 text-green-800";case"denied":case"rejected":return"bg-red-100 text-red-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},n=r=>{F(r),m(!0)},p=()=>{m(!1)},d=r=>{window.open(r,"_blank")},z=(r,Y)=>{const M=document.createElement("a");M.href=r,M.download=Y||"proof-image.jpg",document.body.appendChild(M),M.click(),document.body.removeChild(M)},B=P.reduce((r,Y)=>r+(Y.amount||0),0),W=T.reduce((r,Y)=>r+(Y.amount||0),0);P.filter(r=>r.status==="pending").length,P.filter(r=>r.status==="accepted").length,P.filter(r=>r.status==="denied"||r.status==="rejected").length,T.filter(r=>r.status==="pending").length,T.filter(r=>r.status==="accepted").length,T.filter(r=>r.status==="denied"||r.status==="rejected").length;const V=s.filter(r=>{const Y=b.trim().toLowerCase();return Y?(r.fullName||"").toLowerCase().includes(Y)||(r.email||"").toLowerCase().includes(Y)||(r.phoneNumber||"").toLowerCase().includes(Y)||(r.uid||"").toLowerCase().includes(Y):!0});return a?(0,e.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading users..."})]})}):f?(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6 text-center",children:[(0,e.jsxs)("p",{className:"text-red-500",children:["Error: ",f]}),(0,e.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200",children:"Retry"})]}):(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6 md:col-span-1",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Users"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:s.length})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,e.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a4 4 0 00-4-4h-1M9 20H4v-2a4 4 0 014-4h1m0-4a4 4 0 100-8 4 4 0 000 8z"})})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6 md:col-span-3",children:(0,e.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0",children:[(0,e.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"User Records"}),(0,e.jsx)("div",{className:"flex items-center w-full sm:w-64",children:(0,e.jsxs)("div",{className:"relative w-full",children:[(0,e.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,e.jsx)(ye,{className:"h-5 w-5 text-gray-400"})}),(0,e.jsx)("input",{type:"text",placeholder:"Search users...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:b,onChange:r=>u(r.target.value)})]})})]})})]}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden",children:(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Gender"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Age"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Joined"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:V.length>0?V.map(r=>(0,e.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors duration-150 cursor-pointer",onClick:()=>n(r),children:[(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsxs)("div",{className:"flex items-center",children:[r.imageUrl?(0,e.jsx)("img",{src:r.imageUrl,alt:r.fullName||"avatar",className:"h-10 w-10 rounded-full object-cover",onError:Y=>{Y.target.style.display="none"}}):(0,e.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center text-sm font-medium text-gray-700",children:(r.fullName||"U").split(" ").map(Y=>Y[0]).slice(0,2).join("").toUpperCase()}),(0,e.jsxs)("div",{className:"ml-3",children:[(0,e.jsx)("div",{className:"text-sm font-medium text-gray-900",children:r.fullName||"No name"}),(0,e.jsx)("div",{className:"text-xs text-gray-500",children:r.uid||""})]})]})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:r.email||"N/A"}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:r.phoneNumber||"N/A"}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 capitalize",children:r.gender||"N/A"}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:r.age||"N/A"}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:k(r.createdAt)})]},r.id)):(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:"6",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No users found."})})})]})})}),C&&g&&(0,e.jsx)("div",{className:"fixed inset-0 z-50 overflow-auto bg-black bg-opacity-50 flex items-center justify-center p-4",children:(0,e.jsxs)("div",{className:"bg-white rounded-xl shadow-xl max-w-6xl w-full max-h-[90vh] overflow-auto",children:[(0,e.jsxs)("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center",children:[(0,e.jsxs)("h2",{className:"text-xl font-semibold text-gray-900",children:["User Details: ",g.fullName]}),(0,e.jsx)("button",{onClick:p,className:"p-1 rounded-full hover:bg-gray-100 transition-colors",children:(0,e.jsx)(De,{className:"h-5 w-5 text-gray-500"})})]}),(0,e.jsxs)("div",{className:"p-6",children:[(0,e.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[(0,e.jsxs)("div",{className:"flex items-center mb-4",children:[g.imageUrl?(0,e.jsx)("img",{src:g.imageUrl,alt:g.fullName||"avatar",className:"h-16 w-16 rounded-full object-cover mr-4"}):(0,e.jsx)("div",{className:"h-16 w-16 rounded-full bg-gray-200 flex items-center justify-center text-xl font-medium text-gray-700 mr-4",children:(g.fullName||"U").split(" ").map(r=>r[0]).slice(0,2).join("").toUpperCase()}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:g.fullName||"No name"}),(0,e.jsxs)("p",{className:"text-sm text-gray-500",children:["ID: ",g.uid||"N/A"]})]})]}),(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Email"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:g.email||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Phone Number"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:g.phoneNumber||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"MoMo Number"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:g.momoNumber||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Credit card Number"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:g.creditCardNumber||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Gender"}),(0,e.jsx)("p",{className:"text-sm text-gray-900 capitalize",children:g.gender||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Age"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:g.age||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Joined Date"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:k(g.createdAt)})]})]})]}),(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,e.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,e.jsxs)("div",{className:"flex items-center mb-4",children:[(0,e.jsx)("div",{className:"p-2 rounded-full bg-green-100 mr-3",children:(0,e.jsx)(Se,{className:"h-6 w-6 text-green-600"})}),(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Deposits Summary"})]}),(0,e.jsx)("div",{className:"space-y-3",children:(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Total Amount:"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",B.toFixed(2)]})]})})]}),(0,e.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,e.jsxs)("div",{className:"flex items-center mb-4",children:[(0,e.jsx)("div",{className:"p-2 rounded-full bg-blue-100 mr-3",children:(0,e.jsx)(ss,{className:"h-6 w-6 text-blue-600"})}),(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Loans Summary"})]}),(0,e.jsx)("div",{className:"space-y-3",children:(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Total Amount:"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",W.toFixed(2)]})]})})]})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Deposits"}),w?(0,e.jsx)("div",{className:"flex justify-center py-4",children:(0,e.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):R?(0,e.jsx)("div",{className:"bg-red-50 p-4 rounded-md",children:(0,e.jsx)("p",{className:"text-sm text-red-800",children:R})}):P.length>0?(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Message"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Proof"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:P.map(r=>(0,e.jsxs)("tr",{children:[(0,e.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:["$",r.amount||"0"]}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap",children:(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${D(r.status)}`,children:r.status||"Unknown"})}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:k(r.timestamp)}),(0,e.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900 max-w-xs truncate",title:r.message,children:r.message||"N/A"}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:r.proofImage?(0,e.jsxs)("div",{className:"flex space-x-2",children:[(0,e.jsx)("button",{onClick:()=>d(r.proofImage),className:"text-indigo-600 hover:text-indigo-900",title:"View",children:(0,e.jsx)(Me,{className:"h-5 w-5"})}),(0,e.jsx)("button",{onClick:()=>z(r.proofImage,`deposit-proof-${r.id}.jpg`),className:"text-indigo-600 hover:text-indigo-900",title:"Download",children:(0,e.jsx)(at,{className:"h-5 w-5"})})]}):"N/A"})]},r.id))})]})}):(0,e.jsx)("div",{className:"text-center py-4 text-sm text-gray-500",children:"No deposits found."})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Loans"}),S?(0,e.jsx)("div",{className:"flex justify-center py-4",children:(0,e.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):E?(0,e.jsx)("div",{className:"bg-red-50 p-4 rounded-md",children:(0,e.jsx)("p",{className:"text-sm text-red-800",children:E})}):T.length>0?(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reason"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Approved By"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:T.map(r=>(0,e.jsxs)("tr",{children:[(0,e.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:["$",r.amount||"0"]}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap",children:(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${D(r.status)}`,children:r.status||"Unknown"})}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:k(r.timestamp)}),(0,e.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900 max-w-xs truncate",title:r.reason,children:r.reason||"N/A"}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:r.approvedBy||"N/A"})]},r.id))})]})}):(0,e.jsx)("div",{className:"text-center py-4 text-sm text-gray-500",children:"No loans found."})]})]})]})})]})},Us=Fs,Ts=()=>{const[s,l]=(0,t.useState)("10.00"),[a,h]=(0,t.useState)(!0),[f,x]=(0,t.useState)(!1),[b,u]=(0,t.useState)(null),[C,m]=(0,t.useState)("success"),[g,F]=(0,t.useState)([]),[P,N]=(0,t.useState)(!1),[T,I]=(0,t.useState)(null);(0,t.useEffect)(()=>{(async()=>{try{const S=te(X(U,"interest"),ce("timestamp","desc"),Ut(10)),v=await ge(S);if(v.empty)l("10.00");else{const R=v.docs[0];l(R.data().interest.toFixed(2)),I(R.id);const _=v.docs.map(E=>({date:new Date(E.data().timestamp?.toDate()||Date.now()).toLocaleDateString(),rate:parseFloat(E.data().interest)})).reverse();F(_)}}catch(S){console.error("Error fetching interest:",S),u("Failed to load interest rate"),m("error"),setTimeout(()=>u(null),3e3)}finally{h(!1)}})()},[]);const w=async()=>{if(isNaN(s)||s<1||s>100){u("Please enter a valid interest rate between 1% and 100%"),m("error"),setTimeout(()=>u(null),3e3);return}x(!0);try{const c=new Date;if(T){const S=re(U,"interest",T);await me(S,{interest:Number(s),timestamp:c})}else await tt(re(U,"interest","globalRate"),{interest:Number(s),timestamp:c}),I("globalRate");u("Interest rate updated successfully!"),m("success"),F(S=>[...S.slice(-9),{date:c.toLocaleDateString(),rate:Number(s)}])}catch(c){console.error("Error updating interest:",c),u("Failed to update interest rate"),m("error")}finally{x(!1),setTimeout(()=>u(null),3e3)}};return a?(0,e.jsx)("div",{className:"flex justify-center items-center min-h-screen px-4",children:(0,e.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-10 w-full max-w-md text-center",children:[(0,e.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600 dark:text-gray-300",children:"Loading interest rate..."})]})}):(0,e.jsxs)("div",{className:"flex justify-center items-center min-h-screen px-4 bg-gray-50 dark:bg-gray-900",children:[(0,e.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-4 sm:p-6 md:p-10 w-full max-w-md",children:[(0,e.jsx)("h2",{className:"text-xl sm:text-2xl font-bold text-gray-800 dark:text-gray-100 mb-6 text-center",children:"Interest Rate Settings"}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("label",{className:"block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2",children:"Current Interest Rate (%)"}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("input",{type:"number",step:"0.01",min:"1",max:"100",value:s,onChange:c=>l(c.target.value),className:"border border-gray-300 dark:border-gray-700 rounded-lg p-3 w-full focus:ring-2 focus:ring-blue-500 outline-none pr-12",disabled:f,placeholder:"Enter interest rate (1â€“100)"}),(0,e.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"%"})]}),(0,e.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Enter as a percentage (e.g., 5 for 5%)"})]}),(0,e.jsx)("button",{onClick:w,disabled:f,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200 w-full disabled:opacity-50 flex items-center justify-center text-sm sm:text-base",children:f?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"}),"Saving..."]}):"Save Changes"}),(0,e.jsx)("div",{className:"mt-6 text-center",children:(0,e.jsxs)("button",{onClick:()=>N(!P),className:"text-blue-600 dark:text-blue-400 text-sm font-medium hover:underline",children:[P?"Hide":"Show"," Rate History"]})}),P&&g.length>0&&(0,e.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[(0,e.jsx)("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300 mb-4",children:"Interest Rate History"}),(0,e.jsx)("div",{className:"h-48",children:(0,e.jsx)(Ee,{width:"100%",height:"100%",children:(0,e.jsxs)(Je,{data:g,children:[(0,e.jsx)(Fe,{strokeDasharray:"3 3",stroke:"#e0e0e0"}),(0,e.jsx)(Pe,{dataKey:"date",tick:{fontSize:12}}),(0,e.jsx)(Ue,{tick:{fontSize:12},domain:["dataMin - 0.5","dataMax + 0.5"]}),(0,e.jsx)(Ae,{formatter:c=>`${c.toFixed(2)}%`,contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.9)",border:"1px solid #ccc",borderRadius:"4px"}}),(0,e.jsx)(Le,{type:"monotone",dataKey:"rate",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:4},activeDot:{r:6}})]})})})]})]}),b&&(0,e.jsx)("div",{className:`fixed top-5 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-lg text-white font-semibold shadow-md transition-all duration-300 ${C==="success"?"bg-green-500":"bg-red-500"}`,children:b})]})},Is=Ts;ms();var ke=Ce(cs()),Rs=(s,l)=>{const a=new us({orientation:"portrait",unit:"mm",format:"a4"}),h=a.internal.pageSize.getWidth(),f=a.internal.pageSize.getHeight(),x=20;h-x*2,a.setFont("helvetica");const b=c=>c?(c.toDate?c.toDate():new Date(c)).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A",u=c=>`$${c.toFixed(2)}`,C=c=>c==="approved"?[0,128,0]:[255,0,0],m=c=>c==="approved"?"PAID":c?c.toUpperCase():"UNPAID",g=()=>{a.setFillColor(41,98,255),a.rect(0,0,h,30,"F"),a.setTextColor(255,255,255),a.setFontSize(20),a.setFont("helvetica","bold"),a.text("Annual User Reports",h/2,20,{align:"center"}),a.setFontSize(14),a.setFont("helvetica","normal"),a.text(`${l}`,h/2,26,{align:"center"}),a.setTextColor(0,0,0)},F=c=>{const S=f-10;a.setFontSize(8),a.setTextColor(100,100,100),a.text(`Page ${c}`,h/2,S,{align:"center"})},P=()=>{g(),a.setFontSize(28),a.setTextColor(41,98,255),a.text("Annual User Reports",h/2,100,{align:"center"}),a.setFontSize(22),a.text(`${l}`,h/2,115,{align:"center"}),a.setFontSize(12),a.setTextColor(100,100,100);const c=new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});a.text(`Generated on ${c}`,h/2,130,{align:"center"}),a.setTextColor(0,0,0),a.setFontSize(14),a.setFont("helvetica","bold"),a.text("Summary Statistics",x,160),a.setFont("helvetica","normal"),a.setFontSize(12);const S=s.length,v=s.reduce(($,o)=>$+o.totalDeposits,0),R=s.reduce(($,o)=>$+o.totalLoans,0),_=s.reduce(($,o)=>$+o.paidLoansCount,0),E=s.reduce(($,o)=>$+o.unpaidLoansCount,0);a.text(`Total Users: ${S}`,x,175),a.text(`Total Deposits: ${u(v)}`,x,185),a.text(`Total Loans: ${u(R)}`,x,195),a.text(`Total Paid Loans: ${_}`,x,205),a.text(`Total Unpaid Loans: ${E}`,x,215),F(1),a.addPage()};let N=0;const T=()=>{g();const c=[[{content:"User Name",dataKey:"name"}],[{content:"Total Deposits ($)",dataKey:"totalDeposits"}],[{content:"Paid Loans",dataKey:"paidLoansCount"}],[{content:"Unpaid Loans",dataKey:"unpaidLoansCount"}],[{content:"Total Loans ($)",dataKey:"totalLoans"}]],S=s.map(v=>[v.user.name||"Unknown User",u(v.totalDeposits),v.paidLoansCount,v.unpaidLoansCount,u(v.totalLoans)]);(0,ke.default)(a,{head:c,body:S,startY:40,theme:"grid",styles:{font:"helvetica",fontSize:10,cellPadding:5},headStyles:{fillColor:[41,98,255],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,245,245]},margin:{left:20,right:20},didDrawPage:v=>{N=v.cursor.y}}),N=a.lastAutoTable.finalY+10,F(a.internal.getNumberOfPages())},I=c=>f-N-20<c?(a.addPage(),g(),N=40,F(a.internal.getNumberOfPages()),!0):!1,w=(c,S=!1)=>{const v=60+c.deposits.length*10+c.loans.length*10;if(I(v),a.setFontSize(16),a.setFont("helvetica","bold"),a.setTextColor(41,98,255),a.text(c.user.name||"Unknown User",x,N),N+=10,a.setFontSize(12),a.setFont("helvetica","normal"),a.setTextColor(0,0,0),a.text(`Email: ${c.user.email||"N/A"}`,x,N),N+=10,a.text(`Phone: ${c.user.phone||"N/A"}`,x,N),N+=15,c.deposits.length>0){const R=[[{content:"Amount",dataKey:"amount"}],[{content:"Date",dataKey:"date"}]],_=c.deposits.map(E=>[u(E.amount),b(E.timestamp)]);I(30),(0,ke.default)(a,{head:R,body:_,startY:N,theme:"grid",styles:{font:"helvetica",fontSize:10,cellPadding:5},headStyles:{fillColor:[75,192,192],textColor:255,fontStyle:"bold"},margin:{left:x,right:x},didDrawPage:E=>{N=E.cursor.y}}),N=a.lastAutoTable.finalY+10}else I(20),a.setFontSize(10),a.setTextColor(100,100,100),a.text("No deposits found",x,N),a.setTextColor(0,0,0),N+=10;if(c.loans.length>0){const R=[[{content:"Amount",dataKey:"amount"}],[{content:"Date",dataKey:"date"}],[{content:"Status",dataKey:"status"}]],_=c.loans.map(E=>[u(E.amount),b(E.timestamp),m(E.paymentStatus)]);I(30),(0,ke.default)(a,{head:R,body:_,startY:N,theme:"grid",styles:{font:"helvetica",fontSize:10,cellPadding:5},headStyles:{fillColor:[255,99,132],textColor:255,fontStyle:"bold"},didDrawCell:E=>{if(E.section==="body"&&E.column.index===2){const $=E.row.index,o=c.loans[$];if(o){const L=C(o.paymentStatus);a.setTextColor(L[0],L[1],L[2])}}},didDrawPage:E=>{N=E.cursor.y},margin:{left:x,right:x}}),N=a.lastAutoTable.finalY+15}else I(20),a.setFontSize(10),a.setTextColor(100,100,100),a.text("No loans found",x,N),a.setTextColor(0,0,0),N+=15};try{P(),T(),s.length>0&&(a.addPage(),g(),N=40),s.forEach((v,R)=>{w(v,R===0)});const c=a.internal.getNumberOfPages();for(let v=1;v<=c;v++)a.setPage(v),F(v);const S=`annual-reports-${l}.pdf`;return a.save(S),{success:!0,filename:S}}catch(c){return console.error("Error generating PDF:",c),{success:!1,error:c.message}}},Ms=Rs;Bt.register(Ot,Mt,_t,$t,zt,Yt,Vt);var Ge=s=>xs(new Date(s,0,1)),Ke=s=>os(new Date(s,0,1)),dt=(s,l)=>new Date(s,l-1,1),ct=(s,l)=>new Date(s,l,0),Ze=s=>{if(!s)return"N/A";const l=s.toDate?s.toDate():new Date(s);return it(l,"MMM dd, yyyy")},zs=(s,l)=>{const a=s.reduce((b,u)=>b+u.amount,0),h=l.reduce((b,u)=>b+u.amount,0),f=l.filter(b=>b.paymentStatus==="approved").length,x=l.filter(b=>b.paymentStatus!=="approved").length;return{totalDeposits:a,totalLoans:h,paidLoansCount:f,unpaidLoansCount:x}},$s=(s,l)=>{if(!l.trim())return s;const a=l.toLowerCase();return s.filter(h=>h.user?.name?.toLowerCase().includes(a)||h.user?.email?.toLowerCase().includes(a)||h.user?.phone?.toLowerCase().includes(a))},Ys=(s,l)=>{const a=["User","Total Deposits","Total Loans","Paid Loans","Unpaid Loans"],h=s.map(C=>[C.user.name,C.totalDeposits,C.totalLoans,C.paidLoansCount,C.unpaidLoansCount]);let f=a.join(",")+`
`;h.forEach(C=>{f+=C.join(",")+`
`});const x=new Blob([f],{type:"text/csv;charset=utf-8;"}),b=URL.createObjectURL(x),u=document.createElement("a");u.setAttribute("href",b),u.setAttribute("download",l),u.style.visibility="hidden",document.body.appendChild(u),u.click(),document.body.removeChild(u)},He=(s,l,a)=>{const h=[];for(let f=1;f<=12;f++){const x=dt(a,f),b=ct(a,f),u=s.filter(m=>{const g=m.timestamp.toDate?m.timestamp.toDate():new Date(m.timestamp);return g>=x&&g<=b}),C=l.filter(m=>{const g=m.timestamp.toDate?m.timestamp.toDate():new Date(m.timestamp);return g>=x&&g<=b});h.push({month:it(x,"MMM"),deposits:u.reduce((m,g)=>m+g.amount,0),loans:C.reduce((m,g)=>m+g.amount,0)})}return h},Os=s=>s==="approved"?{text:"PAID",className:"bg-green-100 text-green-800"}:{text:s?s.toUpperCase():"UNPAID",className:"bg-red-100 text-red-800"},Qe=({data:s,columns:l,itemsPerPage:a=10})=>{const[h,f]=(0,t.useState)(1),x=Math.ceil(s.length/a),b=(h-1)*a,u=b+a,C=s.slice(b,u);return(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsx)("tr",{children:l.map((m,g)=>(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:m.header},g))})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:C.map((m,g)=>(0,e.jsx)("tr",{children:l.map((F,P)=>(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:F.render?F.render(m):m[F.accessor]},P))},g))})]})}),x>1&&(0,e.jsxs)("div",{className:"px-6 py-3 flex items-center justify-between border-t border-gray-200",children:[(0,e.jsxs)("div",{className:"flex-1 flex justify-between sm:hidden",children:[(0,e.jsx)("button",{onClick:()=>f(m=>Math.max(m-1,1)),disabled:h===1,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Previous"}),(0,e.jsx)("button",{onClick:()=>f(m=>Math.min(m+1,x)),disabled:h===x,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Next"})]}),(0,e.jsxs)("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[(0,e.jsx)("div",{children:(0,e.jsxs)("p",{className:"text-sm text-gray-700",children:["Showing ",(0,e.jsx)("span",{className:"font-medium",children:b+1})," to"," ",(0,e.jsx)("span",{className:"font-medium",children:Math.min(u,s.length)})," of"," ",(0,e.jsx)("span",{className:"font-medium",children:s.length})," results"]})}),(0,e.jsx)("div",{children:(0,e.jsxs)("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[(0,e.jsx)("button",{onClick:()=>f(m=>Math.max(m-1,1)),disabled:h===1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50",children:"Previous"}),Array.from({length:x},(m,g)=>g+1).map(m=>(0,e.jsx)("button",{onClick:()=>f(m),className:`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${h===m?"z-10 bg-blue-50 border-blue-500 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,children:m},m)),(0,e.jsx)("button",{onClick:()=>f(m=>Math.min(m+1,x)),disabled:h===x,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50",children:"Next"})]})})]})]})]})},_s=({isOpen:s,onClose:l,user:a,deposits:h,loans:f})=>{if(!s)return null;const x=[{header:"Amount",accessor:"amount",render:u=>`$${u.amount.toFixed(2)}`},{header:"Date",accessor:"timestamp",render:u=>Ze(u.timestamp)}],b=[{header:"Amount",accessor:"amount",render:u=>`$${u.amount.toFixed(2)}`},{header:"Date",accessor:"timestamp",render:u=>Ze(u.timestamp)},{header:"Status",accessor:"paymentStatus",render:u=>{const C=Os(u.paymentStatus);return(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${C.className}`,children:C.text})}}];return(0,e.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,e.jsxs)("div",{className:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[(0,e.jsx)("div",{className:"fixed inset-0 transition-opacity","aria-hidden":"true",children:(0,e.jsx)("div",{className:"absolute inset-0 bg-gray-500 opacity-75",onClick:l})}),(0,e.jsx)("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"â€‹"}),(0,e.jsx)("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-3xl sm:w-full",children:(0,e.jsxs)("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:[(0,e.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,e.jsxs)("h3",{className:"text-lg leading-6 font-medium text-gray-900",id:"modal-title",children:[a.name,"'s Report"]}),(0,e.jsx)("button",{type:"button",className:"text-gray-400 hover:text-gray-500 focus:outline-none",onClick:l,children:(0,e.jsx)("svg",{className:"h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,e.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,e.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,e.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,e.jsx)("p",{className:"text-sm text-gray-500",children:"Email"}),(0,e.jsx)("p",{className:"text-base font-medium",children:a.email||"N/A"})]}),(0,e.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,e.jsx)("p",{className:"text-sm text-gray-500",children:"Phone"}),(0,e.jsx)("p",{className:"text-base font-medium",children:a.phone||"N/A"})]})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Deposits"}),h.length===0?(0,e.jsx)("p",{className:"text-gray-500",children:"No deposits found"}):(0,e.jsx)(Qe,{data:h,columns:x,itemsPerPage:5})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Loans"}),f.length===0?(0,e.jsx)("p",{className:"text-gray-500",children:"No loans found"}):(0,e.jsx)(Qe,{data:f,columns:b,itemsPerPage:5})]})]})})]})})},Bs=(s,l)=>{const[a,h]=(0,t.useState)(s);return(0,t.useEffect)(()=>{const f=setTimeout(()=>{h(s)},l);return()=>{clearTimeout(f)}},[s,l]),a},Vs=()=>{const s=new Date().getFullYear(),[l,a]=(0,t.useState)(s),[h,f]=(0,t.useState)("all"),[x,b]=(0,t.useState)(""),[u,C]=(0,t.useState)(!1),[m,g]=(0,t.useState)([]),[F,P]=(0,t.useState)({}),[N,T]=(0,t.useState)(null),[I,w]=(0,t.useState)(!1),[c,S]=(0,t.useState)(null),[v,R]=(0,t.useState)(null),[_,E]=(0,t.useState)(!0),[$,o]=(0,t.useState)(null),[L,i]=(0,t.useState)({deposits:null,loans:null}),[j,k]=(0,t.useState)(1),D=20,n=Bs(x,300),p=(0,t.useMemo)(()=>{if(Object.keys(F).length===0)return[];let y=Object.values(F);return n&&(y=$s(y,n)),u&&(y=y.filter(Z=>Z.unpaidLoansCount>0)),y},[F,n,u]),d=Math.ceil(p.length/D),z=(j-1)*D,B=z+D,W=p.slice(z,B);(0,t.useEffect)(()=>{k(1)},[p.length]);const V=(0,t.useMemo)(()=>c?{labels:c.labels,datasets:c.datasets}:null,[c]),r=(0,t.useMemo)(()=>v?{currentYear:{totalDeposits:v.currentYear.totalDeposits,totalLoans:v.currentYear.totalLoans,monthlyData:v.currentYear.monthlyData},previousYear:{totalDeposits:v.previousYear.totalDeposits,totalLoans:v.previousYear.totalLoans,monthlyData:v.previousYear.monthlyData}}:null,[v]),Y=async()=>{try{const y=te(X(U,"users")),Z=await ge(y),ne=[];return Z.forEach(K=>{ne.push({id:K.id,...K.data()})}),g(ne),ne}catch(y){return console.error("Error fetching users:",y),o("Failed to fetch users data"),[]}},M=async(y,Z,ne)=>{try{try{const K=te(X(U,"deposits"),xe("userId","in",y),xe("timestamp",">=",Z),xe("timestamp","<=",ne),ce("timestamp","desc")),de=await ge(K),ee={};return de.forEach(H=>{const O={id:H.id,...H.data()};ee[O.userId]||(ee[O.userId]=[]),ee[O.userId].push(O)}),ee}catch(K){if(K.message.includes("requires an index")){console.warn("Index not found for deposits query, using fallback"),i(O=>({...O,deposits:K.message}));const de=te(X(U,"deposits"),xe("userId","in",y)),ee=await ge(de),H={};return ee.forEach(O=>{const q={id:O.id,...O.data()},ae=q.timestamp.toDate?q.timestamp.toDate():new Date(q.timestamp);ae>=Z&&ae<=ne&&(H[q.userId]||(H[q.userId]=[]),H[q.userId].push(q))}),Object.keys(H).forEach(O=>{H[O].sort((q,ae)=>{const pe=q.timestamp.toDate?q.timestamp.toDate():new Date(q.timestamp);return(ae.timestamp.toDate?ae.timestamp.toDate():new Date(ae.timestamp))-pe})}),H}else throw K}}catch(K){return console.error("Error fetching deposits:",K),{}}},J=async(y,Z,ne)=>{try{try{const K=te(X(U,"loans"),xe("userId","in",y),xe("timestamp",">=",Z),xe("timestamp","<=",ne),ce("timestamp","desc")),de=await ge(K),ee={};return de.forEach(H=>{const O={id:H.id,...H.data()};ee[O.userId]||(ee[O.userId]=[]),ee[O.userId].push(O)}),ee}catch(K){if(K.message.includes("requires an index")){console.warn("Index not found for loans query, using fallback"),i(O=>({...O,loans:K.message}));const de=te(X(U,"loans"),xe("userId","in",y)),ee=await ge(de),H={};return ee.forEach(O=>{const q={id:O.id,...O.data()},ae=q.timestamp.toDate?q.timestamp.toDate():new Date(q.timestamp);ae>=Z&&ae<=ne&&(H[q.userId]||(H[q.userId]=[]),H[q.userId].push(q))}),Object.keys(H).forEach(O=>{H[O].sort((q,ae)=>{const pe=q.timestamp.toDate?q.timestamp.toDate():new Date(q.timestamp);return(ae.timestamp.toDate?ae.timestamp.toDate():new Date(ae.timestamp))-pe})}),H}else throw K}}catch(K){return console.error("Error fetching loans:",K),{}}},G=(0,t.useCallback)(async()=>{E(!0),o(null);try{const y=await Y(),Z={};let ne=[],K=[],de,ee;h==="all"?(de=Ge(l),ee=Ke(l)):(de=dt(l,parseInt(h)),ee=ct(l,parseInt(h)));const H=y.map(A=>A.id),O=[];for(let A=0;A<H.length;A+=10)O.push(H.slice(A,A+10));const q=O.map(A=>M(A,de,ee)),ae=O.map(A=>J(A,de,ee)),pe=await Promise.all(q),ht=await Promise.all(ae),ze={},$e={};pe.forEach(A=>{Object.keys(A).forEach(Q=>{ze[Q]=A[Q],ne=[...ne,...A[Q]]})}),ht.forEach(A=>{Object.keys(A).forEach(Q=>{$e[Q]=A[Q],K=[...K,...A[Q]]})}),y.forEach(A=>{const Q=ze[A.id]||[],_e=$e[A.id]||[],bt=zs(Q,_e);Z[A.id]={user:A,deposits:Q,loans:_e,...bt}});const je=He(ne,K,l);S({labels:je.map(A=>A.month),datasets:[{label:"Deposits",data:je.map(A=>A.deposits),borderColor:"rgb(75, 192, 192)",backgroundColor:"rgba(75, 192, 192, 0.5)"},{label:"Loans",data:je.map(A=>A.loans),borderColor:"rgb(255, 99, 132)",backgroundColor:"rgba(255, 99, 132, 0.5)"}]});const Ye=Ge(l-1),Oe=Ke(l-1),gt=O.map(A=>M(A,Ye,Oe)),pt=O.map(A=>J(A,Ye,Oe)),ft=await Promise.all(gt),yt=await Promise.all(pt);let be=[],Ne=[];ft.forEach(A=>{Object.keys(A).forEach(Q=>{be=[...be,...A[Q]]})}),yt.forEach(A=>{Object.keys(A).forEach(Q=>{Ne=[...Ne,...A[Q]]})});const jt=He(be,Ne,l-1);R({currentYear:{totalDeposits:ne.reduce((A,Q)=>A+Q.amount,0),totalLoans:K.reduce((A,Q)=>A+Q.amount,0),monthlyData:je},previousYear:{totalDeposits:be.reduce((A,Q)=>A+Q.amount,0),totalLoans:Ne.reduce((A,Q)=>A+Q.amount,0),monthlyData:jt}}),P(Z),E(!1)}catch(y){console.error("Error fetching user reports:",y),o("Failed to fetch reports data"),E(!1)}},[l,h]),se=(0,t.useCallback)(y=>{T(y),w(!0)},[]),le=(0,t.useCallback)(()=>{w(!1),T(null)},[]),mt=(0,t.useCallback)(()=>{const y=Object.values(F);Ys(y,`annual-reports-${l}.csv`)},[F,l]),xt=(0,t.useCallback)(()=>{const y=Object.values(F),Z=Ms(y,l);Z.success?console.log(`PDF "${Z.filename}" generated successfully!`):console.error("Failed to generate PDF:",Z.error)},[F,l]);(0,t.useEffect)(()=>{G()},[G]);const ut=()=>{const y=[];for(let Z=s;Z>=2022;Z--)y.push(Z);return y};return(0,e.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,e.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Annual Reports"}),(L.deposits||L.loans)&&(0,e.jsx)("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6",children:(0,e.jsxs)("div",{className:"flex",children:[(0,e.jsx)("div",{className:"flex-shrink-0",children:(0,e.jsx)("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,e.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,e.jsxs)("div",{className:"ml-3",children:[(0,e.jsx)("p",{className:"text-sm text-yellow-700",children:"Some queries require Firestore indexes for optimal performance. We're using fallback queries, but you can create the indexes for better performance:"}),(0,e.jsxs)("div",{className:"mt-2",children:[L.deposits&&(0,e.jsx)("a",{href:"https://console.firebase.google.com/v1/r/project/ecommerce-74229/firestore/indexes?create_composite=ClBwcm9qZWN0cy9lY29tbWVyY2UtNzQyMjkvZGF0YWJhc2VzLyhkZWZhdWx0KS9jb2xsZWN0aW9uR3JvdXBzL2RlcG9zaXRzL2luZGV4ZXMvXxABGgoKBnVzZXJJZBABGg0KCXRpbWVzdGFtcBACGgwKCF9fbmFtZV9fEAI",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline hover:text-blue-800 mr-4",children:"Create Deposits Index"}),L.loans&&(0,e.jsx)("a",{href:"https://console.firebase.google.com/v1/r/project/ecommerce-74229/firestore/indexes?create_composite=Ck1wcm9qZWN0cy9lY29tbWVyY2UtNzQyMjkvZGF0YWJhc2VzLyhkZWZhdWx0KS9jb2xsZWN0aW9uR3JvdXBzL2xvYW5zL2luZGV4ZXMvXxABGgoKBnVzZXJJZBABGg0KCXRpbWVzdGFtcBACGgwKCF9fbmFtZV9fEAI",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline hover:text-blue-800",children:"Create Loans Index"})]})]})]})}),(0,e.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{htmlFor:"year",className:"block text-sm font-medium text-gray-700 mb-1",children:"Year"}),(0,e.jsx)("select",{id:"year",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",value:l,onChange:y=>a(parseInt(y.target.value)),children:ut().map(y=>(0,e.jsx)("option",{value:y,children:y},y))})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{htmlFor:"month",className:"block text-sm font-medium text-gray-700 mb-1",children:"Month (Optional)"}),(0,e.jsxs)("select",{id:"month",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",value:h,onChange:y=>f(y.target.value),children:[(0,e.jsx)("option",{value:"all",children:"All Months"}),(0,e.jsx)("option",{value:"1",children:"January"}),(0,e.jsx)("option",{value:"2",children:"February"}),(0,e.jsx)("option",{value:"3",children:"March"}),(0,e.jsx)("option",{value:"4",children:"April"}),(0,e.jsx)("option",{value:"5",children:"May"}),(0,e.jsx)("option",{value:"6",children:"June"}),(0,e.jsx)("option",{value:"7",children:"July"}),(0,e.jsx)("option",{value:"8",children:"August"}),(0,e.jsx)("option",{value:"9",children:"September"}),(0,e.jsx)("option",{value:"10",children:"October"}),(0,e.jsx)("option",{value:"11",children:"November"}),(0,e.jsx)("option",{value:"12",children:"December"})]})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{htmlFor:"search",className:"block text-sm font-medium text-gray-700 mb-1",children:"Search User"}),(0,e.jsx)("input",{type:"text",id:"search",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Name, email, or phone",value:x,onChange:y=>b(y.target.value)})]}),(0,e.jsx)("div",{className:"flex items-end",children:(0,e.jsx)("button",{className:"w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",onClick:G,children:"Apply Filters"})})]}),(0,e.jsxs)("div",{className:"flex flex-wrap gap-4 items-center",children:[(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("input",{id:"showUnpaid",type:"checkbox",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",checked:u,onChange:y=>C(y.target.checked)}),(0,e.jsx)("label",{htmlFor:"showUnpaid",className:"ml-2 block text-sm text-gray-700",children:"Show only users with unpaid loans"})]}),(0,e.jsx)("button",{className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2",onClick:mt,children:"Export CSV"}),(0,e.jsx)("button",{className:"bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2",onClick:xt,children:"Export PDF"})]})]}),r&&(0,e.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,e.jsx)("h2",{className:"text-lg font-medium text-gray-800 mb-4",children:"Year Comparison"}),(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"text-md font-medium text-gray-700 mb-2",children:"Total Deposits"}),(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsxs)("div",{className:"text-2xl font-bold text-green-600",children:["$",r.currentYear.totalDeposits.toFixed(2)]}),(0,e.jsxs)("div",{className:"ml-4 text-sm text-gray-500",children:[r.currentYear.totalDeposits>r.previousYear.totalDeposits?(0,e.jsxs)("span",{className:"text-green-600",children:["â†‘ ",((r.currentYear.totalDeposits-r.previousYear.totalDeposits)/r.previousYear.totalDeposits*100).toFixed(1),"%"]}):(0,e.jsxs)("span",{className:"text-red-600",children:["â†“ ",((r.previousYear.totalDeposits-r.currentYear.totalDeposits)/r.previousYear.totalDeposits*100).toFixed(1),"%"]}),(0,e.jsxs)("span",{children:[" vs ",l-1]})]})]})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"text-md font-medium text-gray-700 mb-2",children:"Total Loans"}),(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsxs)("div",{className:"text-2xl font-bold text-blue-600",children:["$",r.currentYear.totalLoans.toFixed(2)]}),(0,e.jsxs)("div",{className:"ml-4 text-sm text-gray-500",children:[r.currentYear.totalLoans>r.previousYear.totalLoans?(0,e.jsxs)("span",{className:"text-green-600",children:["â†‘ ",((r.currentYear.totalLoans-r.previousYear.totalLoans)/r.previousYear.totalLoans*100).toFixed(1),"%"]}):(0,e.jsxs)("span",{className:"text-red-600",children:["â†“ ",((r.previousYear.totalLoans-r.currentYear.totalLoans)/r.previousYear.totalLoans*100).toFixed(1),"%"]}),(0,e.jsxs)("span",{children:[" vs ",l-1]})]})]})]})]})]}),V&&(0,e.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,e.jsx)("h2",{className:"text-lg font-medium text-gray-800 mb-4",children:"Deposits vs Loans by Month"}),(0,e.jsx)("div",{className:"h-64",children:(0,e.jsx)(Wt,{data:V,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},title:{display:!1}}}})})]}),(0,e.jsxs)("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[(0,e.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,e.jsx)("h2",{className:"text-lg font-medium text-gray-800",children:"Users Summary"})}),_?(0,e.jsx)("div",{className:"px-6 py-4 text-center",children:(0,e.jsx)("p",{className:"text-gray-500",children:"Loading reports..."})}):$?(0,e.jsx)("div",{className:"px-6 py-4 text-center",children:(0,e.jsx)("p",{className:"text-red-500",children:$})}):p.length===0?(0,e.jsx)("div",{className:"px-6 py-4 text-center",children:(0,e.jsx)("p",{className:"text-gray-500",children:"No users found"})}):(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Deposits"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Loans"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Paid Loans"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unpaid Loans"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:W.map(y=>(0,e.jsxs)("tr",{className:y.unpaidLoansCount>0?"border-l-4 border-red-500":"",children:[(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("div",{className:"flex-shrink-0 h-10 w-10",children:(0,e.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:(0,e.jsx)("span",{className:"text-gray-600 font-medium",children:y.user.name?y.user.name.charAt(0).toUpperCase():"U"})})}),(0,e.jsxs)("div",{className:"ml-4",children:[(0,e.jsx)("div",{className:"text-sm font-medium text-gray-900",children:y.user.name||"Unknown User"}),(0,e.jsx)("div",{className:"text-sm text-gray-500",children:y.user.email||"N/A"})]})]})}),(0,e.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["$",y.totalDeposits.toFixed(2)]}),(0,e.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["$",y.totalLoans.toFixed(2)]}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:y.paidLoansCount}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${y.unpaidLoansCount>0?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:y.unpaidLoansCount})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,e.jsx)("button",{onClick:()=>se(y.user.id),className:"text-blue-600 hover:text-blue-900",children:"View Details"})})]},y.user.id))})]})}),d>1&&(0,e.jsxs)("div",{className:"px-6 py-3 flex items-center justify-between border-t border-gray-200",children:[(0,e.jsxs)("div",{className:"flex-1 flex justify-between sm:hidden",children:[(0,e.jsx)("button",{onClick:()=>k(y=>Math.max(y-1,1)),disabled:j===1,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Previous"}),(0,e.jsx)("button",{onClick:()=>k(y=>Math.min(y+1,d)),disabled:j===d,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Next"})]}),(0,e.jsxs)("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[(0,e.jsx)("div",{children:(0,e.jsxs)("p",{className:"text-sm text-gray-700",children:["Showing ",(0,e.jsx)("span",{className:"font-medium",children:z+1})," to"," ",(0,e.jsx)("span",{className:"font-medium",children:Math.min(B,p.length)})," of"," ",(0,e.jsx)("span",{className:"font-medium",children:p.length})," results"]})}),(0,e.jsx)("div",{children:(0,e.jsxs)("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[(0,e.jsx)("button",{onClick:()=>k(y=>Math.max(y-1,1)),disabled:j===1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50",children:"Previous"}),Array.from({length:d},(y,Z)=>Z+1).map(y=>(0,e.jsx)("button",{onClick:()=>k(y),className:`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${j===y?"z-10 bg-blue-50 border-blue-500 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,children:y},y)),(0,e.jsx)("button",{onClick:()=>k(y=>Math.min(y+1,d)),disabled:j===d,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50",children:"Next"})]})})]})]})]})]}),N&&(0,e.jsx)(_s,{isOpen:I,onClose:le,user:F[N].user,deposits:F[N].deposits,loans:F[N].loans})]})},Ws=Vs,qs=({onAccessGranted:s})=>{const[l,a]=(0,t.useState)(""),[h,f]=(0,t.useState)(!1),[x,b]=(0,t.useState)(""),[u,C]=(0,t.useState)(""),[m,g]=(0,t.useState)(!1),[F,P]=(0,t.useState)(""),[N,T]=(0,t.useState)(""),[I,w]=(0,t.useState)(""),[c,S]=(0,t.useState)(!1),[v,R]=(0,t.useState)(!1),[_,E]=(0,t.useState)(!1),$="Communitysavings4@gmail.com";(0,t.useEffect)(()=>{if(N){R(!0);const D=setTimeout(()=>{R(!1),setTimeout(()=>T(""),500)},3e3);return()=>clearTimeout(D)}},[N]),(0,t.useEffect)(()=>{if(I){E(!0);const D=setTimeout(()=>{E(!1),setTimeout(()=>{w(""),m&&g(!1)},500)},3e3);return()=>clearTimeout(D)}},[I,m]);const o=async D=>{D.preventDefault(),S(!0);try{const n=re(U,"adminSettings","security"),p=await Ve(n);if(p.exists()){const{password:d}=p.data();l===d?s():T("Incorrect password. Please try again.")}else T("Admin settings not found. Please contact support.")}catch(n){console.error("Error fetching admin password:",n),T("Failed to verify password. Please try again.")}finally{S(!1)}},L=async D=>{D.preventDefault(),S(!0);try{const n=ls(),p=new Date;p.setMinutes(p.getMinutes()+15),await tt(re(U,"passwordResets",n),{token:n,expiresAt:p,used:!1});const d=`${window.location.origin}/admin-login?reset=true&token=${n}`;await ds.send("service_rbtk5y8","template_i85brpa",{to_email:$,reset_link:d},"zcAI9wNXtOd3ooJ67"),w("Password reset email sent! Check your inbox."),setTimeout(()=>{f(!1)},3e3)}catch(n){console.error("Error sending password reset email:",n),T("Failed to send reset email. Please try again.")}finally{S(!1)}},i=async D=>{if(D.preventDefault(),x!==u){T("Passwords do not match.");return}if(x.length<6){T("Password must be at least 6 characters long.");return}S(!0);try{const n=re(U,"adminSettings","security");await me(n,{password:x});const p=re(U,"passwordResets",F);await me(p,{used:!0}),w("Password updated successfully!"),b(""),C(""),setTimeout(()=>{window.location.href="/admin-login"},3e3)}catch(n){console.error("Error updating password:",n),T("Failed to update password. Please try again.")}finally{S(!1)}};return(0,t.useEffect)(()=>{const D=new URLSearchParams(window.location.search),n=D.get("reset"),p=D.get("token");n==="true"&&p&&(async()=>{try{const z=re(U,"passwordResets",p),B=await Ve(z);if(!B.exists()){T("Invalid or expired reset link.");return}const W=B.data();if(W.used||new Date>W.expiresAt.toDate()){T("This reset link has expired.");return}g(!0),P(p)}catch(z){console.error("Error verifying reset token:",z),T("Failed to verify reset link.")}})()},[]),m?(0,e.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,e.jsxs)("div",{className:"bg-white shadow-lg rounded-2xl p-8 w-96 max-w-md",children:[(0,e.jsx)("h2",{className:"text-2xl font-bold text-center mb-6 text-gray-800",children:"Reset Admin Password"}),(0,e.jsxs)("form",{onSubmit:i,children:[(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"New Password"}),(0,e.jsx)("input",{type:"password",id:"newPassword",value:x,onChange:D=>b(D.target.value),className:"border border-gray-300 rounded-md p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-full transition-colors",required:!0})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm New Password"}),(0,e.jsx)("input",{type:"password",id:"confirmPassword",value:u,onChange:D=>C(D.target.value),className:"border border-gray-300 rounded-md p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-full transition-colors",required:!0})]}),(0,e.jsx)("button",{type:"submit",disabled:c,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md w-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Updating...":"Reset Password"})]}),(0,e.jsx)("div",{className:"mt-4 text-center",children:(0,e.jsx)("button",{onClick:()=>g(!1),className:"text-blue-600 text-sm hover:underline",children:"Back to login"})}),N&&(0,e.jsx)("div",{className:`text-red-500 mt-4 transition-opacity duration-500 ${v?"opacity-100":"opacity-0"}`,children:N}),I&&(0,e.jsx)("div",{className:`text-green-500 mt-4 transition-opacity duration-500 ${_?"opacity-100":"opacity-0"}`,children:I})]})}):(0,e.jsxs)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:[(0,e.jsxs)("div",{className:"bg-white shadow-lg rounded-2xl p-8 w-96 max-w-md",children:[(0,e.jsx)("h2",{className:"text-2xl font-bold text-center mb-6 text-gray-800",children:"Admin Access"}),(0,e.jsxs)("form",{onSubmit:o,children:[(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,e.jsx)("input",{type:"password",id:"password",value:l,onChange:D=>a(D.target.value),className:"border border-gray-300 rounded-md p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-full transition-colors",required:!0})]}),(0,e.jsx)("button",{type:"submit",disabled:c,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md w-full mt-4 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Verifying...":"Access Admin Dashboard"})]}),N&&(0,e.jsx)("div",{className:`text-red-500 mt-2 transition-opacity duration-500 ${v?"opacity-100":"opacity-0"}`,children:N}),I&&(0,e.jsx)("div",{className:`text-green-500 mt-2 transition-opacity duration-500 ${_?"opacity-100":"opacity-0"}`,children:I}),(0,e.jsx)("div",{className:"text-blue-600 text-sm mt-3 hover:underline cursor-pointer text-center",onClick:()=>f(!0),children:"Forgot password?"})]}),h&&(0,e.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:(0,e.jsxs)("div",{className:"bg-white shadow-lg rounded-2xl p-8 w-96 max-w-md",children:[(0,e.jsx)("h2",{className:"text-xl font-bold text-center mb-4 text-gray-800",children:"Reset Password"}),(0,e.jsx)("p",{className:"text-gray-600 text-sm mb-6",children:"A reset link will be sent to the admin email."}),(0,e.jsx)("div",{className:"mb-6 p-3 bg-gray-100 rounded-md",children:(0,e.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,e.jsx)("span",{className:"font-medium",children:"Email:"})," ",$]})}),(0,e.jsx)("form",{onSubmit:L,children:(0,e.jsxs)("div",{className:"flex space-x-3",children:[(0,e.jsx)("button",{type:"button",onClick:()=>f(!1),className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-md w-1/2 transition-colors",children:"Cancel"}),(0,e.jsx)("button",{type:"submit",disabled:c,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md w-1/2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Sending...":"Send Reset Link"})]})}),N&&(0,e.jsx)("div",{className:`text-red-500 mt-4 transition-opacity duration-500 ${v?"opacity-100":"opacity-0"}`,children:N}),I&&(0,e.jsx)("div",{className:`text-green-500 mt-4 transition-opacity duration-500 ${_?"opacity-100":"opacity-0"}`,children:I})]})})]})},Gs=qs;function Ks({children:s}){const{currentUser:l}=ue();return l?s:(0,e.jsx)(et,{to:"/login"})}function Xe({children:s}){const{currentUser:l}=ue();return l?(0,e.jsx)(et,{to:"/dashboard"}):s}function Zs(){const[s,l]=(0,t.useState)(!1);return s?(0,e.jsxs)(Dt,{children:[(0,e.jsx)(oe,{path:"/login",element:(0,e.jsx)(Xe,{children:(0,e.jsx)(ps,{})})}),(0,e.jsx)(oe,{path:"/signup",element:(0,e.jsx)(Xe,{children:(0,e.jsx)(fs,{})})}),(0,e.jsxs)(oe,{path:"/",element:(0,e.jsx)(Ks,{children:(0,e.jsx)(As,{})}),children:[(0,e.jsx)(oe,{index:!0,element:(0,e.jsx)(qe,{})}),(0,e.jsx)(oe,{path:"profile",element:(0,e.jsx)(js,{})}),(0,e.jsx)(oe,{path:"dashboard",element:(0,e.jsx)(qe,{})}),(0,e.jsx)(oe,{path:"deposits",element:(0,e.jsx)(Ss,{})}),(0,e.jsx)(oe,{path:"loans",element:(0,e.jsx)(Es,{})}),(0,e.jsx)(oe,{path:"payback",element:(0,e.jsx)(ws,{})}),(0,e.jsx)(oe,{path:"users",element:(0,e.jsx)(Us,{})}),(0,e.jsx)(oe,{path:"settings",element:(0,e.jsx)(Is,{})}),(0,e.jsx)(oe,{path:"chat",element:(0,e.jsx)(ks,{})}),(0,e.jsx)(oe,{path:"annual-reports",element:(0,e.jsx)(Ws,{})})]})]}):(0,e.jsx)(Gs,{onAccessGranted:()=>l(!0)})}var Hs=Zs;(0,hs.createRoot)(document.getElementById("root")).render((0,e.jsx)(t.StrictMode,{children:(0,e.jsx)(gs,{children:(0,e.jsx)(kt,{children:(0,e.jsx)(Hs,{})})})}));
