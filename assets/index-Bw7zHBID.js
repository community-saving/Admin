import{o as Ce}from"./rolldown-runtime-O3PcEg2i.js";import{a as Ae,c as Le,d as wt,i as Pe,l as Ee,n as et,o as Fe,r as Ue,s as Be,t as vt}from"./charting-BTEZ5LFh.js";import{t as St}from"./react-dom-B_yxW9B6.js";import{a as oe,c as Ie,i as Dt,n as Re,o as Ct,r as tt,s as kt,t as At}from"./react-router-DN1Q4BFP.js";import{_ as Lt,a as pe,b as Pt,c as ie,d as xe,f as st,g as Et,h as Ft,i as We,l as me,m as ue,n as Q,o as Ut,p as ce,r as ae,s as Tt,t as It,u as te,v as Rt,y as Mt}from"./firebase-CyM-FwhB.js";import{a as zt,c as $t,i as Yt,l as Ot,n as _t,o as Bt,r as Wt,s as Vt,t as qt,u as Gt}from"./react-CbSgh8yl.js";import{C as Kt,E as Zt,S as Ht,T as Qt,_ as ve,a as ye,b as Te,c as Xt,d as Jt,f as at,g as Se,h as rt,i as Ve,l as qe,m as Me,n as es,o as ts,p as ss,r as nt,s as as,t as De,u as rs,v as it,w as ns,x as is,y as fe}from"./lucide-icons-Bp_f-v-j.js";import{Bt as lt,Ft as ls,Ht as os,It as ds,Lt as cs,Rt as ms,Vt as xs,zt as us}from"./vendor-C04N904u.js";(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))p(f);new MutationObserver(f=>{for(const x of f)if(x.type==="childList")for(const j of x.addedNodes)j.tagName==="LINK"&&j.rel==="modulepreload"&&p(j)}).observe(document,{childList:!0,subtree:!0});function n(f){const x={};return f.integrity&&(x.integrity=f.integrity),f.referrerPolicy&&(x.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?x.credentials="include":f.crossOrigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function p(f){if(f.ep)return;f.ep=!0;const x=n(f);fetch(f.href,x)}})();var hs=Ce(St()),t=Ce(wt()),ot=Pt({apiKey:"AIzaSyAGm3bzsCxYSARcgVn41ta_EOut9fauWr0",authDomain:"ecommerce-74229.firebaseapp.com",projectId:"ecommerce-74229",storageBucket:"ecommerce-74229.firebasestorage.app",messagingSenderId:"47160479095",appId:"1:47160479095:web:0dd3a844d5d5c3847ea572",measurementId:"G-47FYXTR59Z"}),we=Et(ot),U=Ut(ot),e=Ce(Gt()),dt=(0,t.createContext)();const he=()=>(0,t.useContext)(dt),ps=({children:r})=>{const[d,n]=(0,t.useState)(null),[p,f]=(0,t.useState)(!0),x=(m,g)=>Ft(we,m,g),j=(m,g)=>Rt(we,m,g),u=()=>Mt(we);(0,t.useEffect)(()=>Lt(we,m=>{n(m),f(!1)}),[]);const D={currentUser:d,signup:x,login:j,logout:u};return(0,e.jsx)(dt.Provider,{value:D,children:p?(0,e.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):r})};function gs(){const r=(0,t.useRef)(),d=(0,t.useRef)(),{login:n}=he(),p=Ie(),[f,x]=(0,t.useState)(""),[j,u]=(0,t.useState)(!1),D=async m=>{m.preventDefault();try{x(""),u(!0),await n(r.current.value,d.current.value),p("/dashboard")}catch{x("Failed to sign in. Please check your credentials and try again.")}u(!1)};return(0,e.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-400 to-gray-100 p-4",children:(0,e.jsx)("div",{className:"w-full max-w-md",children:(0,e.jsxs)("form",{onSubmit:D,className:"bg-white p-8 rounded-2xl shadow-lg border border-gray-100",children:[(0,e.jsxs)("div",{className:"text-center mb-8",children:[(0,e.jsx)("div",{className:"mx-auto w-16 h-16 bg-indigo-600 rounded-full flex items-center justify-center mb-4",children:(0,e.jsx)("span",{className:"text-white font-bold text-xl",children:"MB"})}),(0,e.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Welcome Back"}),(0,e.jsx)("p",{className:"text-gray-600 mt-2",children:"Sign in to your account"})]}),f&&(0,e.jsx)("div",{className:"bg-red-50 text-red-700 p-3 rounded-lg mb-6 text-sm",children:f}),(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,e.jsx)("input",{type:"email",id:"email",ref:r,placeholder:"Enter your email",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,e.jsx)("input",{type:"password",id:"password",ref:d,placeholder:"Enter your password",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,e.jsx)("button",{disabled:j,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white p-2 rounded-lg transition-colors duration-200 disabled:opacity-50",children:j?"Signing In...":"Sign In"}),(0,e.jsxs)("p",{className:"mt-6 text-center text-gray-600",children:["Don't have an account?"," ",(0,e.jsx)(Re,{to:"/signup",className:"text-indigo-600 hover:text-indigo-800 font-medium",children:"Sign Up"})]})]})})})}function fs(){const r=(0,t.useRef)(),d=(0,t.useRef)(),n=(0,t.useRef)(),{signup:p}=he(),f=Ie(),[x,j]=(0,t.useState)(""),[u,D]=(0,t.useState)(!1),m=async g=>{if(g.preventDefault(),d.current.value!==n.current.value)return j("Passwords do not match");if(d.current.value.length<6)return j("Password should be at least 6 characters");try{j(""),D(!0),await p(r.current.value,d.current.value),f("/dashboard")}catch{j("Failed to create an account. Please try again.")}D(!1)};return(0,e.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-400 to-gray-100 p-4",children:(0,e.jsx)("div",{className:"w-full max-w-md",children:(0,e.jsxs)("form",{onSubmit:m,className:"bg-white p-8 rounded-2xl shadow-lg border border-gray-100",children:[(0,e.jsxs)("div",{className:"text-center mb-8",children:[(0,e.jsx)("div",{className:"mx-auto w-16 h-16 bg-indigo-600 rounded-full flex items-center justify-center mb-4",children:(0,e.jsx)("span",{className:"text-white font-bold text-xl",children:"MB"})}),(0,e.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Create Account"}),(0,e.jsx)("p",{className:"text-gray-600 mt-2",children:"Sign up to get started"})]}),x&&(0,e.jsx)("div",{className:"bg-red-50 text-red-700 p-3 rounded-lg mb-6 text-sm",children:x}),(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,e.jsx)("input",{type:"email",id:"email",ref:r,placeholder:"Enter your email",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,e.jsx)("input",{type:"password",id:"password",ref:d,placeholder:"Create a password",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm Password"}),(0,e.jsx)("input",{type:"password",id:"confirmPassword",ref:n,placeholder:"Confirm your password",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,e.jsx)("button",{disabled:u,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white p-2 rounded-lg transition-colors duration-200 disabled:opacity-50",children:u?"Creating Account...":"Sign Up"}),(0,e.jsxs)("p",{className:"mt-6 text-center text-gray-600",children:["Already have an account?"," ",(0,e.jsx)(Re,{to:"/login",className:"text-indigo-600 hover:text-indigo-800 font-medium",children:"Sign In"})]})]})})})}var ys=()=>(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{children:[(0,e.jsx)("h1",{children:"Create your porfile"}),(0,e.jsxs)("form",{action:"",children:[(0,e.jsx)("input",{type:"text",placeholder:"Your full name "}),(0,e.jsx)("input",{type:"email",placeholder:"Your email",name:"",id:""}),(0,e.jsx)("input",{type:"number",placeholder:"You phone number ",name:"",id:""}),(0,e.jsx)("input",{type:"number",placeholder:"You Age  ",name:"",id:""}),(0,e.jsxs)("option",{value:"",children:[(0,e.jsx)("select",{name:"male",id:"",children:"Male"}),(0,e.jsx)("select",{name:"female",id:"",children:"Female"})]}),(0,e.jsx)("input",{type:"file",placeholder:"Upload your photo"}),(0,e.jsx)("button",{type:"submit",children:"Create account"})]})]})}),js=ys,bs=()=>{const[r,d]=(0,t.useState)(0),[n,p]=(0,t.useState)(0),[f,x]=(0,t.useState)(0),[j,u]=(0,t.useState)(0),[D,m]=(0,t.useState)(!1),[g,E]=(0,t.useState)(!1),[C,b]=(0,t.useState)(!1),[F,T]=(0,t.useState)([]),[N,c]=(0,t.useState)([]),[S,w]=(0,t.useState)([]),[I,Y]=(0,t.useState)(!0),[L,O]=(0,t.useState)({width:window.innerWidth,height:window.innerHeight});(0,t.useEffect)(()=>{const l=()=>{O({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]);const W=l=>new Date(l).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",hour12:!0});(0,t.useEffect)(()=>{if(!U){b("Firestore instance not available"),Y(!1);return}const l=te(Q(U,"users"),me("createdAt","desc")),P=ie(l,M=>{try{const _=M.docs.map(B=>({id:B.id,...B.data()}));w(_),u(_.length),Y(!1),b(!1)}catch(_){console.error("Error processing users snapshot:",_),b("Failed to process users data"),Y(!1)}},M=>{console.error("Error fetching users:",M),M.code==="permission-denied"?b("Permission denied. Check Firestore rules."):b("Failed to load users: "+(M.message||"Unknown error")),Y(!1)});return()=>P()},[]);const X=({active:l,payload:P,label:M})=>{if(l&&P&&P.length){const _=P[0].payload,B=L.width<768;return(0,e.jsxs)("div",{className:`bg-white border border-gray-200 shadow-lg rounded-md ${B?"p-2":"p-4"}`,children:[(0,e.jsx)("p",{className:`font-medium text-gray-900 ${B?"text-xs":"text-sm"}`,children:W(_.timestamp)}),(0,e.jsxs)("p",{className:`text-indigo-600 ${B?"text-xs":"text-sm"}`,children:["Deposits: $",_.deposits.toFixed(2)]}),(0,e.jsxs)("p",{className:`text-red-600 ${B?"text-xs":"text-sm"}`,children:["loans: $",_.loans.toFixed(2)]})]})}return null},h=(l,P,M=20)=>{const _=[];return l.forEach(B=>{const i=B.timestamp?.toDate?.()||new Date(B.timestamp);_.push({timestamp:i,name:i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),deposits:Number(B.amount)||0,loans:0})}),P.forEach(B=>{const i=B.timestamp?.toDate?.()||new Date(B.timestamp);_.push({timestamp:i,name:i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),deposits:0,loans:Number(B.amount)||0})}),_.sort((B,i)=>B.timestamp-i.timestamp),_.slice(-M)};(0,t.useEffect)(()=>{if(!U){console.error("Firestore database instance not available"),m(!0),E(!0);return}let l=[],P=[];const M=te(Q(U,"deposits"),me("timestamp","desc")),_=ie(M,z=>{try{let R=0;l=[],z.forEach(q=>{const se=q.data();se.amount&&(R+=parseFloat(se.amount)),l.push({id:q.id,...se,timestamp:se.timestamp})}),d(R),m(!1);const J=h(l,P);T(J),c(q=>[...l.slice(0,3).map(se=>({id:se.id,type:"deposit",userId:se.userId,amount:se.amount,timestamp:se.timestamp?.toDate?.()||new Date})),...q].slice(0,6))}catch(R){console.error("Error processing deposits data:",R),m(!0)}},z=>{console.error("Error fetching deposits:",z),m(!0)}),B=te(Q(U,"loans"),me("timestamp","desc")),i=ie(B,z=>{try{let R=0,J=0;P=[],z.forEach(se=>{const le=se.data();le.amount&&(R+=parseFloat(le.amount)),le.status==="pending"&&(J+=1),P.push({id:se.id,...le,timestamp:le.timestamp})}),p(R),x(J),E(!1);const q=h(l,P);T(q),c(se=>[...P.slice(0,3).map(le=>({id:le.id,type:"cashout",userId:le.userId,amount:le.amount,status:le.status,timestamp:le.timestamp?.toDate?.()||new Date})),...se].slice(0,6))}catch(R){console.error("Error processing loans data:",R),E(!0)}},z=>{console.error("Error fetching loans:",z),E(!0)});return()=>{_(),i()}},[]);const v=l=>`$${l.toFixed(2)}`,A=l=>new Date(l).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),a=[{id:1,name:"Total Deposits",value:D?"N/A":v(r),change:"+12.5%",changeType:"positive",icon:Se,iconColor:"bg-indigo-500"},{id:2,name:"Total loans",value:g?"N/A":v(n),change:"+8.2%",changeType:"positive",icon:ve,iconColor:"bg-red-500"},{id:3,name:"Pending loans",value:g?"N/A":f,change:"+3.1%",changeType:"negative",icon:Zt,iconColor:"bg-yellow-500"},{id:4,name:"Total Users",value:C?"N/A":j,change:"+5.4%",changeType:"positive",icon:nt,iconColor:"bg-green-500"}],o=(()=>{const l=L.width<768,P=L.width>=768&&L.width<1024;return{margin:{top:l?5:10,right:l?10:30,left:l?5:20,bottom:l?10:5},tickFontSize:l?8:P?10:12,interval:l?"preserveStartEnd":0,minTickGap:l?10:15,barSize:l?10:15,animationDuration:l?500:800,gridStrokeDasharray:l?"2 2":"3 3"}})();return I?(0,e.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading dashboard..."})]})}):(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6",children:a.map(l=>(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-4 sm:p-6 transition-all duration-200 hover:shadow-md",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-xs sm:text-sm font-medium text-gray-500",children:l.name}),(0,e.jsx)("p",{className:"mt-1 sm:mt-2 text-2xl sm:text-3xl font-bold text-gray-900",children:l.value})]}),(0,e.jsx)("div",{className:`p-2 sm:p-3 rounded-full ${l.iconColor}`,children:(0,e.jsx)(l.icon,{className:"h-5 w-5 sm:h-6 sm:w-6 text-white"})})]}),(0,e.jsxs)("div",{className:"mt-3 sm:mt-4 flex items-center",children:[l.changeType==="positive"?(0,e.jsx)(ns,{className:"h-3 w-3 sm:h-4 sm:w-4 text-green-500"}):(0,e.jsx)(Qt,{className:"h-3 w-3 sm:h-4 sm:w-4 text-red-500"}),(0,e.jsx)("span",{className:`ml-1 text-xs sm:text-sm font-medium ${l.changeType==="positive"?"text-green-500":"text-red-500"}`,children:l.change}),(0,e.jsx)("span",{className:"ml-1 sm:ml-2 text-xs sm:text-sm text-gray-500",children:"from last month"})]})]},l.id))}),(0,e.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-4 sm:p-6",children:[(0,e.jsx)("h3",{className:"text-base sm:text-lg font-medium text-gray-900 mb-3 sm:mb-4",children:"Live Transactions"}),(0,e.jsx)("div",{className:"h-64 sm:h-80 overflow-x-auto",children:(0,e.jsx)(Ee,{width:"100%",height:"100%",minWidth:300,children:(0,e.jsxs)(vt,{data:F,margin:o.margin,children:[(0,e.jsx)(Fe,{strokeDasharray:o.gridStrokeDasharray}),(0,e.jsx)(Pe,{dataKey:"name",tick:{fontSize:o.tickFontSize},interval:o.interval,minTickGap:o.minTickGap}),(0,e.jsx)(Ue,{tick:{fontSize:o.tickFontSize}}),(0,e.jsx)(Le,{content:(0,e.jsx)(X,{})}),(0,e.jsx)(Be,{dataKey:"deposits",fill:"#4f46e5",name:"Deposits",barSize:o.barSize,isAnimationActive:!0,animationDuration:o.animationDuration,animationEasing:"ease-in-out"}),(0,e.jsx)(Be,{dataKey:"loans",fill:"#ef4444",name:"loans",barSize:o.barSize,isAnimationActive:!0,animationDuration:o.animationDuration,animationEasing:"ease-in-out"})]})})})]}),(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-4 sm:p-6",children:[(0,e.jsx)("h3",{className:"text-base sm:text-lg font-medium text-gray-900 mb-3 sm:mb-4",children:"Transaction Trend"}),(0,e.jsx)("div",{className:"h-64 sm:h-80 overflow-x-auto",children:(0,e.jsx)(Ee,{width:"100%",height:"100%",minWidth:300,children:(0,e.jsxs)(et,{data:F,margin:o.margin,children:[(0,e.jsx)(Fe,{strokeDasharray:o.gridStrokeDasharray}),(0,e.jsx)(Pe,{dataKey:"name",tick:{fontSize:o.tickFontSize},interval:o.interval,minTickGap:o.minTickGap}),(0,e.jsx)(Ue,{tick:{fontSize:o.tickFontSize}}),(0,e.jsx)(Le,{content:(0,e.jsx)(X,{})}),(0,e.jsx)(Ae,{type:"monotone",dataKey:"deposits",stroke:"#4f46e5",activeDot:{r:L.width<768?4:8},name:"Deposits",strokeWidth:L.width<768?1.5:2,isAnimationActive:!0,animationDuration:o.animationDuration,animationEasing:"ease-in-out"}),(0,e.jsx)(Ae,{type:"monotone",dataKey:"loans",stroke:"#ef4444",name:"loans",strokeWidth:L.width<768?1.5:2,isAnimationActive:!0,animationDuration:o.animationDuration,animationEasing:"ease-in-out"})]})})})]})]}),(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-4 sm:p-6",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:[(0,e.jsx)("h3",{className:"text-base sm:text-lg font-medium text-gray-900",children:"Recent Activity"}),(0,e.jsx)("button",{className:"text-sm font-medium text-indigo-600 hover:text-indigo-800",children:"View all"})]}),(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{scope:"col",className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),(0,e.jsx)("th",{scope:"col",className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User ID"}),(0,e.jsx)("th",{scope:"col",className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,e.jsx)("th",{scope:"col",className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{scope:"col",className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:N.length>0?N.map(l=>(0,e.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[(0,e.jsx)("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap",children:(0,e.jsxs)("div",{className:"flex items-center",children:[l.type==="deposit"?(0,e.jsx)("div",{className:"w-6 h-6 sm:w-8 sm:h-8 rounded-full bg-indigo-100 flex items-center justify-center",children:(0,e.jsx)(Se,{className:"h-3 w-3 sm:h-4 sm:w-4 text-indigo-600"})}):(0,e.jsx)("div",{className:"w-6 h-6 sm:w-8 sm:h-8 rounded-full bg-red-100 flex items-center justify-center",children:(0,e.jsx)(ve,{className:"h-3 w-3 sm:h-4 sm:w-4 text-red-600"})}),(0,e.jsx)("span",{className:"ml-2 sm:ml-3 text-xs sm:text-sm font-medium text-gray-900 capitalize",children:l.type})]})}),(0,e.jsx)("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500",children:l.userId||"N/A"}),(0,e.jsx)("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm font-medium text-gray-900",children:v(l.amount||0)}),(0,e.jsx)("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap",children:l.type==="deposit"?(0,e.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800",children:"Completed"}):(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${l.status==="Pending"?"bg-yellow-100 text-yellow-800":l.status==="Accepted"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:l.status||"Pending"})}),(0,e.jsx)("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500",children:A(l.timestamp)})]},l.id)):(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:"5",className:"px-3 sm:px-6 py-3 sm:py-4 text-center text-xs sm:text-sm text-gray-500",children:"No recent activity"})})})]})})]})]})},Ge=bs,Ns=()=>{const{currentUser:r}=he(),[d,n]=(0,t.useState)([]),[p,f]=(0,t.useState)([]),[x,j]=(0,t.useState)(!0),[u,D]=(0,t.useState)(null),[m,g]=(0,t.useState)(""),[E,C]=(0,t.useState)(null),[b,F]=(0,t.useState)(!1),[T,N]=(0,t.useState)(new Set);(0,t.useEffect)(()=>{if(!r)return;const h=ie(Q(U,"users"),v=>{const A=[];v.forEach(a=>{A.push({id:a.id,...a.data()})}),f(A)},v=>{console.error("Error fetching users:",v)});return()=>h()},[r]),(0,t.useEffect)(()=>{if(!r)return;const h=ie(Q(U,"loans"),v=>{const A=[];v.forEach(a=>{A.push({id:a.id,...a.data()})}),A.sort((a,s)=>{const o=a.paymentTimestamp?.toDate?.()||new Date(0);return(s.paymentTimestamp?.toDate?.()||new Date(0))-o}),n(A),j(!1)},v=>{console.error("Error fetching paybacks:",v),j(!1)});return()=>h()},[r]);const c=d.map(h=>{const v=p.find(A=>A.uid===h.userId);return{...h,userName:v?.fullName||"Unknown User",userEmail:v?.email||"No email provided"}}),S=(h,v)=>{D({message:h,type:v}),setTimeout(()=>{D(null)},3e3)},w=async h=>{try{N(v=>new Set(v).add(h)),setTimeout(async()=>{const v=ae(U,"loans",h);await ce(v,{paymentStatus:"approved",adminReviewedAt:xe()}),setTimeout(()=>{N(A=>{const a=new Set(A);return a.delete(h),a})},300),S("Payment approved successfully!","success")},100)}catch(v){console.error("Error approving payment:",v),S("Failed to approve payment. Please try again.","error"),N(A=>{const a=new Set(A);return a.delete(h),a})}},I=async h=>{try{N(v=>new Set(v).add(h)),setTimeout(async()=>{const v=ae(U,"loans",h);await ce(v,{paymentStatus:"denied",adminReviewedAt:xe()}),setTimeout(()=>{N(A=>{const a=new Set(A);return a.delete(h),a})},300),S("Payment denied.","error")},100)}catch(v){console.error("Error denying payment:",v),S("Failed to deny payment. Please try again.","error"),N(A=>{const a=new Set(A);return a.delete(h),a})}},Y=h=>{C(h),F(!0)},L=()=>{F(!1),C(null)},O=h=>{if(!h)return"N/A";const v=h.toDate(),A=v.getDate().toString().padStart(2,"0"),a=(v.getMonth()+1).toString().padStart(2,"0"),s=v.getFullYear(),o=v.getHours().toString().padStart(2,"0"),l=v.getMinutes().toString().padStart(2,"0");return`${A}/${a}/${s} ${o}:${l}`},W=c.filter(h=>{if(h.status!=="accepted")return!1;const v=h.userName||"",A=m.toLowerCase();return v.toLowerCase().includes(A)}),X=c.filter(h=>h.status==="accepted"&&h.paymentStatus==="pending").length;return(0,e.jsxs)("div",{className:"min-h-screen bg-gray-50 py-8",children:[u&&(0,e.jsx)("div",{className:`fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-lg transform transition-all duration-300 ${u.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:u.message}),(0,e.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,e.jsxs)("div",{className:"mb-8",children:[(0,e.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Loan Repayment Management"}),(0,e.jsx)("p",{className:"mt-2 text-gray-600",children:"Review and manage loan repayments for accepted loans"})]}),(0,e.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6 mb-6",children:(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,e.jsx)(ye,{className:"h-5 w-5 text-gray-400"})}),(0,e.jsx)("input",{type:"text",placeholder:"Search by user name...",value:m,onChange:h=>g(h.target.value),className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]})}),(0,e.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[(0,e.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,e.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Accepted Loan Repayments"}),(0,e.jsxs)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800",children:[X," pending"]})]}),x?(0,e.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mb-4"}),(0,e.jsx)("p",{className:"text-gray-600",children:"Loading loan repayments..."})]}):W.length===0?(0,e.jsxs)("div",{className:"text-center py-12",children:[(0,e.jsx)("div",{className:"mx-auto h-16 w-16 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:(0,e.jsx)(ye,{className:"h-8 w-8 text-gray-400"})}),(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No accepted loans found"}),(0,e.jsx)("p",{className:"text-gray-500",children:"There are no accepted loans at the moment."})]}):(0,e.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:W.map(h=>{const v=T.has(h.id),A=!h.paymentStatus||h.paymentStatus==="pending";return(0,e.jsx)("div",{className:`bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden transition-all duration-300 hover:shadow-md ${v?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:(0,e.jsxs)("div",{className:"p-6",children:[(0,e.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-indigo-100 flex items-center justify-center",children:(0,e.jsx)("span",{className:"text-indigo-800 font-medium",children:h.userName?.charAt(0)?.toUpperCase()||"U"})}),(0,e.jsxs)("div",{className:"ml-3",children:[(0,e.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:h.userName||"Unknown User"}),(0,e.jsx)("p",{className:"text-sm text-gray-500",children:h.userEmail||"No email provided"})]})]}),(0,e.jsx)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                            ${h.paymentStatus==="approved"?"bg-green-100 text-green-800":h.paymentStatus==="denied"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:h.paymentStatus?.charAt(0)?.toUpperCase()+h.paymentStatus?.slice(1)||"Pending"})]}),(0,e.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Loan Amount"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",h.amount]})]}),(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Interest (10%)"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",(h.amount*.1).toFixed(2)]})]}),(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Total Payable"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",h.totalPayable?.toFixed(2)||(h.amount*1.1).toFixed(2)]})]}),(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Paid Amount"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",h.paidAmount]})]}),(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Payment Date"}),(0,e.jsx)("span",{className:"text-sm font-medium text-gray-900",children:O(h.paymentTimestamp)})]}),h.adminReviewedAt&&(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Reviewed At"}),(0,e.jsx)("span",{className:"text-sm font-medium text-gray-900",children:O(h.adminReviewedAt)})]})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("span",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Proof of Payment"}),h.proofImageUrl?(0,e.jsxs)("div",{className:"relative w-full h-32 rounded-lg overflow-hidden cursor-pointer border border-gray-200",onClick:()=>Y(h.proofImageUrl),children:[(0,e.jsx)("img",{src:h.proofImageUrl,alt:"Proof of payment",className:"w-full h-full object-cover"}),(0,e.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity",children:(0,e.jsx)(Me,{className:"h-6 w-6 text-white"})})]}):(0,e.jsx)("div",{className:"w-full h-32 rounded-lg bg-gray-100 flex items-center justify-center border border-gray-200",children:(0,e.jsx)("span",{className:"text-gray-500 text-sm",children:"No proof provided"})})]}),(0,e.jsxs)("div",{className:"flex space-x-3",children:[(0,e.jsxs)("button",{className:`flex-1 inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg transition-colors ${A?"text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500":"text-gray-400 bg-gray-100 cursor-not-allowed"}`,onClick:()=>w(h.id),disabled:!A,children:[(0,e.jsx)(is,{className:"-ml-1 mr-2 h-4 w-4"}),"Approve"]}),(0,e.jsxs)("button",{className:`flex-1 inline-flex items-center justify-center px-4 py-2 border text-sm font-medium rounded-lg transition-colors ${A?"text-gray-700 bg-white border-gray-300 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500":"text-gray-400 bg-gray-100 border-gray-200 cursor-not-allowed"}`,onClick:()=>I(h.id),disabled:!A,children:[(0,e.jsx)(De,{className:"-ml-1 mr-2 h-4 w-4"}),"Deny"]})]})]})},h.id)})})]})]}),b&&(0,e.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",onClick:L,children:(0,e.jsxs)("div",{className:"relative max-w-4xl max-h-full",onClick:h=>h.stopPropagation(),children:[(0,e.jsx)("button",{className:"absolute -top-12 right-0 text-white hover:text-gray-300 focus:outline-none",onClick:L,children:(0,e.jsx)(De,{className:"h-8 w-8"})}),(0,e.jsx)("img",{src:E,alt:"Proof of payment",className:"max-w-full max-h-screen rounded-lg"})]})})]})},ws=Ns,vs=()=>{const[r,d]=(0,t.useState)([]),[n,p]=(0,t.useState)([]),[f,x]=(0,t.useState)(!0),[j,u]=(0,t.useState)(null),[D,m]=(0,t.useState)(""),[g,E]=(0,t.useState)("All"),[C,b]=(0,t.useState)(null),[F,T]=(0,t.useState)(!1),[N,c]=(0,t.useState)({});(0,t.useEffect)(()=>{const s=te(Q(U,"users")),o=ie(s,l=>{const P=l.docs.map(M=>({id:M.id,...M.data()}));p(P)},l=>{console.error("Error loading users:",l),u("Failed to load users: "+l.message)});return()=>o()},[]),(0,t.useEffect)(()=>{const s=te(Q(U,"deposits"),me("timestamp","desc")),o=ie(s,l=>{try{const P=l.docs.map(M=>({id:M.id,...M.data()})).map(M=>{const _=n.find(B=>B.uid===M.userId);return{...M,userName:_?_.fullName||"Unnamed User":"Unknown User"}});d(P),x(!1)}catch(P){console.error("Error merging deposit data:",P),u("Error processing deposit data: "+P.message),x(!1)}},l=>{console.error("Firestore error:",l),u("Failed to load deposits: "+l.message),x(!1)});return()=>o()},[n]);const S=s=>{switch(s){case"accepted":return"bg-green-100 text-green-800";case"denied":return"bg-red-100 text-red-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},w=async(s,o)=>{try{const l=ae(U,"deposits",s);await ce(l,{status:o}),console.log(`Deposit ${s} status updated to ${o}`)}catch(l){console.error("Error updating deposit status:",l),u("Failed to update deposit status: "+l.message)}},I=s=>{if(!s)return"N/A";if(s.seconds){const o=new Date(s.seconds*1e3);return o.toLocaleDateString()+" "+o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}if(s.toDate){const o=s.toDate();return o.toLocaleDateString()+" "+o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}return s.toString()},Y=r.reduce((s,o)=>s+(parseFloat(o.amount)||0),0),L=r.filter(s=>s.status==="pending").length,O=r.filter(s=>s.status==="accepted").length,W=r.filter(s=>s.status==="denied").length,X=r.filter(s=>s.status==="accepted").reduce((s,o)=>s+(parseFloat(o.amount)||0),0),h=r.filter(s=>s.status==="denied").reduce((s,o)=>s+(parseFloat(o.amount)||0),0),v=r.filter(s=>{const o=s.userName?.toLowerCase().includes(D.toLowerCase())||s.userId?.toLowerCase().includes(D.toLowerCase())||s.message?.toLowerCase().includes(D.toLowerCase()),l=g==="All"||s.status===g;return o&&l}),A=s=>{b(s),T(!0)},a=()=>{T(!1),b(null)};return f?(0,e.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading deposits..."})]})}):j?(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6 text-center",children:[(0,e.jsxs)("p",{className:"text-red-500",children:["Error: ",j]}),(0,e.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200",children:"Retry"})]}):(console.log("DepositsPage: Rendering with deposits array length:",r.length),(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:[(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Deposits"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",Y.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-indigo-100",children:(0,e.jsx)(Se,{className:"h-6 w-6 text-indigo-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Pending Deposits"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:L})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-yellow-100",children:(0,e.jsx)(it,{className:"h-6 w-6 text-yellow-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Approved Deposits"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:O})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,e.jsx)(Te,{className:"h-6 w-6 text-green-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Denied Deposits"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:W})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-red-100",children:(0,e.jsx)(fe,{className:"h-6 w-6 text-red-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Accepted Amount"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",X.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,e.jsx)(Te,{className:"h-6 w-6 text-green-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Declined Amount"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",h.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-red-100",children:(0,e.jsx)(fe,{className:"h-6 w-6 text-red-600"})})]})})]}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[(0,e.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Deposit Records"}),(0,e.jsxs)("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4",children:[(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,e.jsx)(ye,{className:"h-5 w-5 text-gray-400"})}),(0,e.jsx)("input",{type:"text",placeholder:"Search by name, user ID or message...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:D,onChange:s=>m(s.target.value)})]}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsxs)("select",{className:"block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-lg bg-gray-50",value:g,onChange:s=>E(s.target.value),children:[(0,e.jsx)("option",{value:"All",children:"All Statuses"}),(0,e.jsx)("option",{value:"pending",children:"Pending"}),(0,e.jsx)("option",{value:"accepted",children:"Accepted"}),(0,e.jsx)("option",{value:"denied",children:"Denied"})]}),(0,e.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:(0,e.jsx)(at,{className:"h-5 w-5 text-gray-400"})})]})]})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm overflow-scroll",children:(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User Name"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Proof"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:v.length>0?v.map(s=>(0,e.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[(0,e.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,e.jsx)("div",{className:"text-sm font-medium text-gray-900",children:s.userName}),(0,e.jsxs)("div",{className:"text-xs text-gray-500 italic",children:["ID: ",s.userId]})]}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsxs)("div",{className:"text-sm font-semibold text-gray-900",children:["$",s.amount?parseFloat(s.amount).toFixed(2):"0.00"]})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${S(s.status||"pending")}`,children:s.status||"pending"})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:s.imageUrl?(0,e.jsxs)("button",{onClick:()=>A(s),className:"text-indigo-600 hover:text-indigo-900 flex items-center",children:[(0,e.jsx)(Me,{className:"h-4 w-4 mr-1"}),"View"]}):(0,e.jsx)("span",{className:"text-gray-400",children:"No proof"})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:I(s.timestamp)}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,e.jsxs)("div",{className:"flex items-center space-x-3",children:[s.status==="pending"?(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)("button",{disabled:!!N[s.id],onClick:async()=>{if(window.confirm("Mark this deposit as Accepted?")){c(o=>({...o,[s.id]:!0}));try{await w(s.id,"accepted"),console.log("Deposit accepted:",s.id)}finally{c(o=>{const l={...o};return delete l[s.id],l})}}},className:"px-3 py-1 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors duration-200 disabled:opacity-50",children:N[s.id]?"Processing...":"Approve"}),(0,e.jsx)("button",{disabled:!!N[s.id],onClick:async()=>{if(window.confirm("Mark this deposit as Denied?")){c(o=>({...o,[s.id]:!0}));try{await w(s.id,"denied"),console.log("Deposit denied:",s.id)}finally{c(o=>{const l={...o};return delete l[s.id],l})}}},className:"px-3 py-1 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors duration-200 disabled:opacity-50",children:N[s.id]?"Processing...":"Deny"})]}):(0,e.jsx)("span",{className:"text-sm text-gray-500",children:s.status||"No actions"}),s.imageUrl?(0,e.jsx)("button",{onClick:()=>window.open(s.imageUrl,"_blank"),className:"text-indigo-600 hover:text-indigo-900 flex items-center",title:"View proof in new tab",children:(0,e.jsx)(rt,{className:"h-4 w-4"})}):null]})})]},s.id)):(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:"6",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No deposits found."})})})]})})}),F&&C&&(0,e.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,e.jsxs)("div",{className:"bg-white  rounded-2xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-scroll",children:[(0,e.jsxs)("div",{className:"p-6 border-b border-gray-200 flex justify-between items-center",children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Deposit Proof"}),(0,e.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-500",children:(0,e.jsx)(fe,{className:"h-6 w-6"})})]}),(0,e.jsxs)("div",{className:"p-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"User Name"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:C.userName||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"User ID"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:C.userId||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Amount"}),(0,e.jsxs)("p",{className:"text-sm text-gray-900",children:["$",C.amount?parseFloat(C.amount).toFixed(2):"0.00"]})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Status"}),(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${S(C.status||"pending")}`,children:C.status||"pending"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Date"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:I(C.timestamp)})]}),(0,e.jsxs)("div",{className:"md:col-span-2",children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Message"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:C.message||"No message"})]})]}),(0,e.jsxs)("div",{className:"mt-6",children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Proof Image"}),(0,e.jsx)("div",{className:"border border-gray-200 rounded-lg ",children:C.imageUrl?(0,e.jsx)("img",{src:C.imageUrl,alt:"Deposit Proof",className:"w-full h-auto max-h-[60vh] object-contain",onError:s=>{s.target.style.display="none"}}):(0,e.jsx)("div",{className:"flex items-center justify-center h-64 bg-gray-100 text-gray-500",children:"No image available"})})]}),(0,e.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,e.jsx)("button",{onClick:a,className:"px-4 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50",children:"Close"}),C.status==="pending"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("button",{onClick:()=>{w(C.id,"accepted"),a()},className:"px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-green-600 hover:bg-green-700",children:"Approve"}),(0,e.jsx)("button",{onClick:()=>{w(C.id,"denied"),a()},className:"px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-red-600 hover:bg-red-700",children:"Deny"})]})]})]})]})})]}))},Ss=vs;function Ds(){const{currentUser:r}=he(),[d,n]=(0,t.useState)([]),[p,f]=(0,t.useState)(""),[x,j]=(0,t.useState)(!0),[u,D]=(0,t.useState)({}),[m,g]=(0,t.useState)({}),E=(0,t.useRef)(),C=(0,t.useRef)(),b=N=>{if(!N)return!1;const c=N.toDate?N.toDate():new Date(N);return(new Date-c)/(1e3*60)<2};(0,t.useEffect)(()=>{if(!r)return;(async()=>{try{const S=ae(U,"users",r.uid);await ce(S,{isOnline:!0,lastActive:xe()})}catch(S){console.error("Error setting user online:",S)}})(),C.current=setInterval(async()=>{try{const S=ae(U,"users",r.uid);await ce(S,{lastActive:xe()})}catch(S){console.error("Error updating lastActive:",S)}},3e4);const c=async()=>{try{const S=ae(U,"users",r.uid);await ce(S,{isOnline:!1,lastActive:xe()})}catch(S){console.error("Error setting user offline:",S)}};return window.addEventListener("beforeunload",c),()=>{clearInterval(C.current),window.removeEventListener("beforeunload",c),r&&(async()=>{try{const w=ae(U,"users",r.uid);await ce(w,{isOnline:!1,lastActive:xe()})}catch(w){console.error("Error setting user offline:",w)}})()}},[r]),(0,t.useEffect)(()=>{if(!r){j(!1);return}const N=te(Q(U,"messages"),me("timestamp","asc"));return ie(N,c=>{n(c.docs.map(S=>({id:S.id,...S.data()}))),j(!1)})},[r]),(0,t.useEffect)(()=>{if(r)return ie(Q(U,"users"),N=>{const c={},S={};N.forEach(w=>{const I=w.data();c[w.id]=I,b(I.lastActive)&&(S[w.id]={displayName:I.displayName||I.email?.split("@")[0]||"Unknown",isOnline:I.isOnline||!1,lastActive:I.lastActive})}),g(c),D(S)})},[r]);const F=async N=>{if(N.preventDefault(),!(!r||!p.trim()))try{await It(Q(U,"messages"),{text:p,userId:r.uid,userName:r.email?r.email.split("@")[0]:"Anonymous",timestamp:xe()}),f("")}catch(c){console.error("Error sending message:",c)}};(0,t.useEffect)(()=>{E.current?.scrollIntoView({behavior:"smooth"})},[d]);const T=N=>N?N.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"";return r?(0,e.jsxs)("div",{className:"flex flex-col  h-screen bg-gradient-to-b from-gray-50 to-gray-100 font-sans text-gray-800 max-w-4xl mx-auto w-full",children:[(0,e.jsx)("div",{className:"mx-4 mb-2 bg-white/70 backdrop-blur-md rounded-xl shadow-sm p-3",children:(0,e.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,e.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,e.jsxs)("span",{className:"text-xs text-gray-600",children:[Object.keys(u).length," online"]}),(0,e.jsx)("br",{}),(0,e.jsxs)("p",{className:"text-sm text-gray-500",children:[d.length," Messages"]})]})}),(0,e.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 flex flex-col gap-4 max-w-full",children:[x?(0,e.jsx)("div",{className:"flex justify-center p-6",children:(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)("div",{className:"w-2.5 h-2.5 bg-indigo-500 rounded-full animate-bounce"}),(0,e.jsx)("div",{className:"w-2.5 h-2.5 bg-indigo-500 rounded-full animate-bounce",style:{animationDelay:"0.16s"}}),(0,e.jsx)("div",{className:"w-2.5 h-2.5 bg-indigo-500 rounded-full animate-bounce",style:{animationDelay:"0.32s"}})]})}):d.length===0?(0,e.jsxs)("div",{className:"flex flex-col items-center justify-center text-gray-500 p-10 bg-white rounded-2xl shadow-lg m-5",children:[(0,e.jsx)("div",{className:"text-4xl mb-3 opacity-70",children:"ðŸ’¬"}),(0,e.jsx)("div",{className:"text-sm text-center max-w-xs",children:"No messages yet. Start a conversation!"})]}):d.map(N=>(0,e.jsxs)("div",{className:`flex ${N.userId===r.uid?"justify-end":"justify-start"} animate-fade-in`,children:[N.userId!==r.uid&&(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"w-9 h-9 rounded-full flex items-center justify-center bg-white text-indigo-600 font-bold flex-shrink-0 shadow-sm mr-2",children:N.userName?N.userName.charAt(0).toUpperCase():"U"}),(0,e.jsx)("div",{className:`absolute bottom-[60px] right-7 w-3.5 h-3.5 rounded-full border-2 border-white ${u[N.userId]?"bg-green-500":"bg-gray-400"}`,title:u[N.userId]?"Online":"Offline"})]}),(0,e.jsxs)("div",{className:`max-w-[72%] p-3 rounded-2xl relative shadow-md transition-all duration-300 hover:shadow-lg ${N.userId===r.uid?"bg-gradient-to-br from-indigo-50 to-indigo-100 border border-indigo-100 rounded-br-md":"bg-white border border-gray-200 rounded-bl-md"}`,children:[(0,e.jsx)("div",{className:"text-sm text-gray-800 leading-relaxed",children:N.text}),(0,e.jsx)("div",{className:"text-xs text-gray-400 text-right mt-2",children:T(N.timestamp)})]}),N.userId===r.uid&&(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"w-9 h-9 rounded-full flex items-center justify-center bg-gradient-to-br from-indigo-500 to-indigo-600 text-white font-bold flex-shrink-0 shadow-sm ml-2",children:N.userName?N.userName.charAt(0).toUpperCase():"U"}),(0,e.jsx)("div",{className:`absolute bottom-[60px] right-6 w-3.5 h-3.5 rounded-full border-2 border-white ${b(m[r?.uid]?.lastActive)?"bg-green-500":"bg-gray-400"}`,title:b(m[r?.uid]?.lastActive)?"Online":"Offline"})]})]},N.id)),(0,e.jsx)("div",{ref:E})]}),(0,e.jsxs)("form",{onSubmit:F,className:"flex items-center p-4 gap-3 sticky bottom-0 bg-white/70 backdrop-blur-md border-t border-gray-200",children:[(0,e.jsx)("div",{className:"flex-1 flex items-center bg-white p-2 pl-4 rounded-full shadow-md transition-all duration-300 focus-within:shadow-lg focus-within:border focus-within:border-indigo-500",children:(0,e.jsx)("input",{type:"text",className:"flex-1 border-0 outline-none p-2 bg-transparent text-sm text-gray-800",placeholder:"Type a message...",value:p,onChange:N=>f(N.target.value)})}),(0,e.jsx)("button",{type:"submit",className:"w-11 h-11 rounded-full flex items-center justify-center bg-gradient-to-br from-indigo-500 to-indigo-600 text-white border-none cursor-pointer shadow-md transition-all duration-300 hover:shadow-lg hover:-translate-y-0.5 active:translate-y-0 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",disabled:!p.trim(),children:(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-4.5 h-4.5",children:(0,e.jsx)("path",{d:"M3.478 2.404a.75.75 0 0 0-.926.941l2.432 7.905H13.5a.75.75 0 0 1 0 1.5H4.984l-2.432 7.905a.75.75 0 0 0 .926.94 60.519 60.519 0 0 0 18.445-8.986.75.75 0 0 0 0-1.218A60.517 60.517 0 0 0 3.478 2.404Z"})})})]})]}):(0,e.jsx)("div",{className:"flex flex-col h-screen bg-gradient-to-b from-gray-50 to-gray-100 items-center justify-center font-sans text-gray-800",children:(0,e.jsxs)("div",{className:"text-center p-6 bg-white rounded-2xl shadow-lg max-w-md",children:[(0,e.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Please log in to use chat"}),(0,e.jsx)("p",{className:"text-gray-600",children:"You need to be logged in to send and receive messages."})]})})}var Cs=()=>(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(Ds,{})}),ks=Cs,As=()=>{const[r,d]=(0,t.useState)(!1),{currentUser:n}=he(),p=kt(),f=Ie(),{logout:x}=he(),j=async()=>{try{await x(),f("/login")}catch(m){console.error("Failed to log out",m)}};(0,t.useEffect)(()=>{const m=()=>{window.innerWidth>=1024&&d(!1)};return window.addEventListener("resize",m),()=>window.removeEventListener("resize",m)},[]),(0,t.useEffect)(()=>{const m=g=>{r&&!g.target.closest(".sidebar-content")&&!g.target.closest(".sidebar-toggle")&&d(!1)};return document.addEventListener("click",m),()=>document.removeEventListener("click",m)},[r]),(0,t.useEffect)(()=>{d(!1)},[p.pathname]);const u=[{name:"Dashboard",href:"/dashboard",icon:rs},{name:"Deposits",href:"/deposits",icon:ts},{name:"loans",href:"/loans",icon:Jt},{name:"Chat",href:"/chat",icon:as},{name:"Users",href:"/users",icon:nt},{name:"Payback",href:"/payback",icon:Kt},{name:"Settings",href:"/settings",icon:Ve},{name:"Block users",href:"/admin-users",icon:Ve},{name:"Annual Reports",href:"/annual-reports",icon:ve}],D=m=>p.pathname===m;return(0,e.jsxs)("div",{className:"flex h-screen w-screen max-w-full bg-gray-50",children:[(0,e.jsx)("div",{className:`fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-lg transform ${r?"translate-x-0":"-translate-x-full"} transition-transform duration-300 ease-in-out lg:translate-x-0 lg:static lg:inset-0 sidebar-content`,children:(0,e.jsxs)("div",{className:"flex flex-col h-full",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between h-16 px-6 border-b border-gray-200",children:[(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("div",{className:"flex-shrink-0",children:(0,e.jsx)("div",{className:"w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center",children:(0,e.jsx)("span",{className:"text-white font-bold",children:"MB"})})}),(0,e.jsx)("div",{className:"ml-3",children:(0,e.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"MoneyBox"})})]}),(0,e.jsx)("button",{onClick:()=>d(!1),className:"lg:hidden text-gray-500 hover:text-gray-700",children:(0,e.jsx)(De,{size:20})})]}),(0,e.jsx)("nav",{className:"flex-1 px-4 py-6 overflow-y-auto",children:(0,e.jsx)("ul",{className:"space-y-1",children:u.map(m=>(0,e.jsx)("li",{children:(0,e.jsxs)(Re,{to:m.href,className:`flex items-center px-4 py-3 text-sm font-medium rounded-lg transition-all duration-200 ${D(m.href)?"bg-indigo-50 text-indigo-700":"text-gray-700 hover:bg-gray-100"}`,children:[(0,e.jsx)(m.icon,{className:"mr-3 h-5 w-5"}),m.name]})},m.name))})}),(0,e.jsxs)("div",{className:"px-4 py-6 border-t border-gray-200",children:[(0,e.jsxs)("div",{className:"flex items-center mb-4",children:[(0,e.jsx)("div",{className:"flex-shrink-0",children:(0,e.jsx)("div",{className:"w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center",children:(0,e.jsx)("div",{className:"w-11 h-11 rounded-full flex items-center justify-center bg-gradient-to-br from-indigo-500 to-indigo-600 text-white font-bold shadow-md",children:n?.email?.charAt(0).toUpperCase()||"U"})})}),(0,e.jsxs)("div",{className:"ml-3",children:[(0,e.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:["Admin  is           ",n?.email?.slice(0,5).toUpperCase()||"U"]}),(0,e.jsx)("p",{className:"text-xs text-gray-500",children:n?.email?.slice(0,104).toLowerCase()||"U"})]})]}),(0,e.jsxs)("button",{onClick:j,className:"flex items-center w-full px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors duration-200",children:[(0,e.jsx)(qe,{className:"mr-3 h-5 w-5"}),"Logout"]})]})]})}),(0,e.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,e.jsx)("header",{className:"bg-white shadow-sm z-10",children:(0,e.jsxs)("div",{className:"flex items-center justify-between h-16 px-6",children:[(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("button",{onClick:()=>d(!0),className:"lg:hidden text-gray-500 hover:text-gray-700 mr-4 sidebar-toggle",children:(0,e.jsx)(Xt,{size:20})}),(0,e.jsxs)("h2",{className:"text-xl font-semibold text-gray-800",children:[p.pathname==="/dashboard"&&"ðŸ’° Dashboard",p.pathname==="/deposits"&&"ðŸ’° Deposits Overview",p.pathname==="/loans"&&"ðŸ’¸ loans Overview",p.pathname==="/users"&&"ðŸ‘¥ Users Overview",p.pathname==="/chat"&&"ðŸ‘¥ Users Overview"]})]}),(0,e.jsx)("div",{className:"flex items-center space-x-4",children:(0,e.jsxs)("button",{onClick:j,className:"flex items-center text-sm font-medium text-gray-700 hover:text-gray-900",children:[(0,e.jsx)(qe,{className:"mr-2 h-5 w-5"}),"Logout"]})})]})}),(0,e.jsx)("main",{className:"flex-1 overflow-y-auto bg-gray-50 p-6",children:(0,e.jsx)("div",{className:"h-full w-full",children:(0,e.jsx)(Dt,{})})})]})]})},Ls=As,Ps=()=>{const[r,d]=(0,t.useState)([]),[n,p]=(0,t.useState)([]),[f,x]=(0,t.useState)(!0),[j,u]=(0,t.useState)(null),[D,m]=(0,t.useState)(""),[g,E]=(0,t.useState)("All"),[C,b]=(0,t.useState)({}),[F,T]=(0,t.useState)({});(0,t.useEffect)(()=>{const a=te(Q(U,"users")),s=ie(a,o=>{const l=o.docs.map(P=>({id:P.id,...P.data()}));p(l)},o=>{console.error("Error loading users:",o),u("Failed to load users: "+o.message)});return()=>s()},[]),(0,t.useEffect)(()=>{const a=te(Q(U,"loans"),me("timestamp","desc")),s=ie(a,o=>{try{const l=o.docs.map(P=>({id:P.id,...P.data()})).map(P=>{const M=n.find(_=>_.uid===P.userId);return{...P,userName:M?M.fullName||"Unnamed User":"Unknown User"}});d(l),x(!1)}catch(l){console.error("Error merging loan data:",l),u("Error processing loan data: "+l.message),x(!1)}},o=>{console.error("Firestore error:",o),u("Failed to load loans: "+o.message),x(!1)});return()=>s()},[n]);const N=a=>{switch(a){case"accepted":return"bg-green-100 text-green-800";case"denied":return"bg-red-100 text-red-800";case"Pending":case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},c=a=>{if(!a)return"N/A";if(a.seconds){const s=new Date(a.seconds*1e3);return s.toLocaleDateString()+" "+s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}if(a.toDate){const s=a.toDate();return s.toLocaleDateString()+" "+s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}return a.toString()},S=(a,s)=>{const o=s.target.files[0];o&&T(l=>({...l,[a]:o}))},w=async a=>{const s="dlrxomdfh",o="Shop-preset",l=new FormData;return l.append("file",a),l.append("upload_preset",o),l.append("cloud_name",s),(await(await fetch(`https://api.cloudinary.com/v1_1/${s}/image/upload`,{method:"POST",body:l})).json()).secure_url},I=async a=>{if(window.confirm("Are you sure you want to accept this loan?")){if(!F[a]){alert("Please upload a receipt image before accepting the loan.");return}b(s=>({...s,[a]:!0}));try{const s=await w(F[a]),o=ae(U,"loans",a);await ce(o,{status:"accepted",receiptUrl:s,acceptedAt:xe()}),T(l=>{const P={...l};return delete P[a],P})}catch(s){console.error("Error accepting loan:",s),u("Failed to accept loan: "+s.message)}finally{b(s=>{const o={...s};return delete o[a],o})}}},Y=async a=>{if(window.confirm("Are you sure you want to deny this loan?")){b(s=>({...s,[a]:!0}));try{const s=ae(U,"loans",a);await ce(s,{status:"denied",deniedAt:xe()})}catch(s){console.error("Error denying loan:",s),u("Failed to deny loan: "+s.message)}finally{b(s=>{const o={...s};return delete o[a],o})}}},L=r.reduce((a,s)=>a+(parseFloat(s.amount)||0),0),O=r.filter(a=>a.status==="pending").length,W=r.filter(a=>a.status==="accepted").length,X=r.filter(a=>a.status==="denied").length,h=r.filter(a=>a.status==="accepted").reduce((a,s)=>a+(parseFloat(s.amount)||0),0),v=r.filter(a=>a.status==="denied").reduce((a,s)=>a+(parseFloat(s.amount)||0),0),A=r.filter(a=>{const s=a.userName?.toLowerCase().includes(D.toLowerCase())||a.userId?.toLowerCase().includes(D.toLowerCase())||a.message?.toLowerCase().includes(D.toLowerCase()),o=g==="All"||a.status===g;return s&&o});return f?(0,e.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading loans..."})]})}):j?(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6 text-center",children:[(0,e.jsxs)("p",{className:"text-red-500",children:["Error: ",j]}),(0,e.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200",children:"Retry"})]}):(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total loans"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",L.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-blue-100",children:(0,e.jsx)(ve,{className:"h-6 w-6 text-blue-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Pending loans"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:O})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-yellow-100",children:(0,e.jsx)(it,{className:"h-6 w-6 text-yellow-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Paid loans"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:W})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,e.jsx)(Ht,{className:"h-6 w-6 text-green-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Declined loans"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:X})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-red-100",children:(0,e.jsx)(fe,{className:"h-6 w-6 text-red-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Accepted Amount"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",h.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,e.jsx)(Te,{className:"h-6 w-6 text-green-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Declined Amount"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",v.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-red-100",children:(0,e.jsx)(fe,{className:"h-6 w-6 text-red-600"})})]})})]}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[(0,e.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Loans Records"}),(0,e.jsxs)("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4",children:[(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,e.jsx)(ye,{className:"h-5 w-5 text-gray-400"})}),(0,e.jsx)("input",{type:"text",placeholder:"Search by name, user ID or message...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:D,onChange:a=>m(a.target.value)})]}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsxs)("select",{className:"block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-lg bg-gray-50",value:g,onChange:a=>E(a.target.value),children:[(0,e.jsx)("option",{value:"All",children:"All Statuses"}),(0,e.jsx)("option",{value:"Pending",children:"Pending"}),(0,e.jsx)("option",{value:"accepted",children:"Paid"}),(0,e.jsx)("option",{value:"denied",children:"Declined"})]}),(0,e.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:(0,e.jsx)(at,{className:"h-5 w-5 text-gray-400"})})]})]})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden",children:(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User Name"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:A.length>0?A.map(a=>(0,e.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[(0,e.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,e.jsx)("div",{className:"text-sm font-semibold text-gray-900",children:a.userName}),(0,e.jsxs)("div",{className:"text-xs text-gray-500 italic",children:["ID: ",a.userId]})]}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsxs)("div",{className:"text-sm font-semibold text-gray-900",children:["$",a.amount?parseFloat(a.amount).toFixed(2):"0.00"]})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${N(a.status)}`,children:a.status==="accepted"?"Paid":a.status||"Pending"})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:c(a.timestamp)}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,e.jsxs)("div",{className:"flex items-center space-x-3",children:[a.status==="pending"?(0,e.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,e.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,e.jsx)("label",{className:"text-xs text-gray-500",children:"Upload receipt"}),(0,e.jsx)("input",{type:"file",accept:"image/*",onChange:s=>S(a.id,s),className:"block text-sm border rounded-lg p-1 cursor-pointer bg-gray-50"})]}),(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)("button",{disabled:!!C[a.id]||!F[a.id],onClick:()=>I(a.id),className:`px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-200 ${!F[a.id]||C[a.id]?"opacity-50 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"}`,children:C[a.id]?"Processing...":"Accept"}),(0,e.jsx)("button",{disabled:!!C[a.id],onClick:()=>Y(a.id),className:"px-3 py-1 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors duration-200 disabled:opacity-50",children:C[a.id]?"Processing...":"Deny"})]})]}):(0,e.jsx)("span",{className:"text-sm text-gray-500",children:a.status==="accepted"?"Paid":a.status}),a.imageUrl&&(0,e.jsx)("button",{onClick:()=>window.open(a.imageUrl,"_blank"),className:"text-indigo-600 hover:text-indigo-900 flex items-center",title:"View proof",children:(0,e.jsx)(es,{className:"h-4 w-4"})})]})})]},a.id)):(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:"5",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No loans found."})})})]})})})]})},Es=Ps,Fs=()=>{const[r,d]=(0,t.useState)([]),[n,p]=(0,t.useState)(!0),[f,x]=(0,t.useState)(null),[j,u]=(0,t.useState)(""),[D,m]=(0,t.useState)(!1),[g,E]=(0,t.useState)(null),[C,b]=(0,t.useState)([]),[F,T]=(0,t.useState)([]),[N,c]=(0,t.useState)(!1),[S,w]=(0,t.useState)(!1),[I,Y]=(0,t.useState)(null),[L,O]=(0,t.useState)(null),[W,X]=(0,t.useState)({}),h=(0,t.useRef)(null),v=(0,t.useRef)(null);(0,t.useEffect)(()=>{if(!U){x("Firestore instance not available"),p(!1);return}const i=te(Q(U,"users"),me("createdAt","desc")),z=ie(i,R=>{try{const J=R.docs.map(q=>({id:q.id,...q.data()}));d(J),p(!1)}catch(J){console.error("Error processing users snapshot:",J),x("Failed to process users data"),p(!1)}},R=>{console.error("Error fetching users:",R),R.code==="permission-denied"?x("Permission denied. Check Firestore rules."):x("Failed to load users: "+(R.message||"Unknown error")),p(!1)});return()=>z()},[]),(0,t.useEffect)(()=>{if(h.current&&(h.current(),h.current=null),v.current&&(v.current(),v.current=null),!g){b([]),T([]);return}c(!0),Y(null);const i=te(Q(U,"deposits"),me("timestamp","desc"));h.current=ie(i,R=>{try{const J=R.docs.map(q=>({id:q.id,...q.data()})).filter(q=>q.userId===g.uid);b(J),c(!1)}catch(J){console.error("Error processing deposits snapshot:",J),Y("Failed to process deposits data"),c(!1)}},R=>{console.error("Error fetching deposits:",R),Y("Failed to load deposits: "+(R.message||"Unknown error")),c(!1)}),w(!0),O(null);const z=te(Q(U,"loans"),me("timestamp","desc"));return v.current=ie(z,R=>{try{const J=R.docs.map(q=>({id:q.id,...q.data()})).filter(q=>q.userId===g.uid);T(J),w(!1)}catch(J){console.error("Error processing loans snapshot:",J),O("Failed to process loans data"),w(!1)}},R=>{console.error("Error fetching loans:",R),O("Failed to load loans: "+(R.message||"Unknown error")),w(!1)}),()=>{h.current&&(h.current(),h.current=null),v.current&&(v.current(),v.current=null)}},[g]);const A=i=>{if(!i)return"N/A";if(i.seconds)return new Date(i.seconds*1e3).toLocaleString();if(i.toDate)return i.toDate().toLocaleString();try{return new Date(i).toLocaleString()}catch{return String(i)}},a=i=>{switch(i?.toLowerCase()){case"accepted":return"bg-green-100 text-green-800";case"denied":case"rejected":return"bg-red-100 text-red-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},s=i=>{E(i),m(!0)},o=()=>{m(!1)},l=i=>{window.open(i,"_blank")},P=(i,z)=>{const R=document.createElement("a");R.href=i,R.download=z||"proof-image.jpg",document.body.appendChild(R),R.click(),document.body.removeChild(R)},M=C.reduce((i,z)=>i+(z.amount||0),0),_=F.reduce((i,z)=>i+(z.amount||0),0);C.filter(i=>i.status==="pending").length,C.filter(i=>i.status==="accepted").length,C.filter(i=>i.status==="denied"||i.status==="rejected").length,F.filter(i=>i.status==="pending").length,F.filter(i=>i.status==="accepted").length,F.filter(i=>i.status==="denied"||i.status==="rejected").length;const B=r.filter(i=>{const z=j.trim().toLowerCase();return z?(i.fullName||"").toLowerCase().includes(z)||(i.email||"").toLowerCase().includes(z)||(i.phoneNumber||"").toLowerCase().includes(z)||(i.uid||"").toLowerCase().includes(z):!0});return n?(0,e.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading users..."})]})}):f?(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6 text-center",children:[(0,e.jsxs)("p",{className:"text-red-500",children:["Error: ",f]}),(0,e.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200",children:"Retry"})]}):(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6 md:col-span-1",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Users"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:r.length})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,e.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a4 4 0 00-4-4h-1M9 20H4v-2a4 4 0 014-4h1m0-4a4 4 0 100-8 4 4 0 000 8z"})})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6 md:col-span-3",children:(0,e.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0",children:[(0,e.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"User Records"}),(0,e.jsx)("div",{className:"flex items-center w-full sm:w-64",children:(0,e.jsxs)("div",{className:"relative w-full",children:[(0,e.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,e.jsx)(ye,{className:"h-5 w-5 text-gray-400"})}),(0,e.jsx)("input",{type:"text",placeholder:"Search users...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:j,onChange:i=>u(i.target.value)})]})})]})})]}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden",children:(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Gender"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Age"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Joined"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:B.length>0?B.map(i=>(0,e.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors duration-150 cursor-pointer",onClick:()=>s(i),children:[(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsxs)("div",{className:"flex items-center",children:[i.imageUrl?(0,e.jsx)("img",{src:i.imageUrl,alt:i.fullName||"avatar",className:"h-10 w-10 rounded-full object-cover",onError:z=>{z.target.style.display="none"}}):(0,e.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center text-sm font-medium text-gray-700",children:(i.fullName||"U").split(" ").map(z=>z[0]).slice(0,2).join("").toUpperCase()}),(0,e.jsxs)("div",{className:"ml-3",children:[(0,e.jsx)("div",{className:"text-sm font-medium text-gray-900",children:i.fullName||"No name"}),(0,e.jsx)("div",{className:"text-xs text-gray-500",children:i.uid||""})]})]})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:i.email||"N/A"}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:i.phoneNumber||"N/A"}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 capitalize",children:i.gender||"N/A"}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:i.age||"N/A"}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:A(i.createdAt)})]},i.id)):(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:"6",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No users found."})})})]})})}),D&&g&&(0,e.jsx)("div",{className:"fixed inset-0 z-50 overflow-auto bg-black bg-opacity-50 flex items-center justify-center p-4",children:(0,e.jsxs)("div",{className:"bg-white rounded-xl shadow-xl max-w-6xl w-full max-h-[90vh] overflow-auto",children:[(0,e.jsxs)("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center",children:[(0,e.jsxs)("h2",{className:"text-xl font-semibold text-gray-900",children:["User Details: ",g.fullName]}),(0,e.jsx)("button",{onClick:o,className:"p-1 rounded-full hover:bg-gray-100 transition-colors",children:(0,e.jsx)(De,{className:"h-5 w-5 text-gray-500"})})]}),(0,e.jsxs)("div",{className:"p-6",children:[(0,e.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[(0,e.jsxs)("div",{className:"flex items-center mb-4",children:[g.imageUrl?(0,e.jsx)("img",{src:g.imageUrl,alt:g.fullName||"avatar",className:"h-16 w-16 rounded-full object-cover mr-4"}):(0,e.jsx)("div",{className:"h-16 w-16 rounded-full bg-gray-200 flex items-center justify-center text-xl font-medium text-gray-700 mr-4",children:(g.fullName||"U").split(" ").map(i=>i[0]).slice(0,2).join("").toUpperCase()}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:g.fullName||"No name"}),(0,e.jsxs)("p",{className:"text-sm text-gray-500",children:["ID: ",g.uid||"N/A"]})]})]}),(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Email"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:g.email||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Phone Number"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:g.phoneNumber||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"MoMo Number"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:g.momoNumber||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Credit card Number"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:g.creditCardNumber||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Gender"}),(0,e.jsx)("p",{className:"text-sm text-gray-900 capitalize",children:g.gender||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Age"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:g.age||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Joined Date"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:A(g.createdAt)})]})]})]}),(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,e.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,e.jsxs)("div",{className:"flex items-center mb-4",children:[(0,e.jsx)("div",{className:"p-2 rounded-full bg-green-100 mr-3",children:(0,e.jsx)(Se,{className:"h-6 w-6 text-green-600"})}),(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Deposits Summary"})]}),(0,e.jsx)("div",{className:"space-y-3",children:(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Total Amount:"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",M.toFixed(2)]})]})})]}),(0,e.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,e.jsxs)("div",{className:"flex items-center mb-4",children:[(0,e.jsx)("div",{className:"p-2 rounded-full bg-blue-100 mr-3",children:(0,e.jsx)(ss,{className:"h-6 w-6 text-blue-600"})}),(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Loans Summary"})]}),(0,e.jsx)("div",{className:"space-y-3",children:(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Total Amount:"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",_.toFixed(2)]})]})})]})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Deposits"}),N?(0,e.jsx)("div",{className:"flex justify-center py-4",children:(0,e.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):I?(0,e.jsx)("div",{className:"bg-red-50 p-4 rounded-md",children:(0,e.jsx)("p",{className:"text-sm text-red-800",children:I})}):C.length>0?(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Message"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Proof"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:C.map(i=>(0,e.jsxs)("tr",{children:[(0,e.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:["$",i.amount||"0"]}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap",children:(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${a(i.status)}`,children:i.status||"Unknown"})}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:A(i.timestamp)}),(0,e.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900 max-w-xs truncate",title:i.message,children:i.message||"N/A"}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:i.proofImage?(0,e.jsxs)("div",{className:"flex space-x-2",children:[(0,e.jsx)("button",{onClick:()=>l(i.proofImage),className:"text-indigo-600 hover:text-indigo-900",title:"View",children:(0,e.jsx)(Me,{className:"h-5 w-5"})}),(0,e.jsx)("button",{onClick:()=>P(i.proofImage,`deposit-proof-${i.id}.jpg`),className:"text-indigo-600 hover:text-indigo-900",title:"Download",children:(0,e.jsx)(rt,{className:"h-5 w-5"})})]}):"N/A"})]},i.id))})]})}):(0,e.jsx)("div",{className:"text-center py-4 text-sm text-gray-500",children:"No deposits found."})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Loans"}),S?(0,e.jsx)("div",{className:"flex justify-center py-4",children:(0,e.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):L?(0,e.jsx)("div",{className:"bg-red-50 p-4 rounded-md",children:(0,e.jsx)("p",{className:"text-sm text-red-800",children:L})}):F.length>0?(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reason"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Approved By"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:F.map(i=>(0,e.jsxs)("tr",{children:[(0,e.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:["$",i.amount||"0"]}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap",children:(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${a(i.status)}`,children:i.status||"Unknown"})}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:A(i.timestamp)}),(0,e.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900 max-w-xs truncate",title:i.reason,children:i.reason||"N/A"}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:i.approvedBy||"N/A"})]},i.id))})]})}):(0,e.jsx)("div",{className:"text-center py-4 text-sm text-gray-500",children:"No loans found."})]})]})]})})]})},Us=Fs,Ts=()=>{const[r,d]=(0,t.useState)("10.00"),[n,p]=(0,t.useState)(!0),[f,x]=(0,t.useState)(!1),[j,u]=(0,t.useState)(null),[D,m]=(0,t.useState)("success"),[g,E]=(0,t.useState)([]),[C,b]=(0,t.useState)(!1),[F,T]=(0,t.useState)(null);(0,t.useEffect)(()=>{(async()=>{try{const S=te(Q(U,"interest"),me("timestamp","desc"),Tt(10)),w=await pe(S);if(w.empty)d("10.00");else{const I=w.docs[0];d(I.data().interest.toFixed(2)),T(I.id);const Y=w.docs.map(L=>({date:new Date(L.data().timestamp?.toDate()||Date.now()).toLocaleDateString(),rate:parseFloat(L.data().interest)})).reverse();E(Y)}}catch(S){console.error("Error fetching interest:",S),u("Failed to load interest rate"),m("error"),setTimeout(()=>u(null),3e3)}finally{p(!1)}})()},[]);const N=async()=>{if(isNaN(r)||r<1||r>100){u("Please enter a valid interest rate between 1% and 100%"),m("error"),setTimeout(()=>u(null),3e3);return}x(!0);try{const c=new Date;if(F){const S=ae(U,"interest",F);await ce(S,{interest:Number(r),timestamp:c})}else await st(ae(U,"interest","globalRate"),{interest:Number(r),timestamp:c}),T("globalRate");u("Interest rate updated successfully!"),m("success"),E(S=>[...S.slice(-9),{date:c.toLocaleDateString(),rate:Number(r)}])}catch(c){console.error("Error updating interest:",c),u("Failed to update interest rate"),m("error")}finally{x(!1),setTimeout(()=>u(null),3e3)}};return n?(0,e.jsx)("div",{className:"flex justify-center items-center min-h-screen px-4",children:(0,e.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-10 w-full max-w-md text-center",children:[(0,e.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600 dark:text-gray-300",children:"Loading interest rate..."})]})}):(0,e.jsxs)("div",{className:"flex justify-center items-center min-h-screen px-4 bg-gray-50 dark:bg-gray-900",children:[(0,e.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-4 sm:p-6 md:p-10 w-full max-w-md",children:[(0,e.jsx)("h2",{className:"text-xl sm:text-2xl font-bold text-gray-800 dark:text-gray-100 mb-6 text-center",children:"Interest Rate Settings"}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("label",{className:"block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2",children:"Current Interest Rate (%)"}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("input",{type:"number",step:"0.01",min:"1",max:"100",value:r,onChange:c=>d(c.target.value),className:"border border-gray-300 dark:border-gray-700 rounded-lg p-3 w-full focus:ring-2 focus:ring-blue-500 outline-none pr-12",disabled:f,placeholder:"Enter interest rate (1â€“100)"}),(0,e.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"%"})]}),(0,e.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Enter as a percentage (e.g., 5 for 5%)"})]}),(0,e.jsx)("button",{onClick:N,disabled:f,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200 w-full disabled:opacity-50 flex items-center justify-center text-sm sm:text-base",children:f?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"}),"Saving..."]}):"Save Changes"}),(0,e.jsx)("div",{className:"mt-6 text-center",children:(0,e.jsxs)("button",{onClick:()=>b(!C),className:"text-blue-600 dark:text-blue-400 text-sm font-medium hover:underline",children:[C?"Hide":"Show"," Rate History"]})}),C&&g.length>0&&(0,e.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[(0,e.jsx)("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300 mb-4",children:"Interest Rate History"}),(0,e.jsx)("div",{className:"h-48",children:(0,e.jsx)(Ee,{width:"100%",height:"100%",children:(0,e.jsxs)(et,{data:g,children:[(0,e.jsx)(Fe,{strokeDasharray:"3 3",stroke:"#e0e0e0"}),(0,e.jsx)(Pe,{dataKey:"date",tick:{fontSize:12}}),(0,e.jsx)(Ue,{tick:{fontSize:12},domain:["dataMin - 0.5","dataMax + 0.5"]}),(0,e.jsx)(Le,{formatter:c=>`${c.toFixed(2)}%`,contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.9)",border:"1px solid #ccc",borderRadius:"4px"}}),(0,e.jsx)(Ae,{type:"monotone",dataKey:"rate",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:4},activeDot:{r:6}})]})})})]})]}),j&&(0,e.jsx)("div",{className:`fixed top-5 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-lg text-white font-semibold shadow-md transition-all duration-300 ${D==="success"?"bg-green-500":"bg-red-500"}`,children:j})]})},Is=Ts;ms();var ke=Ce(cs()),Rs=(r,d)=>{const n=new us({orientation:"portrait",unit:"mm",format:"a4"}),p=n.internal.pageSize.getWidth(),f=n.internal.pageSize.getHeight(),x=20;p-x*2,n.setFont("helvetica");const j=c=>c?(c.toDate?c.toDate():new Date(c)).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A",u=c=>`$${c.toFixed(2)}`,D=c=>c==="approved"?[0,128,0]:[255,0,0],m=c=>c==="approved"?"PAID":c?c.toUpperCase():"UNPAID",g=()=>{n.setFillColor(41,98,255),n.rect(0,0,p,30,"F"),n.setTextColor(255,255,255),n.setFontSize(20),n.setFont("helvetica","bold"),n.text("Annual User Reports",p/2,20,{align:"center"}),n.setFontSize(14),n.setFont("helvetica","normal"),n.text(`${d}`,p/2,26,{align:"center"}),n.setTextColor(0,0,0)},E=c=>{const S=f-10;n.setFontSize(8),n.setTextColor(100,100,100),n.text(`Page ${c}`,p/2,S,{align:"center"})},C=()=>{g(),n.setFontSize(28),n.setTextColor(41,98,255),n.text("Annual User Reports",p/2,100,{align:"center"}),n.setFontSize(22),n.text(`${d}`,p/2,115,{align:"center"}),n.setFontSize(12),n.setTextColor(100,100,100);const c=new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});n.text(`Generated on ${c}`,p/2,130,{align:"center"}),n.setTextColor(0,0,0),n.setFontSize(14),n.setFont("helvetica","bold"),n.text("Summary Statistics",x,160),n.setFont("helvetica","normal"),n.setFontSize(12);const S=r.length,w=r.reduce((O,W)=>O+W.totalDeposits,0),I=r.reduce((O,W)=>O+W.totalLoans,0),Y=r.reduce((O,W)=>O+W.paidLoansCount,0),L=r.reduce((O,W)=>O+W.unpaidLoansCount,0);n.text(`Total Users: ${S}`,x,175),n.text(`Total Deposits: ${u(w)}`,x,185),n.text(`Total Loans: ${u(I)}`,x,195),n.text(`Total Paid Loans: ${Y}`,x,205),n.text(`Total Unpaid Loans: ${L}`,x,215),E(1),n.addPage()};let b=0;const F=()=>{g();const c=[[{content:"User Name",dataKey:"name"}],[{content:"Total Deposits ($)",dataKey:"totalDeposits"}],[{content:"Paid Loans",dataKey:"paidLoansCount"}],[{content:"Unpaid Loans",dataKey:"unpaidLoansCount"}],[{content:"Total Loans ($)",dataKey:"totalLoans"}]],S=r.map(w=>[w.user.name||"Unknown User",u(w.totalDeposits),w.paidLoansCount,w.unpaidLoansCount,u(w.totalLoans)]);(0,ke.default)(n,{head:c,body:S,startY:40,theme:"grid",styles:{font:"helvetica",fontSize:10,cellPadding:5},headStyles:{fillColor:[41,98,255],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,245,245]},margin:{left:20,right:20},didDrawPage:w=>{b=w.cursor.y}}),b=n.lastAutoTable.finalY+10,E(n.internal.getNumberOfPages())},T=c=>f-b-20<c?(n.addPage(),g(),b=40,E(n.internal.getNumberOfPages()),!0):!1,N=(c,S=!1)=>{const w=60+c.deposits.length*10+c.loans.length*10;if(T(w),n.setFontSize(16),n.setFont("helvetica","bold"),n.setTextColor(41,98,255),n.text(c.user.name||"Unknown User",x,b),b+=10,n.setFontSize(12),n.setFont("helvetica","normal"),n.setTextColor(0,0,0),n.text(`Email: ${c.user.email||"N/A"}`,x,b),b+=10,n.text(`Phone: ${c.user.phone||"N/A"}`,x,b),b+=15,c.deposits.length>0){const I=[[{content:"Amount",dataKey:"amount"}],[{content:"Date",dataKey:"date"}]],Y=c.deposits.map(L=>[u(L.amount),j(L.timestamp)]);T(30),(0,ke.default)(n,{head:I,body:Y,startY:b,theme:"grid",styles:{font:"helvetica",fontSize:10,cellPadding:5},headStyles:{fillColor:[75,192,192],textColor:255,fontStyle:"bold"},margin:{left:x,right:x},didDrawPage:L=>{b=L.cursor.y}}),b=n.lastAutoTable.finalY+10}else T(20),n.setFontSize(10),n.setTextColor(100,100,100),n.text("No deposits found",x,b),n.setTextColor(0,0,0),b+=10;if(c.loans.length>0){const I=[[{content:"Amount",dataKey:"amount"}],[{content:"Date",dataKey:"date"}],[{content:"Status",dataKey:"status"}]],Y=c.loans.map(L=>[u(L.amount),j(L.timestamp),m(L.paymentStatus)]);T(30),(0,ke.default)(n,{head:I,body:Y,startY:b,theme:"grid",styles:{font:"helvetica",fontSize:10,cellPadding:5},headStyles:{fillColor:[255,99,132],textColor:255,fontStyle:"bold"},didDrawCell:L=>{if(L.section==="body"&&L.column.index===2){const O=L.row.index,W=c.loans[O];if(W){const X=D(W.paymentStatus);n.setTextColor(X[0],X[1],X[2])}}},didDrawPage:L=>{b=L.cursor.y},margin:{left:x,right:x}}),b=n.lastAutoTable.finalY+15}else T(20),n.setFontSize(10),n.setTextColor(100,100,100),n.text("No loans found",x,b),n.setTextColor(0,0,0),b+=15};try{C(),F(),r.length>0&&(n.addPage(),g(),b=40),r.forEach((w,I)=>{N(w,I===0)});const c=n.internal.getNumberOfPages();for(let w=1;w<=c;w++)n.setPage(w),E(w);const S=`annual-reports-${d}.pdf`;return n.save(S),{success:!0,filename:S}}catch(c){return console.error("Error generating PDF:",c),{success:!1,error:c.message}}},Ms=Rs;Wt.register(_t,zt,Bt,Yt,$t,Ot,Vt);var Ke=r=>xs(new Date(r,0,1)),Ze=r=>os(new Date(r,0,1)),ct=(r,d)=>new Date(r,d-1,1),mt=(r,d)=>new Date(r,d,0),He=r=>{if(!r)return"N/A";const d=r.toDate?r.toDate():new Date(r);return lt(d,"MMM dd, yyyy")},zs=(r,d)=>{const n=r.reduce((j,u)=>j+u.amount,0),p=d.reduce((j,u)=>j+u.amount,0),f=d.filter(j=>j.paymentStatus==="approved").length,x=d.filter(j=>j.paymentStatus!=="approved").length;return{totalDeposits:n,totalLoans:p,paidLoansCount:f,unpaidLoansCount:x}},$s=(r,d)=>{if(!d.trim())return r;const n=d.toLowerCase();return r.filter(p=>p.user?.name?.toLowerCase().includes(n)||p.user?.email?.toLowerCase().includes(n)||p.user?.phone?.toLowerCase().includes(n))},Ys=(r,d)=>{const n=["User","Total Deposits","Total Loans","Paid Loans","Unpaid Loans"],p=r.map(D=>[D.user.name,D.totalDeposits,D.totalLoans,D.paidLoansCount,D.unpaidLoansCount]);let f=n.join(",")+`
`;p.forEach(D=>{f+=D.join(",")+`
`});const x=new Blob([f],{type:"text/csv;charset=utf-8;"}),j=URL.createObjectURL(x),u=document.createElement("a");u.setAttribute("href",j),u.setAttribute("download",d),u.style.visibility="hidden",document.body.appendChild(u),u.click(),document.body.removeChild(u)},Qe=(r,d,n)=>{const p=[];for(let f=1;f<=12;f++){const x=ct(n,f),j=mt(n,f),u=r.filter(m=>{const g=m.timestamp.toDate?m.timestamp.toDate():new Date(m.timestamp);return g>=x&&g<=j}),D=d.filter(m=>{const g=m.timestamp.toDate?m.timestamp.toDate():new Date(m.timestamp);return g>=x&&g<=j});p.push({month:lt(x,"MMM"),deposits:u.reduce((m,g)=>m+g.amount,0),loans:D.reduce((m,g)=>m+g.amount,0)})}return p},Os=r=>r==="approved"?{text:"PAID",className:"bg-green-100 text-green-800"}:{text:r?r.toUpperCase():"UNPAID",className:"bg-red-100 text-red-800"},Xe=({data:r,columns:d,itemsPerPage:n=10})=>{const[p,f]=(0,t.useState)(1),x=Math.ceil(r.length/n),j=(p-1)*n,u=j+n,D=r.slice(j,u);return(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsx)("tr",{children:d.map((m,g)=>(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:m.header},g))})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:D.map((m,g)=>(0,e.jsx)("tr",{children:d.map((E,C)=>(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:E.render?E.render(m):m[E.accessor]},C))},g))})]})}),x>1&&(0,e.jsxs)("div",{className:"px-6 py-3 flex items-center justify-between border-t border-gray-200",children:[(0,e.jsxs)("div",{className:"flex-1 flex justify-between sm:hidden",children:[(0,e.jsx)("button",{onClick:()=>f(m=>Math.max(m-1,1)),disabled:p===1,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Previous"}),(0,e.jsx)("button",{onClick:()=>f(m=>Math.min(m+1,x)),disabled:p===x,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Next"})]}),(0,e.jsxs)("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[(0,e.jsx)("div",{children:(0,e.jsxs)("p",{className:"text-sm text-gray-700",children:["Showing ",(0,e.jsx)("span",{className:"font-medium",children:j+1})," to"," ",(0,e.jsx)("span",{className:"font-medium",children:Math.min(u,r.length)})," of"," ",(0,e.jsx)("span",{className:"font-medium",children:r.length})," results"]})}),(0,e.jsx)("div",{children:(0,e.jsxs)("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[(0,e.jsx)("button",{onClick:()=>f(m=>Math.max(m-1,1)),disabled:p===1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50",children:"Previous"}),Array.from({length:x},(m,g)=>g+1).map(m=>(0,e.jsx)("button",{onClick:()=>f(m),className:`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${p===m?"z-10 bg-blue-50 border-blue-500 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,children:m},m)),(0,e.jsx)("button",{onClick:()=>f(m=>Math.min(m+1,x)),disabled:p===x,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50",children:"Next"})]})})]})]})]})},_s=({isOpen:r,onClose:d,user:n,deposits:p,loans:f})=>{if(!r)return null;const x=[{header:"Amount",accessor:"amount",render:u=>`$${u.amount.toFixed(2)}`},{header:"Date",accessor:"timestamp",render:u=>He(u.timestamp)}],j=[{header:"Amount",accessor:"amount",render:u=>`$${u.amount.toFixed(2)}`},{header:"Date",accessor:"timestamp",render:u=>He(u.timestamp)},{header:"Status",accessor:"paymentStatus",render:u=>{const D=Os(u.paymentStatus);return(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${D.className}`,children:D.text})}}];return(0,e.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,e.jsxs)("div",{className:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[(0,e.jsx)("div",{className:"fixed inset-0 transition-opacity","aria-hidden":"true",children:(0,e.jsx)("div",{className:"absolute inset-0 bg-gray-500 opacity-75",onClick:d})}),(0,e.jsx)("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"â€‹"}),(0,e.jsx)("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-3xl sm:w-full",children:(0,e.jsxs)("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:[(0,e.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,e.jsxs)("h3",{className:"text-lg leading-6 font-medium text-gray-900",id:"modal-title",children:[n.name,"'s Report"]}),(0,e.jsx)("button",{type:"button",className:"text-gray-400 hover:text-gray-500 focus:outline-none",onClick:d,children:(0,e.jsx)("svg",{className:"h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,e.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,e.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,e.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,e.jsx)("p",{className:"text-sm text-gray-500",children:"Email"}),(0,e.jsx)("p",{className:"text-base font-medium",children:n.email||"N/A"})]}),(0,e.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,e.jsx)("p",{className:"text-sm text-gray-500",children:"Phone"}),(0,e.jsx)("p",{className:"text-base font-medium",children:n.phone||"N/A"})]})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Deposits"}),p.length===0?(0,e.jsx)("p",{className:"text-gray-500",children:"No deposits found"}):(0,e.jsx)(Xe,{data:p,columns:x,itemsPerPage:5})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Loans"}),f.length===0?(0,e.jsx)("p",{className:"text-gray-500",children:"No loans found"}):(0,e.jsx)(Xe,{data:f,columns:j,itemsPerPage:5})]})]})})]})})},Bs=(r,d)=>{const[n,p]=(0,t.useState)(r);return(0,t.useEffect)(()=>{const f=setTimeout(()=>{p(r)},d);return()=>{clearTimeout(f)}},[r,d]),n},Ws=()=>{const r=new Date().getFullYear(),[d,n]=(0,t.useState)(r),[p,f]=(0,t.useState)("all"),[x,j]=(0,t.useState)(""),[u,D]=(0,t.useState)(!1),[m,g]=(0,t.useState)([]),[E,C]=(0,t.useState)({}),[b,F]=(0,t.useState)(null),[T,N]=(0,t.useState)(!1),[c,S]=(0,t.useState)(null),[w,I]=(0,t.useState)(null),[Y,L]=(0,t.useState)(!0),[O,W]=(0,t.useState)(null),[X,h]=(0,t.useState)({deposits:null,loans:null}),[v,A]=(0,t.useState)(1),a=20,s=Bs(x,300),o=(0,t.useMemo)(()=>{if(Object.keys(E).length===0)return[];let y=Object.values(E);return s&&(y=$s(y,s)),u&&(y=y.filter(K=>K.unpaidLoansCount>0)),y},[E,s,u]),l=Math.ceil(o.length/a),P=(v-1)*a,M=P+a,_=o.slice(P,M);(0,t.useEffect)(()=>{A(1)},[o.length]);const B=(0,t.useMemo)(()=>c?{labels:c.labels,datasets:c.datasets}:null,[c]),i=(0,t.useMemo)(()=>w?{currentYear:{totalDeposits:w.currentYear.totalDeposits,totalLoans:w.currentYear.totalLoans,monthlyData:w.currentYear.monthlyData},previousYear:{totalDeposits:w.previousYear.totalDeposits,totalLoans:w.previousYear.totalLoans,monthlyData:w.previousYear.monthlyData}}:null,[w]),z=async()=>{try{const y=te(Q(U,"users")),K=await pe(y),ne=[];return K.forEach(G=>{ne.push({id:G.id,...G.data()})}),g(ne),ne}catch(y){return console.error("Error fetching users:",y),W("Failed to fetch users data"),[]}},R=async(y,K,ne)=>{try{try{const G=te(Q(U,"deposits"),ue("userId","in",y),ue("timestamp",">=",K),ue("timestamp","<=",ne),me("timestamp","desc")),de=await pe(G),ee={};return de.forEach(Z=>{const $={id:Z.id,...Z.data()};ee[$.userId]||(ee[$.userId]=[]),ee[$.userId].push($)}),ee}catch(G){if(G.message.includes("requires an index")){console.warn("Index not found for deposits query, using fallback"),h($=>({...$,deposits:G.message}));const de=te(Q(U,"deposits"),ue("userId","in",y)),ee=await pe(de),Z={};return ee.forEach($=>{const V={id:$.id,...$.data()},re=V.timestamp.toDate?V.timestamp.toDate():new Date(V.timestamp);re>=K&&re<=ne&&(Z[V.userId]||(Z[V.userId]=[]),Z[V.userId].push(V))}),Object.keys(Z).forEach($=>{Z[$].sort((V,re)=>{const ge=V.timestamp.toDate?V.timestamp.toDate():new Date(V.timestamp);return(re.timestamp.toDate?re.timestamp.toDate():new Date(re.timestamp))-ge})}),Z}else throw G}}catch(G){return console.error("Error fetching deposits:",G),{}}},J=async(y,K,ne)=>{try{try{const G=te(Q(U,"loans"),ue("userId","in",y),ue("timestamp",">=",K),ue("timestamp","<=",ne),me("timestamp","desc")),de=await pe(G),ee={};return de.forEach(Z=>{const $={id:Z.id,...Z.data()};ee[$.userId]||(ee[$.userId]=[]),ee[$.userId].push($)}),ee}catch(G){if(G.message.includes("requires an index")){console.warn("Index not found for loans query, using fallback"),h($=>({...$,loans:G.message}));const de=te(Q(U,"loans"),ue("userId","in",y)),ee=await pe(de),Z={};return ee.forEach($=>{const V={id:$.id,...$.data()},re=V.timestamp.toDate?V.timestamp.toDate():new Date(V.timestamp);re>=K&&re<=ne&&(Z[V.userId]||(Z[V.userId]=[]),Z[V.userId].push(V))}),Object.keys(Z).forEach($=>{Z[$].sort((V,re)=>{const ge=V.timestamp.toDate?V.timestamp.toDate():new Date(V.timestamp);return(re.timestamp.toDate?re.timestamp.toDate():new Date(re.timestamp))-ge})}),Z}else throw G}}catch(G){return console.error("Error fetching loans:",G),{}}},q=(0,t.useCallback)(async()=>{L(!0),W(null);try{const y=await z(),K={};let ne=[],G=[],de,ee;p==="all"?(de=Ke(d),ee=Ze(d)):(de=ct(d,parseInt(p)),ee=mt(d,parseInt(p)));const Z=y.map(k=>k.id),$=[];for(let k=0;k<Z.length;k+=10)$.push(Z.slice(k,k+10));const V=$.map(k=>R(k,de,ee)),re=$.map(k=>J(k,de,ee)),ge=await Promise.all(V),pt=await Promise.all(re),ze={},$e={};ge.forEach(k=>{Object.keys(k).forEach(H=>{ze[H]=k[H],ne=[...ne,...k[H]]})}),pt.forEach(k=>{Object.keys(k).forEach(H=>{$e[H]=k[H],G=[...G,...k[H]]})}),y.forEach(k=>{const H=ze[k.id]||[],_e=$e[k.id]||[],Nt=zs(H,_e);K[k.id]={user:k,deposits:H,loans:_e,...Nt}});const je=Qe(ne,G,d);S({labels:je.map(k=>k.month),datasets:[{label:"Deposits",data:je.map(k=>k.deposits),borderColor:"rgb(75, 192, 192)",backgroundColor:"rgba(75, 192, 192, 0.5)"},{label:"Loans",data:je.map(k=>k.loans),borderColor:"rgb(255, 99, 132)",backgroundColor:"rgba(255, 99, 132, 0.5)"}]});const Ye=Ke(d-1),Oe=Ze(d-1),gt=$.map(k=>R(k,Ye,Oe)),ft=$.map(k=>J(k,Ye,Oe)),yt=await Promise.all(gt),jt=await Promise.all(ft);let be=[],Ne=[];yt.forEach(k=>{Object.keys(k).forEach(H=>{be=[...be,...k[H]]})}),jt.forEach(k=>{Object.keys(k).forEach(H=>{Ne=[...Ne,...k[H]]})});const bt=Qe(be,Ne,d-1);I({currentYear:{totalDeposits:ne.reduce((k,H)=>k+H.amount,0),totalLoans:G.reduce((k,H)=>k+H.amount,0),monthlyData:je},previousYear:{totalDeposits:be.reduce((k,H)=>k+H.amount,0),totalLoans:Ne.reduce((k,H)=>k+H.amount,0),monthlyData:bt}}),C(K),L(!1)}catch(y){console.error("Error fetching user reports:",y),W("Failed to fetch reports data"),L(!1)}},[d,p]),se=(0,t.useCallback)(y=>{F(y),N(!0)},[]),le=(0,t.useCallback)(()=>{N(!1),F(null)},[]),xt=(0,t.useCallback)(()=>{const y=Object.values(E);Ys(y,`annual-reports-${d}.csv`)},[E,d]),ut=(0,t.useCallback)(()=>{const y=Object.values(E),K=Ms(y,d);K.success?console.log(`PDF "${K.filename}" generated successfully!`):console.error("Failed to generate PDF:",K.error)},[E,d]);(0,t.useEffect)(()=>{q()},[q]);const ht=()=>{const y=[];for(let K=r;K>=2022;K--)y.push(K);return y};return(0,e.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,e.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Annual Reports"}),(X.deposits||X.loans)&&(0,e.jsx)("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6",children:(0,e.jsxs)("div",{className:"flex",children:[(0,e.jsx)("div",{className:"flex-shrink-0",children:(0,e.jsx)("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,e.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,e.jsxs)("div",{className:"ml-3",children:[(0,e.jsx)("p",{className:"text-sm text-yellow-700",children:"Some queries require Firestore indexes for optimal performance. We're using fallback queries, but you can create the indexes for better performance:"}),(0,e.jsxs)("div",{className:"mt-2",children:[X.deposits&&(0,e.jsx)("a",{href:"https://console.firebase.google.com/v1/r/project/ecommerce-74229/firestore/indexes?create_composite=ClBwcm9qZWN0cy9lY29tbWVyY2UtNzQyMjkvZGF0YWJhc2VzLyhkZWZhdWx0KS9jb2xsZWN0aW9uR3JvdXBzL2RlcG9zaXRzL2luZGV4ZXMvXxABGgoKBnVzZXJJZBABGg0KCXRpbWVzdGFtcBACGgwKCF9fbmFtZV9fEAI",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline hover:text-blue-800 mr-4",children:"Create Deposits Index"}),X.loans&&(0,e.jsx)("a",{href:"https://console.firebase.google.com/v1/r/project/ecommerce-74229/firestore/indexes?create_composite=Ck1wcm9qZWN0cy9lY29tbWVyY2UtNzQyMjkvZGF0YWJhc2VzLyhkZWZhdWx0KS9jb2xsZWN0aW9uR3JvdXBzL2xvYW5zL2luZGV4ZXMvXxABGgoKBnVzZXJJZBABGg0KCXRpbWVzdGFtcBACGgwKCF9fbmFtZV9fEAI",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline hover:text-blue-800",children:"Create Loans Index"})]})]})]})}),(0,e.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{htmlFor:"year",className:"block text-sm font-medium text-gray-700 mb-1",children:"Year"}),(0,e.jsx)("select",{id:"year",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",value:d,onChange:y=>n(parseInt(y.target.value)),children:ht().map(y=>(0,e.jsx)("option",{value:y,children:y},y))})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{htmlFor:"month",className:"block text-sm font-medium text-gray-700 mb-1",children:"Month (Optional)"}),(0,e.jsxs)("select",{id:"month",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",value:p,onChange:y=>f(y.target.value),children:[(0,e.jsx)("option",{value:"all",children:"All Months"}),(0,e.jsx)("option",{value:"1",children:"January"}),(0,e.jsx)("option",{value:"2",children:"February"}),(0,e.jsx)("option",{value:"3",children:"March"}),(0,e.jsx)("option",{value:"4",children:"April"}),(0,e.jsx)("option",{value:"5",children:"May"}),(0,e.jsx)("option",{value:"6",children:"June"}),(0,e.jsx)("option",{value:"7",children:"July"}),(0,e.jsx)("option",{value:"8",children:"August"}),(0,e.jsx)("option",{value:"9",children:"September"}),(0,e.jsx)("option",{value:"10",children:"October"}),(0,e.jsx)("option",{value:"11",children:"November"}),(0,e.jsx)("option",{value:"12",children:"December"})]})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{htmlFor:"search",className:"block text-sm font-medium text-gray-700 mb-1",children:"Search User"}),(0,e.jsx)("input",{type:"text",id:"search",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Name, email, or phone",value:x,onChange:y=>j(y.target.value)})]}),(0,e.jsx)("div",{className:"flex items-end",children:(0,e.jsx)("button",{className:"w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",onClick:q,children:"Apply Filters"})})]}),(0,e.jsxs)("div",{className:"flex flex-wrap gap-4 items-center",children:[(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("input",{id:"showUnpaid",type:"checkbox",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",checked:u,onChange:y=>D(y.target.checked)}),(0,e.jsx)("label",{htmlFor:"showUnpaid",className:"ml-2 block text-sm text-gray-700",children:"Show only users with unpaid loans"})]}),(0,e.jsx)("button",{className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2",onClick:xt,children:"Export CSV"}),(0,e.jsx)("button",{className:"bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2",onClick:ut,children:"Export PDF"})]})]}),i&&(0,e.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,e.jsx)("h2",{className:"text-lg font-medium text-gray-800 mb-4",children:"Year Comparison"}),(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"text-md font-medium text-gray-700 mb-2",children:"Total Deposits"}),(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsxs)("div",{className:"text-2xl font-bold text-green-600",children:["$",i.currentYear.totalDeposits.toFixed(2)]}),(0,e.jsxs)("div",{className:"ml-4 text-sm text-gray-500",children:[i.currentYear.totalDeposits>i.previousYear.totalDeposits?(0,e.jsxs)("span",{className:"text-green-600",children:["â†‘ ",((i.currentYear.totalDeposits-i.previousYear.totalDeposits)/i.previousYear.totalDeposits*100).toFixed(1),"%"]}):(0,e.jsxs)("span",{className:"text-red-600",children:["â†“ ",((i.previousYear.totalDeposits-i.currentYear.totalDeposits)/i.previousYear.totalDeposits*100).toFixed(1),"%"]}),(0,e.jsxs)("span",{children:[" vs ",d-1]})]})]})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"text-md font-medium text-gray-700 mb-2",children:"Total Loans"}),(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsxs)("div",{className:"text-2xl font-bold text-blue-600",children:["$",i.currentYear.totalLoans.toFixed(2)]}),(0,e.jsxs)("div",{className:"ml-4 text-sm text-gray-500",children:[i.currentYear.totalLoans>i.previousYear.totalLoans?(0,e.jsxs)("span",{className:"text-green-600",children:["â†‘ ",((i.currentYear.totalLoans-i.previousYear.totalLoans)/i.previousYear.totalLoans*100).toFixed(1),"%"]}):(0,e.jsxs)("span",{className:"text-red-600",children:["â†“ ",((i.previousYear.totalLoans-i.currentYear.totalLoans)/i.previousYear.totalLoans*100).toFixed(1),"%"]}),(0,e.jsxs)("span",{children:[" vs ",d-1]})]})]})]})]})]}),B&&(0,e.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,e.jsx)("h2",{className:"text-lg font-medium text-gray-800 mb-4",children:"Deposits vs Loans by Month"}),(0,e.jsx)("div",{className:"h-64",children:(0,e.jsx)(qt,{data:B,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},title:{display:!1}}}})})]}),(0,e.jsxs)("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[(0,e.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,e.jsx)("h2",{className:"text-lg font-medium text-gray-800",children:"Users Summary"})}),Y?(0,e.jsx)("div",{className:"px-6 py-4 text-center",children:(0,e.jsx)("p",{className:"text-gray-500",children:"Loading reports..."})}):O?(0,e.jsx)("div",{className:"px-6 py-4 text-center",children:(0,e.jsx)("p",{className:"text-red-500",children:O})}):o.length===0?(0,e.jsx)("div",{className:"px-6 py-4 text-center",children:(0,e.jsx)("p",{className:"text-gray-500",children:"No users found"})}):(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Deposits"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Loans"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Paid Loans"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unpaid Loans"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:_.map(y=>(0,e.jsxs)("tr",{className:y.unpaidLoansCount>0?"border-l-4 border-red-500":"",children:[(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("div",{className:"flex-shrink-0 h-10 w-10",children:(0,e.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:(0,e.jsx)("span",{className:"text-gray-600 font-medium",children:y.user.name?y.user.name.charAt(0).toUpperCase():"U"})})}),(0,e.jsxs)("div",{className:"ml-4",children:[(0,e.jsx)("div",{className:"text-sm font-medium text-gray-900",children:y.user.name||"Unknown User"}),(0,e.jsx)("div",{className:"text-sm text-gray-500",children:y.user.email||"N/A"})]})]})}),(0,e.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["$",y.totalDeposits.toFixed(2)]}),(0,e.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["$",y.totalLoans.toFixed(2)]}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:y.paidLoansCount}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${y.unpaidLoansCount>0?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:y.unpaidLoansCount})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,e.jsx)("button",{onClick:()=>se(y.user.id),className:"text-blue-600 hover:text-blue-900",children:"View Details"})})]},y.user.id))})]})}),l>1&&(0,e.jsxs)("div",{className:"px-6 py-3 flex items-center justify-between border-t border-gray-200",children:[(0,e.jsxs)("div",{className:"flex-1 flex justify-between sm:hidden",children:[(0,e.jsx)("button",{onClick:()=>A(y=>Math.max(y-1,1)),disabled:v===1,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Previous"}),(0,e.jsx)("button",{onClick:()=>A(y=>Math.min(y+1,l)),disabled:v===l,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Next"})]}),(0,e.jsxs)("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[(0,e.jsx)("div",{children:(0,e.jsxs)("p",{className:"text-sm text-gray-700",children:["Showing ",(0,e.jsx)("span",{className:"font-medium",children:P+1})," to"," ",(0,e.jsx)("span",{className:"font-medium",children:Math.min(M,o.length)})," of"," ",(0,e.jsx)("span",{className:"font-medium",children:o.length})," results"]})}),(0,e.jsx)("div",{children:(0,e.jsxs)("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[(0,e.jsx)("button",{onClick:()=>A(y=>Math.max(y-1,1)),disabled:v===1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50",children:"Previous"}),Array.from({length:l},(y,K)=>K+1).map(y=>(0,e.jsx)("button",{onClick:()=>A(y),className:`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${v===y?"z-10 bg-blue-50 border-blue-500 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,children:y},y)),(0,e.jsx)("button",{onClick:()=>A(y=>Math.min(y+1,l)),disabled:v===l,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50",children:"Next"})]})})]})]})]})]}),b&&(0,e.jsx)(_s,{isOpen:T,onClose:le,user:E[b].user,deposits:E[b].deposits,loans:E[b].loans})]})},Vs=Ws,qs=({onAccessGranted:r})=>{const[d,n]=(0,t.useState)(""),[p,f]=(0,t.useState)(!1),[x,j]=(0,t.useState)(""),[u,D]=(0,t.useState)(""),[m,g]=(0,t.useState)(!1),[E,C]=(0,t.useState)(""),[b,F]=(0,t.useState)(""),[T,N]=(0,t.useState)(""),[c,S]=(0,t.useState)(!1),[w,I]=(0,t.useState)(!1),[Y,L]=(0,t.useState)(!1),O="Communitysavings4@gmail.com";(0,t.useEffect)(()=>{if(b){I(!0);const a=setTimeout(()=>{I(!1),setTimeout(()=>F(""),500)},3e3);return()=>clearTimeout(a)}},[b]),(0,t.useEffect)(()=>{if(T){L(!0);const a=setTimeout(()=>{L(!1),setTimeout(()=>{N(""),m&&g(!1)},500)},3e3);return()=>clearTimeout(a)}},[T,m]);const W=async a=>{a.preventDefault(),S(!0);try{const s=ae(U,"adminSettings","security"),o=await We(s);if(o.exists()){const{password:l}=o.data();d===l?r():F("Incorrect password. Please try again.")}else F("Admin settings not found. Please contact support.")}catch(s){console.error("Error fetching admin password:",s),F("Failed to verify password. Please try again.")}finally{S(!1)}},X=async a=>{a.preventDefault(),S(!0);try{const s=ls(),o=new Date;o.setMinutes(o.getMinutes()+15),await st(ae(U,"passwordResets",s),{token:s,expiresAt:o,used:!1});const l=`${window.location.origin}/admin-login?reset=true&token=${s}`;await ds.send("service_rbtk5y8","template_i85brpa",{to_email:O,reset_link:l},"zcAI9wNXtOd3ooJ67"),N("Password reset email sent! Check your inbox."),setTimeout(()=>{f(!1)},3e3)}catch(s){console.error("Error sending password reset email:",s),F("Failed to send reset email. Please try again.")}finally{S(!1)}},h=async a=>{if(a.preventDefault(),x!==u){F("Passwords do not match.");return}if(x.length<6){F("Password must be at least 6 characters long.");return}S(!0);try{const s=ae(U,"adminSettings","security");await ce(s,{password:x});const o=ae(U,"passwordResets",E);await ce(o,{used:!0}),N("Password updated successfully!"),j(""),D(""),setTimeout(()=>{window.location.href="/admin-login"},3e3)}catch(s){console.error("Error updating password:",s),F("Failed to update password. Please try again.")}finally{S(!1)}};return(0,t.useEffect)(()=>{const a=new URLSearchParams(window.location.search),s=a.get("reset"),o=a.get("token");s==="true"&&o&&(async()=>{try{const P=ae(U,"passwordResets",o),M=await We(P);if(!M.exists()){F("Invalid or expired reset link.");return}const _=M.data();if(_.used||new Date>_.expiresAt.toDate()){F("This reset link has expired.");return}g(!0),C(o)}catch(P){console.error("Error verifying reset token:",P),F("Failed to verify reset link.")}})()},[]),m?(0,e.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,e.jsxs)("div",{className:"bg-white shadow-lg rounded-2xl p-8 w-96 max-w-md",children:[(0,e.jsx)("h2",{className:"text-2xl font-bold text-center mb-6 text-gray-800",children:"Reset Admin Password"}),(0,e.jsxs)("form",{onSubmit:h,children:[(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"New Password"}),(0,e.jsx)("input",{type:"password",id:"newPassword",value:x,onChange:a=>j(a.target.value),className:"border border-gray-300 rounded-md p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-full transition-colors",required:!0})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm New Password"}),(0,e.jsx)("input",{type:"password",id:"confirmPassword",value:u,onChange:a=>D(a.target.value),className:"border border-gray-300 rounded-md p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-full transition-colors",required:!0})]}),(0,e.jsx)("button",{type:"submit",disabled:c,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md w-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Updating...":"Reset Password"})]}),(0,e.jsx)("div",{className:"mt-4 text-center",children:(0,e.jsx)("button",{onClick:()=>g(!1),className:"text-blue-600 text-sm hover:underline",children:"Back to login"})}),b&&(0,e.jsx)("div",{className:`text-red-500 mt-4 transition-opacity duration-500 ${w?"opacity-100":"opacity-0"}`,children:b}),T&&(0,e.jsx)("div",{className:`text-green-500 mt-4 transition-opacity duration-500 ${Y?"opacity-100":"opacity-0"}`,children:T})]})}):(0,e.jsxs)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:[(0,e.jsxs)("div",{className:"bg-white shadow-lg rounded-2xl p-8 w-96 max-w-md",children:[(0,e.jsx)("h2",{className:"text-2xl font-bold text-center mb-6 text-gray-800",children:"Admin Access"}),(0,e.jsxs)("form",{onSubmit:W,children:[(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,e.jsx)("input",{type:"password",id:"password",value:d,onChange:a=>n(a.target.value),className:"border border-gray-300 rounded-md p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-full transition-colors",required:!0})]}),(0,e.jsx)("button",{type:"submit",disabled:c,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md w-full mt-4 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Verifying...":"Access Admin Dashboard"})]}),b&&(0,e.jsx)("div",{className:`text-red-500 mt-2 transition-opacity duration-500 ${w?"opacity-100":"opacity-0"}`,children:b}),T&&(0,e.jsx)("div",{className:`text-green-500 mt-2 transition-opacity duration-500 ${Y?"opacity-100":"opacity-0"}`,children:T}),(0,e.jsx)("div",{className:"text-blue-600 text-sm mt-3 hover:underline cursor-pointer text-center",onClick:()=>f(!0),children:"Forgot password?"})]}),p&&(0,e.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:(0,e.jsxs)("div",{className:"bg-white shadow-lg rounded-2xl p-8 w-96 max-w-md",children:[(0,e.jsx)("h2",{className:"text-xl font-bold text-center mb-4 text-gray-800",children:"Reset Password"}),(0,e.jsx)("p",{className:"text-gray-600 text-sm mb-6",children:"A reset link will be sent to the admin email."}),(0,e.jsx)("div",{className:"mb-6 p-3 bg-gray-100 rounded-md",children:(0,e.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,e.jsx)("span",{className:"font-medium",children:"Email:"})," ",O]})}),(0,e.jsx)("form",{onSubmit:X,children:(0,e.jsxs)("div",{className:"flex space-x-3",children:[(0,e.jsx)("button",{type:"button",onClick:()=>f(!1),className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-md w-1/2 transition-colors",children:"Cancel"}),(0,e.jsx)("button",{type:"submit",disabled:c,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md w-1/2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Sending...":"Send Reset Link"})]})}),b&&(0,e.jsx)("div",{className:`text-red-500 mt-4 transition-opacity duration-500 ${w?"opacity-100":"opacity-0"}`,children:b}),T&&(0,e.jsx)("div",{className:`text-green-500 mt-4 transition-opacity duration-500 ${Y?"opacity-100":"opacity-0"}`,children:T})]})})]})},Gs=qs;function Ks({children:r}){const{currentUser:d}=he();return d?r:(0,e.jsx)(tt,{to:"/login"})}function Je({children:r}){const{currentUser:d}=he();return d?(0,e.jsx)(tt,{to:"/dashboard"}):r}function Zs(){const[r,d]=(0,t.useState)(!1);return r?(0,e.jsxs)(Ct,{children:[(0,e.jsx)(oe,{path:"/login",element:(0,e.jsx)(Je,{children:(0,e.jsx)(gs,{})})}),(0,e.jsx)(oe,{path:"/signup",element:(0,e.jsx)(Je,{children:(0,e.jsx)(fs,{})})}),(0,e.jsxs)(oe,{path:"/",element:(0,e.jsx)(Ks,{children:(0,e.jsx)(Ls,{})}),children:[(0,e.jsx)(oe,{index:!0,element:(0,e.jsx)(Ge,{})}),(0,e.jsx)(oe,{path:"profile",element:(0,e.jsx)(js,{})}),(0,e.jsx)(oe,{path:"dashboard",element:(0,e.jsx)(Ge,{})}),(0,e.jsx)(oe,{path:"deposits",element:(0,e.jsx)(Ss,{})}),(0,e.jsx)(oe,{path:"loans",element:(0,e.jsx)(Es,{})}),(0,e.jsx)(oe,{path:"payback",element:(0,e.jsx)(ws,{})}),(0,e.jsx)(oe,{path:"users",element:(0,e.jsx)(Us,{})}),(0,e.jsx)(oe,{path:"settings",element:(0,e.jsx)(Is,{})}),(0,e.jsx)(oe,{path:"chat",element:(0,e.jsx)(ks,{})}),(0,e.jsx)(oe,{path:"annual-reports",element:(0,e.jsx)(Vs,{})})]})]}):(0,e.jsx)(Gs,{onAccessGranted:()=>d(!0)})}var Hs=Zs;(0,hs.createRoot)(document.getElementById("root")).render((0,e.jsx)(t.StrictMode,{children:(0,e.jsx)(ps,{children:(0,e.jsx)(At,{children:(0,e.jsx)(Hs,{})})})}));
