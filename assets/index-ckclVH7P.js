import{o as Ae}from"./rolldown-runtime-O3PcEg2i.js";import{a as Ue,c as Ee,d as St,i as Pe,l as Fe,n as st,o as Te,r as Ie,s as Ve,t as Dt}from"./charting-BTEZ5LFh.js";import{t as kt}from"./react-dom-B_yxW9B6.js";import{a as ne,c as be,i as Ct,n as $e,o as At,r as at,s as Lt,t as Ut}from"./react-router-DN1Q4BFP.js";import{_ as Et,a as pe,b as Pt,c as ie,d as xe,f as rt,g as Ft,h as Tt,i as Se,l as me,m as he,n as X,o as It,p as de,r as te,s as Rt,t as Mt,u as ae,v as $t,y as Re}from"./firebase-CyM-FwhB.js";import{a as zt,c as Ot,i as _t,l as Yt,n as Bt,o as Wt,r as Vt,s as qt,t as Kt,u as Gt}from"./react-CbSgh8yl.js";import{C as Ht,D as Zt,E as Qt,O as Jt,S as Me,T as Xt,_ as nt,a as es,b as it,c as ts,d as qe,f as ss,g as ze,h as as,i as Ke,k as rs,l as ns,m as lt,n as is,o as Ge,p as ls,r as ot,s as je,t as De,u as os,v as ke,w as ds,x as ye,y as Ce}from"./lucide-icons-Bw25EZYu.js";import{Bt as dt,Ft as cs,Ht as ms,It as xs,Lt as us,Rt as hs,Vt as gs,zt as ps}from"./vendor-C04N904u.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))u(f);new MutationObserver(f=>{for(const m of f)if(m.type==="childList")for(const w of m.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&u(w)}).observe(document,{childList:!0,subtree:!0});function n(f){const m={};return f.integrity&&(m.integrity=f.integrity),f.referrerPolicy&&(m.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?m.credentials="include":f.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function u(f){if(f.ep)return;f.ep=!0;const m=n(f);fetch(f.href,m)}})();var fs=Ae(kt()),t=Ae(St()),ct=Pt({apiKey:"AIzaSyBKs_0tOsl6OrDQOSTQDD4ghHv3PHLNFqo",authDomain:"money-saving-community.firebaseapp.com",projectId:"money-saving-community",storageBucket:"money-saving-community.firebasestorage.app",messagingSenderId:"1023049683110",appId:"1:1023049683110:web:fa5c36a12cb20440412467",measurementId:"G-1K6718VQSL"}),ge=Ft(ct),E=It(ct),e=Ae(Gt()),mt=(0,t.createContext)();const ue=()=>(0,t.useContext)(mt),ys=({children:a})=>{const[o,n]=(0,t.useState)(null),[u,f]=(0,t.useState)(!0),m=(c,h)=>Tt(ge,c,h),w=async(c,h)=>{try{const k=await $t(ge,c,h),D=k.user,v=te(E,"users",D.uid),A=await Se(v);if(A.exists()&&A.data().isBlocked===!0)throw await Re(ge),new Error("Account is blocked");return k}catch(k){throw k}},p=()=>Re(ge);(0,t.useEffect)(()=>Et(ge,c=>{n(c),f(!1)}),[]);const y={currentUser:o,signup:m,login:w,logout:p};return(0,e.jsx)(mt.Provider,{value:y,children:u?(0,e.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):a})};function js(){const a=(0,t.useRef)(),o=(0,t.useRef)(),{login:n}=ue(),u=be(),[f,m]=(0,t.useState)(""),[w,p]=(0,t.useState)(!1),y=async c=>{c.preventDefault();try{m(""),p(!0),await n(a.current.value,o.current.value),u("/dashboard")}catch(h){h.message==="Account is blocked"?u("/blocked"):m("Failed to sign in. Please check your credentials and try again.")}p(!1)};return(0,e.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-400 to-gray-100 p-4",children:(0,e.jsx)("div",{className:"w-full max-w-md",children:(0,e.jsxs)("form",{onSubmit:y,className:"bg-white p-8 rounded-2xl shadow-lg border border-gray-100",children:[(0,e.jsxs)("div",{className:"text-center mb-8",children:[(0,e.jsx)("div",{className:"mx-auto w-16 h-16 bg-indigo-600 rounded-full flex items-center justify-center mb-4",children:(0,e.jsx)("span",{className:"text-white font-bold text-xl",children:"MB"})}),(0,e.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Welcome Back"}),(0,e.jsx)("p",{className:"text-gray-600 mt-2",children:"Sign in to your account"})]}),f&&(0,e.jsx)("div",{className:"bg-red-50 text-red-700 p-3 rounded-lg mb-6 text-sm",children:f}),(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,e.jsx)("input",{type:"email",id:"email",ref:a,placeholder:"Enter your email",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,e.jsx)("input",{type:"password",id:"password",ref:o,placeholder:"Enter your password",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,e.jsx)("button",{disabled:w,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white p-2 rounded-lg transition-colors duration-200 disabled:opacity-50",children:w?"Signing In...":"Sign In"}),(0,e.jsxs)("p",{className:"mt-6 text-center text-gray-600",children:["Don't have an account?"," ",(0,e.jsx)($e,{to:"/signup",className:"text-indigo-600 hover:text-indigo-800 font-medium",children:"Sign Up"})]})]})})})}function bs(){const a=(0,t.useRef)(),o=(0,t.useRef)(),n=(0,t.useRef)(),{signup:u}=ue(),f=be(),[m,w]=(0,t.useState)(""),[p,y]=(0,t.useState)(!1),c=async h=>{if(h.preventDefault(),o.current.value!==n.current.value)return w("Passwords do not match");if(o.current.value.length<6)return w("Password should be at least 6 characters");try{w(""),y(!0),await u(a.current.value,o.current.value),f("/dashboard")}catch{w("Failed to create an account. Please try again.")}y(!1)};return(0,e.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-400 to-gray-100 p-4",children:(0,e.jsx)("div",{className:"w-full max-w-md",children:(0,e.jsxs)("form",{onSubmit:c,className:"bg-white p-8 rounded-2xl shadow-lg border border-gray-100",children:[(0,e.jsxs)("div",{className:"text-center mb-8",children:[(0,e.jsx)("div",{className:"mx-auto w-16 h-16 bg-indigo-600 rounded-full flex items-center justify-center mb-4",children:(0,e.jsx)("span",{className:"text-white font-bold text-xl",children:"MB"})}),(0,e.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Create Account"}),(0,e.jsx)("p",{className:"text-gray-600 mt-2",children:"Sign up to get started"})]}),m&&(0,e.jsx)("div",{className:"bg-red-50 text-red-700 p-3 rounded-lg mb-6 text-sm",children:m}),(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,e.jsx)("input",{type:"email",id:"email",ref:a,placeholder:"Enter your email",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,e.jsx)("input",{type:"password",id:"password",ref:o,placeholder:"Create a password",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm Password"}),(0,e.jsx)("input",{type:"password",id:"confirmPassword",ref:n,placeholder:"Confirm your password",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,e.jsx)("button",{disabled:p,className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white p-2 rounded-lg transition-colors duration-200 disabled:opacity-50",children:p?"Creating Account...":"Sign Up"}),(0,e.jsxs)("p",{className:"mt-6 text-center text-gray-600",children:["Already have an account?"," ",(0,e.jsx)($e,{to:"/login",className:"text-indigo-600 hover:text-indigo-800 font-medium",children:"Sign In"})]})]})})})}var ws=()=>(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{children:[(0,e.jsx)("h1",{children:"Create your porfile"}),(0,e.jsxs)("form",{action:"",children:[(0,e.jsx)("input",{type:"text",placeholder:"Your full name "}),(0,e.jsx)("input",{type:"email",placeholder:"Your email",name:"",id:""}),(0,e.jsx)("input",{type:"number",placeholder:"You phone number ",name:"",id:""}),(0,e.jsx)("input",{type:"number",placeholder:"You Age  ",name:"",id:""}),(0,e.jsxs)("option",{value:"",children:[(0,e.jsx)("select",{name:"male",id:"",children:"Male"}),(0,e.jsx)("select",{name:"female",id:"",children:"Female"})]}),(0,e.jsx)("input",{type:"file",placeholder:"Upload your photo"}),(0,e.jsx)("button",{type:"submit",children:"Create account"})]})]})}),Ns=ws,vs=()=>{const[a,o]=(0,t.useState)(0),[n,u]=(0,t.useState)(0),[f,m]=(0,t.useState)(0),[w,p]=(0,t.useState)(0),[y,c]=(0,t.useState)(!1),[h,k]=(0,t.useState)(!1),[D,v]=(0,t.useState)(!1),[A,R]=(0,t.useState)([]),[M,x]=(0,t.useState)([]),[F,C]=(0,t.useState)([]),[z,B]=(0,t.useState)(!0),[U,W]=(0,t.useState)({width:window.innerWidth,height:window.innerHeight});(0,t.useEffect)(()=>{const r=()=>{W({width:window.innerWidth,height:window.innerHeight})};return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]);const q=r=>new Date(r).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",hour12:!0});(0,t.useEffect)(()=>{if(!E){v("Firestore instance not available"),B(!1);return}const r=ae(X(E,"users")),S=ie(r,P=>{try{const $=P.docs.map(I=>({id:I.id,...I.data()})).sort((I,i)=>I.createdAt&&i.createdAt?i.createdAt.toMillis()-I.createdAt.toMillis():I.createdAt?-1:i.createdAt?1:0);C($),p($.length),B(!1),v(!1)}catch($){console.error("Error processing users snapshot:",$),v("Failed to process users data"),B(!1)}},P=>{console.error("Error fetching users:",P),P.code==="permission-denied"?v("Permission denied. Check Firestore rules."):v("Failed to load users: "+(P.message||"Unknown error")),B(!1)});return()=>S()},[]);const H=({active:r,payload:S,label:P})=>{if(r&&S&&S.length){const $=S[0].payload,I=U.width<768;return(0,e.jsxs)("div",{className:`bg-white border border-gray-200 shadow-lg rounded-md ${I?"p-2":"p-4"}`,children:[(0,e.jsx)("p",{className:`font-medium text-gray-900 ${I?"text-xs":"text-sm"}`,children:q($.timestamp)}),(0,e.jsxs)("p",{className:`text-indigo-600 ${I?"text-xs":"text-sm"}`,children:["Deposits: $",$.deposits.toFixed(2)]}),(0,e.jsxs)("p",{className:`text-red-600 ${I?"text-xs":"text-sm"}`,children:["loans: $",$.loans.toFixed(2)]})]})}return null},l=(r,S,P=20)=>{const $=[];return r.forEach(I=>{const i=I.timestamp?.toDate?.()||new Date(I.timestamp);$.push({timestamp:i,name:i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),deposits:Number(I.amount)||0,loans:0})}),S.forEach(I=>{const i=I.timestamp?.toDate?.()||new Date(I.timestamp);$.push({timestamp:i,name:i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),deposits:0,loans:Number(I.amount)||0})}),$.sort((I,i)=>I.timestamp-i.timestamp),$.slice(-P)};(0,t.useEffect)(()=>{if(!E){console.error("Firestore database instance not available"),c(!0),k(!0);return}let r=[],S=[];const P=ae(X(E,"deposits"),me("timestamp","desc")),$=ie(P,O=>{try{let T=0;r=[],O.forEach(_=>{const ee=_.data();ee.amount&&(T+=parseFloat(ee.amount)),r.push({id:_.id,...ee,timestamp:ee.timestamp})}),o(T),c(!1);const Y=l(r,S);R(Y),x(_=>[...r.slice(0,3).map(ee=>({id:ee.id,type:"deposit",userId:ee.userId,amount:ee.amount,timestamp:ee.timestamp?.toDate?.()||new Date})),..._].slice(0,6))}catch(T){console.error("Error processing deposits data:",T),c(!0)}},O=>{console.error("Error fetching deposits:",O),c(!0)}),I=ae(X(E,"loans"),me("timestamp","desc")),i=ie(I,O=>{try{let T=0,Y=0;S=[],O.forEach(ee=>{const oe=ee.data();oe.amount&&(T+=parseFloat(oe.amount)),oe.status==="pending"&&(Y+=1),S.push({id:ee.id,...oe,timestamp:oe.timestamp})}),u(T),m(Y),k(!1);const _=l(r,S);R(_),x(ee=>[...S.slice(0,3).map(oe=>({id:oe.id,type:"cashout",userId:oe.userId,amount:oe.amount,status:oe.status,timestamp:oe.timestamp?.toDate?.()||new Date})),...ee].slice(0,6))}catch(T){console.error("Error processing loans data:",T),k(!0)}},O=>{console.error("Error fetching loans:",O),k(!0)});return()=>{$(),i()}},[]);const g=r=>`$${r.toFixed(2)}`,j=r=>new Date(r).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),N=[{id:1,name:"Total Deposits",value:y?"N/A":g(a),change:"+12.5%",changeType:"positive",icon:ke,iconColor:"bg-indigo-500"},{id:2,name:"Total loans",value:h?"N/A":g(n),change:"+8.2%",changeType:"positive",icon:Ce,iconColor:"bg-red-500"},{id:3,name:"Pending loans",value:h?"N/A":f,change:"+3.1%",changeType:"negative",icon:rs,iconColor:"bg-yellow-500"},{id:4,name:"Total Users",value:D?"N/A":w,change:"+5.4%",changeType:"positive",icon:ot,iconColor:"bg-green-500"}],s=(()=>{const r=U.width<768,S=U.width>=768&&U.width<1024;return{margin:{top:r?5:10,right:r?10:30,left:r?5:20,bottom:r?10:5},tickFontSize:r?8:S?10:12,interval:r?"preserveStartEnd":0,minTickGap:r?10:15,barSize:r?10:15,animationDuration:r?500:800,gridStrokeDasharray:r?"2 2":"3 3"}})();return z?(0,e.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading dashboard..."})]})}):(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6",children:N.map(r=>(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-4 sm:p-6 transition-all duration-200 hover:shadow-md",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-xs sm:text-sm font-medium text-gray-500",children:r.name}),(0,e.jsx)("p",{className:"mt-1 sm:mt-2 text-2xl sm:text-3xl font-bold text-gray-900",children:r.value})]}),(0,e.jsx)("div",{className:`p-2 sm:p-3 rounded-full ${r.iconColor}`,children:(0,e.jsx)(r.icon,{className:"h-5 w-5 sm:h-6 sm:w-6 text-white"})})]}),(0,e.jsxs)("div",{className:"mt-3 sm:mt-4 flex items-center",children:[r.changeType==="positive"?(0,e.jsx)(Zt,{className:"h-3 w-3 sm:h-4 sm:w-4 text-green-500"}):(0,e.jsx)(Jt,{className:"h-3 w-3 sm:h-4 sm:w-4 text-red-500"}),(0,e.jsx)("span",{className:`ml-1 text-xs sm:text-sm font-medium ${r.changeType==="positive"?"text-green-500":"text-red-500"}`,children:r.change}),(0,e.jsx)("span",{className:"ml-1 sm:ml-2 text-xs sm:text-sm text-gray-500",children:"from last month"})]})]},r.id))}),(0,e.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-4 sm:p-6",children:[(0,e.jsx)("h3",{className:"text-base sm:text-lg font-medium text-gray-900 mb-3 sm:mb-4",children:"Live Transactions"}),(0,e.jsx)("div",{className:"h-64 sm:h-80 overflow-x-auto",children:(0,e.jsx)(Fe,{width:"100%",height:"100%",minWidth:300,children:(0,e.jsxs)(Dt,{data:A,margin:s.margin,children:[(0,e.jsx)(Te,{strokeDasharray:s.gridStrokeDasharray}),(0,e.jsx)(Pe,{dataKey:"name",tick:{fontSize:s.tickFontSize},interval:s.interval,minTickGap:s.minTickGap}),(0,e.jsx)(Ie,{tick:{fontSize:s.tickFontSize}}),(0,e.jsx)(Ee,{content:(0,e.jsx)(H,{})}),(0,e.jsx)(Ve,{dataKey:"deposits",fill:"#4f46e5",name:"Deposits",barSize:s.barSize,isAnimationActive:!0,animationDuration:s.animationDuration,animationEasing:"ease-in-out"}),(0,e.jsx)(Ve,{dataKey:"loans",fill:"#ef4444",name:"loans",barSize:s.barSize,isAnimationActive:!0,animationDuration:s.animationDuration,animationEasing:"ease-in-out"})]})})})]}),(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-4 sm:p-6",children:[(0,e.jsx)("h3",{className:"text-base sm:text-lg font-medium text-gray-900 mb-3 sm:mb-4",children:"Transaction Trend"}),(0,e.jsx)("div",{className:"h-64 sm:h-80 overflow-x-auto",children:(0,e.jsx)(Fe,{width:"100%",height:"100%",minWidth:300,children:(0,e.jsxs)(st,{data:A,margin:s.margin,children:[(0,e.jsx)(Te,{strokeDasharray:s.gridStrokeDasharray}),(0,e.jsx)(Pe,{dataKey:"name",tick:{fontSize:s.tickFontSize},interval:s.interval,minTickGap:s.minTickGap}),(0,e.jsx)(Ie,{tick:{fontSize:s.tickFontSize}}),(0,e.jsx)(Ee,{content:(0,e.jsx)(H,{})}),(0,e.jsx)(Ue,{type:"monotone",dataKey:"deposits",stroke:"#4f46e5",activeDot:{r:U.width<768?4:8},name:"Deposits",strokeWidth:U.width<768?1.5:2,isAnimationActive:!0,animationDuration:s.animationDuration,animationEasing:"ease-in-out"}),(0,e.jsx)(Ue,{type:"monotone",dataKey:"loans",stroke:"#ef4444",name:"loans",strokeWidth:U.width<768?1.5:2,isAnimationActive:!0,animationDuration:s.animationDuration,animationEasing:"ease-in-out"})]})})})]})]}),(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-4 sm:p-6",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:[(0,e.jsx)("h3",{className:"text-base sm:text-lg font-medium text-gray-900",children:"Recent Activity"}),(0,e.jsx)("button",{className:"text-sm font-medium text-indigo-600 hover:text-indigo-800",children:"View all"})]}),(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{scope:"col",className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),(0,e.jsx)("th",{scope:"col",className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User ID"}),(0,e.jsx)("th",{scope:"col",className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,e.jsx)("th",{scope:"col",className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{scope:"col",className:"px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:M.length>0?M.map(r=>(0,e.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[(0,e.jsx)("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap",children:(0,e.jsxs)("div",{className:"flex items-center",children:[r.type==="deposit"?(0,e.jsx)("div",{className:"w-6 h-6 sm:w-8 sm:h-8 rounded-full bg-indigo-100 flex items-center justify-center",children:(0,e.jsx)(ke,{className:"h-3 w-3 sm:h-4 sm:w-4 text-indigo-600"})}):(0,e.jsx)("div",{className:"w-6 h-6 sm:w-8 sm:h-8 rounded-full bg-red-100 flex items-center justify-center",children:(0,e.jsx)(Ce,{className:"h-3 w-3 sm:h-4 sm:w-4 text-red-600"})}),(0,e.jsx)("span",{className:"ml-2 sm:ml-3 text-xs sm:text-sm font-medium text-gray-900 capitalize",children:r.type})]})}),(0,e.jsx)("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500",children:r.userId||"N/A"}),(0,e.jsx)("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm font-medium text-gray-900",children:g(r.amount||0)}),(0,e.jsx)("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap",children:r.type==="deposit"?(0,e.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800",children:"Completed"}):(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${r.status==="Pending"?"bg-yellow-100 text-yellow-800":r.status==="Accepted"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:r.status||"Pending"})}),(0,e.jsx)("td",{className:"px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500",children:j(r.timestamp)})]},r.id)):(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:"5",className:"px-3 sm:px-6 py-3 sm:py-4 text-center text-xs sm:text-sm text-gray-500",children:"No recent activity"})})})]})})]})]})},He=vs,Ss=()=>{const{currentUser:a}=ue(),[o,n]=(0,t.useState)([]),[u,f]=(0,t.useState)([]),[m,w]=(0,t.useState)(!0),[p,y]=(0,t.useState)(null),[c,h]=(0,t.useState)(""),[k,D]=(0,t.useState)(null),[v,A]=(0,t.useState)(!1),[R,M]=(0,t.useState)(new Set);(0,t.useEffect)(()=>{if(!a)return;const l=ie(X(E,"users"),g=>{const j=[];g.forEach(N=>{j.push({id:N.id,...N.data()})}),f(j)},g=>{console.error("Error fetching users:",g)});return()=>l()},[a]),(0,t.useEffect)(()=>{if(!a)return;const l=ie(X(E,"loans"),g=>{const j=[];g.forEach(N=>{j.push({id:N.id,...N.data()})}),j.sort((N,d)=>{const s=N.paymentTimestamp?.toDate?.()||new Date(0);return(d.paymentTimestamp?.toDate?.()||new Date(0))-s}),n(j),w(!1)},g=>{console.error("Error fetching paybacks:",g),w(!1)});return()=>l()},[a]);const x=o.map(l=>{const g=u.find(j=>j.uid===l.userId);return{...l,userName:g?.fullName||"Unknown User",userEmail:g?.email||"No email provided"}}),F=(l,g)=>{y({message:l,type:g}),setTimeout(()=>{y(null)},3e3)},C=async l=>{try{M(g=>new Set(g).add(l)),setTimeout(async()=>{const g=te(E,"loans",l);await de(g,{paymentStatus:"approved",adminReviewedAt:xe()}),setTimeout(()=>{M(j=>{const N=new Set(j);return N.delete(l),N})},300),F("Payment approved successfully!","success")},100)}catch(g){console.error("Error approving payment:",g),F("Failed to approve payment. Please try again.","error"),M(j=>{const N=new Set(j);return N.delete(l),N})}},z=async l=>{try{M(g=>new Set(g).add(l)),setTimeout(async()=>{const g=te(E,"loans",l);await de(g,{paymentStatus:"denied",adminReviewedAt:xe()}),setTimeout(()=>{M(j=>{const N=new Set(j);return N.delete(l),N})},300),F("Payment denied.","error")},100)}catch(g){console.error("Error denying payment:",g),F("Failed to deny payment. Please try again.","error"),M(j=>{const N=new Set(j);return N.delete(l),N})}},B=l=>{D(l),A(!0)},U=()=>{A(!1),D(null)},W=l=>{if(!l)return"N/A";const g=l.toDate(),j=g.getDate().toString().padStart(2,"0"),N=(g.getMonth()+1).toString().padStart(2,"0"),d=g.getFullYear(),s=g.getHours().toString().padStart(2,"0"),r=g.getMinutes().toString().padStart(2,"0");return`${j}/${N}/${d} ${s}:${r}`},q=x.filter(l=>{if(l.status!=="accepted")return!1;const g=l.userName||"",j=c.toLowerCase();return g.toLowerCase().includes(j)}),H=x.filter(l=>l.status==="accepted"&&l.paymentStatus==="pending").length;return(0,e.jsxs)("div",{className:"min-h-screen bg-gray-50 py-8",children:[p&&(0,e.jsx)("div",{className:`fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-lg transform transition-all duration-300 ${p.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:p.message}),(0,e.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,e.jsxs)("div",{className:"mb-8",children:[(0,e.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Loan Repayment Management"}),(0,e.jsx)("p",{className:"mt-2 text-gray-600",children:"Review and manage loan repayments for accepted loans"})]}),(0,e.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6 mb-6",children:(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,e.jsx)(je,{className:"h-5 w-5 text-gray-400"})}),(0,e.jsx)("input",{type:"text",placeholder:"Search by user name...",value:c,onChange:l=>h(l.target.value),className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]})}),(0,e.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[(0,e.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,e.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Accepted Loan Repayments"}),(0,e.jsxs)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800",children:[H," pending"]})]}),m?(0,e.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mb-4"}),(0,e.jsx)("p",{className:"text-gray-600",children:"Loading loan repayments..."})]}):q.length===0?(0,e.jsxs)("div",{className:"text-center py-12",children:[(0,e.jsx)("div",{className:"mx-auto h-16 w-16 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:(0,e.jsx)(je,{className:"h-8 w-8 text-gray-400"})}),(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No accepted loans found"}),(0,e.jsx)("p",{className:"text-gray-500",children:"There are no accepted loans at the moment."})]}):(0,e.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:q.map(l=>{const g=R.has(l.id),j=!l.paymentStatus||l.paymentStatus==="pending";return(0,e.jsx)("div",{className:`bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden transition-all duration-300 hover:shadow-md ${g?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:(0,e.jsxs)("div",{className:"p-6",children:[(0,e.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-indigo-100 flex items-center justify-center",children:(0,e.jsx)("span",{className:"text-indigo-800 font-medium",children:l.userName?.charAt(0)?.toUpperCase()||"U"})}),(0,e.jsxs)("div",{className:"ml-3",children:[(0,e.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:l.userName||"Unknown User"}),(0,e.jsx)("p",{className:"text-sm text-gray-500",children:l.userEmail||"No email provided"})]})]}),(0,e.jsx)("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                            ${l.paymentStatus==="approved"?"bg-green-100 text-green-800":l.paymentStatus==="denied"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:l.paymentStatus?.charAt(0)?.toUpperCase()+l.paymentStatus?.slice(1)||"Pending"})]}),(0,e.jsxs)("div",{className:"space-y-3 mb-6",children:[(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Loan Amount"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",l.amount]})]}),(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Interest (10%)"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",(l.amount*.1).toFixed(2)]})]}),(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Total Payable"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",l.totalPayable?.toFixed(2)||(l.amount*1.1).toFixed(2)]})]}),(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Paid Amount"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",l.paidAmount]})]}),(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Payment Date"}),(0,e.jsx)("span",{className:"text-sm font-medium text-gray-900",children:W(l.paymentTimestamp)})]}),l.adminReviewedAt&&(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Reviewed At"}),(0,e.jsx)("span",{className:"text-sm font-medium text-gray-900",children:W(l.adminReviewedAt)})]})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("span",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Proof of Payment"}),l.proofImageUrl?(0,e.jsxs)("div",{className:"relative w-full h-32 rounded-lg overflow-hidden cursor-pointer border border-gray-200",onClick:()=>B(l.proofImageUrl),children:[(0,e.jsx)("img",{src:l.proofImageUrl,alt:"Proof of payment",className:"w-full h-full object-cover"}),(0,e.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity",children:(0,e.jsx)(ze,{className:"h-6 w-6 text-white"})})]}):(0,e.jsx)("div",{className:"w-full h-32 rounded-lg bg-gray-100 flex items-center justify-center border border-gray-200",children:(0,e.jsx)("span",{className:"text-gray-500 text-sm",children:"No proof provided"})})]}),(0,e.jsxs)("div",{className:"flex space-x-3",children:[(0,e.jsxs)("button",{className:`flex-1 inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg transition-colors ${j?"text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500":"text-gray-400 bg-gray-100 cursor-not-allowed"}`,onClick:()=>C(l.id),disabled:!j,children:[(0,e.jsx)(Ht,{className:"-ml-1 mr-2 h-4 w-4"}),"Approve"]}),(0,e.jsxs)("button",{className:`flex-1 inline-flex items-center justify-center px-4 py-2 border text-sm font-medium rounded-lg transition-colors ${j?"text-gray-700 bg-white border-gray-300 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500":"text-gray-400 bg-gray-100 border-gray-200 cursor-not-allowed"}`,onClick:()=>z(l.id),disabled:!j,children:[(0,e.jsx)(De,{className:"-ml-1 mr-2 h-4 w-4"}),"Deny"]})]})]})},l.id)})})]})]}),v&&(0,e.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",onClick:U,children:(0,e.jsxs)("div",{className:"relative max-w-4xl max-h-full",onClick:l=>l.stopPropagation(),children:[(0,e.jsx)("button",{className:"absolute -top-12 right-0 text-white hover:text-gray-300 focus:outline-none",onClick:U,children:(0,e.jsx)(De,{className:"h-8 w-8"})}),(0,e.jsx)("img",{src:k,alt:"Proof of payment",className:"max-w-full max-h-screen rounded-lg"})]})})]})},Ds=Ss,ks=()=>{const[a,o]=(0,t.useState)([]),[n,u]=(0,t.useState)([]),[f,m]=(0,t.useState)(!0),[w,p]=(0,t.useState)(null),[y,c]=(0,t.useState)(""),[h,k]=(0,t.useState)("All"),[D,v]=(0,t.useState)(null),[A,R]=(0,t.useState)(!1),[M,x]=(0,t.useState)({});(0,t.useEffect)(()=>{const d=ae(X(E,"users")),s=ie(d,r=>{const S=r.docs.map(P=>({id:P.id,...P.data()}));u(S)},r=>{console.error("Error loading users:",r),p("Failed to load users: "+r.message)});return()=>s()},[]),(0,t.useEffect)(()=>{const d=ae(X(E,"deposits"),me("timestamp","desc")),s=ie(d,r=>{try{const S=r.docs.map(P=>({id:P.id,...P.data()})).map(P=>{const $=n.find(I=>I.uid===P.userId);return{...P,userName:$?$.fullName||"Unnamed User":"Unknown User"}});o(S),m(!1)}catch(S){console.error("Error merging deposit data:",S),p("Error processing deposit data: "+S.message),m(!1)}},r=>{console.error("Firestore error:",r),p("Failed to load deposits: "+r.message),m(!1)});return()=>s()},[n]);const F=d=>{switch(d){case"accepted":return"bg-green-100 text-green-800";case"denied":return"bg-red-100 text-red-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},C=async(d,s)=>{try{const r=te(E,"deposits",d);await de(r,{status:s}),console.log(`Deposit ${d} status updated to ${s}`)}catch(r){console.error("Error updating deposit status:",r),p("Failed to update deposit status: "+r.message)}},z=d=>{if(!d)return"N/A";if(d.seconds){const s=new Date(d.seconds*1e3);return s.toLocaleDateString()+" "+s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}if(d.toDate){const s=d.toDate();return s.toLocaleDateString()+" "+s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}return d.toString()},B=a.reduce((d,s)=>d+(parseFloat(s.amount)||0),0),U=a.filter(d=>d.status==="pending").length,W=a.filter(d=>d.status==="accepted").length,q=a.filter(d=>d.status==="denied").length,H=a.filter(d=>d.status==="accepted").reduce((d,s)=>d+(parseFloat(s.amount)||0),0),l=a.filter(d=>d.status==="denied").reduce((d,s)=>d+(parseFloat(s.amount)||0),0),g=a.filter(d=>{const s=d.userName?.toLowerCase().includes(y.toLowerCase())||d.userId?.toLowerCase().includes(y.toLowerCase())||d.message?.toLowerCase().includes(y.toLowerCase()),r=h==="All"||d.status===h;return s&&r}),j=d=>{v(d),R(!0)},N=()=>{R(!1),v(null)};return f?(0,e.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading deposits..."})]})}):w?(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6 text-center",children:[(0,e.jsxs)("p",{className:"text-red-500",children:["Error: ",w]}),(0,e.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200",children:"Retry"})]}):(console.log("DepositsPage: Rendering with deposits array length:",a.length),(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:[(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Deposits"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",B.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-indigo-100",children:(0,e.jsx)(ke,{className:"h-6 w-6 text-indigo-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Pending Deposits"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:U})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-yellow-100",children:(0,e.jsx)(it,{className:"h-6 w-6 text-yellow-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Approved Deposits"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:W})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,e.jsx)(Me,{className:"h-6 w-6 text-green-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Denied Deposits"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:q})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-red-100",children:(0,e.jsx)(ye,{className:"h-6 w-6 text-red-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Accepted Amount"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",H.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,e.jsx)(Me,{className:"h-6 w-6 text-green-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Declined Amount"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",l.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-red-100",children:(0,e.jsx)(ye,{className:"h-6 w-6 text-red-600"})})]})})]}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[(0,e.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Deposit Records"}),(0,e.jsxs)("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4",children:[(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,e.jsx)(je,{className:"h-5 w-5 text-gray-400"})}),(0,e.jsx)("input",{type:"text",placeholder:"Search by name, user ID or message...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:y,onChange:d=>c(d.target.value)})]}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsxs)("select",{className:"block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-lg bg-gray-50",value:h,onChange:d=>k(d.target.value),children:[(0,e.jsx)("option",{value:"All",children:"All Statuses"}),(0,e.jsx)("option",{value:"pending",children:"Pending"}),(0,e.jsx)("option",{value:"accepted",children:"Accepted"}),(0,e.jsx)("option",{value:"denied",children:"Denied"})]}),(0,e.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:(0,e.jsx)(lt,{className:"h-5 w-5 text-gray-400"})})]})]})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm overflow-scroll",children:(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User Name"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Proof"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:g.length>0?g.map(d=>(0,e.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[(0,e.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,e.jsx)("div",{className:"text-sm font-medium text-gray-900",children:d.userName}),(0,e.jsxs)("div",{className:"text-xs text-gray-500 italic",children:["ID: ",d.userId]})]}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsxs)("div",{className:"text-sm font-semibold text-gray-900",children:["$",d.amount?parseFloat(d.amount).toFixed(2):"0.00"]})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${F(d.status||"pending")}`,children:d.status||"pending"})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:d.imageUrl?(0,e.jsxs)("button",{onClick:()=>j(d),className:"text-indigo-600 hover:text-indigo-900 flex items-center",children:[(0,e.jsx)(ze,{className:"h-4 w-4 mr-1"}),"View"]}):(0,e.jsx)("span",{className:"text-gray-400",children:"No proof"})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:z(d.timestamp)}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,e.jsxs)("div",{className:"flex items-center space-x-3",children:[d.status==="pending"?(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)("button",{disabled:!!M[d.id],onClick:async()=>{if(window.confirm("Mark this deposit as Accepted?")){x(s=>({...s,[d.id]:!0}));try{await C(d.id,"accepted"),console.log("Deposit accepted:",d.id)}finally{x(s=>{const r={...s};return delete r[d.id],r})}}},className:"px-3 py-1 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors duration-200 disabled:opacity-50",children:M[d.id]?"Processing...":"Approve"}),(0,e.jsx)("button",{disabled:!!M[d.id],onClick:async()=>{if(window.confirm("Mark this deposit as Denied?")){x(s=>({...s,[d.id]:!0}));try{await C(d.id,"denied"),console.log("Deposit denied:",d.id)}finally{x(s=>{const r={...s};return delete r[d.id],r})}}},className:"px-3 py-1 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors duration-200 disabled:opacity-50",children:M[d.id]?"Processing...":"Deny"})]}):(0,e.jsx)("span",{className:"text-sm text-gray-500",children:d.status||"No actions"}),d.imageUrl?(0,e.jsx)("button",{onClick:()=>window.open(d.imageUrl,"_blank"),className:"text-indigo-600 hover:text-indigo-900 flex items-center",title:"View proof in new tab",children:(0,e.jsx)(nt,{className:"h-4 w-4"})}):null]})})]},d.id)):(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:"6",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No deposits found."})})})]})})}),A&&D&&(0,e.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,e.jsxs)("div",{className:"bg-white  rounded-2xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-scroll",children:[(0,e.jsxs)("div",{className:"p-6 border-b border-gray-200 flex justify-between items-center",children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Deposit Proof"}),(0,e.jsx)("button",{onClick:N,className:"text-gray-400 hover:text-gray-500",children:(0,e.jsx)(ye,{className:"h-6 w-6"})})]}),(0,e.jsxs)("div",{className:"p-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"User Name"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:D.userName||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"User ID"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:D.userId||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Amount"}),(0,e.jsxs)("p",{className:"text-sm text-gray-900",children:["$",D.amount?parseFloat(D.amount).toFixed(2):"0.00"]})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Status"}),(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${F(D.status||"pending")}`,children:D.status||"pending"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Date"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:z(D.timestamp)})]}),(0,e.jsxs)("div",{className:"md:col-span-2",children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-1",children:"Message"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:D.message||"No message"})]})]}),(0,e.jsxs)("div",{className:"mt-6",children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-gray-500 mb-2",children:"Proof Image"}),(0,e.jsx)("div",{className:"border border-gray-200 rounded-lg ",children:D.imageUrl?(0,e.jsx)("img",{src:D.imageUrl,alt:"Deposit Proof",className:"w-full h-auto max-h-[60vh] object-contain",onError:d=>{d.target.style.display="none"}}):(0,e.jsx)("div",{className:"flex items-center justify-center h-64 bg-gray-100 text-gray-500",children:"No image available"})})]}),(0,e.jsxs)("div",{className:"mt-6 flex justify-end space-x-3",children:[(0,e.jsx)("button",{onClick:N,className:"px-4 py-2 border border-gray-300 text-sm font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50",children:"Close"}),D.status==="pending"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("button",{onClick:()=>{C(D.id,"accepted"),N()},className:"px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-green-600 hover:bg-green-700",children:"Approve"}),(0,e.jsx)("button",{onClick:()=>{C(D.id,"denied"),N()},className:"px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-red-600 hover:bg-red-700",children:"Deny"})]})]})]})]})})]}))},Cs=ks;function As(){const{currentUser:a}=ue(),[o,n]=(0,t.useState)([]),[u,f]=(0,t.useState)(""),[m,w]=(0,t.useState)(!0),[p,y]=(0,t.useState)({}),[c,h]=(0,t.useState)({}),[k,D]=(0,t.useState)(null),[v,A]=(0,t.useState)(null),R=(0,t.useRef)(),M=(0,t.useRef)(),x=(0,t.useRef)(null),F="dyprdh3rs",C="money-saving",z=l=>{if(!l)return!1;const g=l.toDate?l.toDate():new Date(l);return(new Date-g)/(1e3*60)<2};(0,t.useEffect)(()=>{if(!a)return;(async()=>{try{const j=te(E,"users",a.uid);await de(j,{isOnline:!0,lastActive:xe()})}catch(j){console.error("Error setting user online:",j)}})(),M.current=setInterval(async()=>{try{const j=te(E,"users",a.uid);await de(j,{lastActive:xe()})}catch(j){console.error("Error updating lastActive:",j)}},3e4);const g=async()=>{try{const j=te(E,"users",a.uid);await de(j,{isOnline:!1,lastActive:xe()})}catch(j){console.error("Error setting user offline:",j)}};return window.addEventListener("beforeunload",g),()=>{clearInterval(M.current),window.removeEventListener("beforeunload",g),a&&(async()=>{try{const N=te(E,"users",a.uid);await de(N,{isOnline:!1,lastActive:xe()})}catch(N){console.error("Error setting user offline:",N)}})()}},[a]),(0,t.useEffect)(()=>{if(!a){w(!1);return}const l=ae(X(E,"messages"),me("timestamp","asc"));return ie(l,g=>{n(g.docs.map(j=>({id:j.id,...j.data()}))),w(!1)})},[a]),(0,t.useEffect)(()=>{if(a)return ie(X(E,"users"),l=>{const g={},j={};l.forEach(N=>{const d=N.data();g[N.id]=d,z(d.lastActive)&&(j[N.id]={displayName:d.displayName||d.email?.split("@")[0]||"Unknown",isOnline:d.isOnline||!1,lastActive:d.lastActive})}),h(g),y(j)})},[a]);const B=async l=>{const g=new FormData;g.append("file",l),g.append("upload_preset",C);try{return(await(await fetch(`https://api.cloudinary.com/v1_1/${F}/image/upload`,{method:"POST",body:g})).json()).secure_url}catch(j){throw console.error("Error uploading image:",j),j}},U=l=>{const g=l.target.files[0];if(!g)return;if(!g.type.match("image.*")){alert("Please select an image file");return}D(g);const j=URL.createObjectURL(g);A(j)},W=()=>{D(null),A(null),x.current&&(x.current.value="")},q=async l=>{if(l.preventDefault(),!(!a||!u.trim()&&!k))try{let g=null;k&&(g=await B(k)),await Mt(X(E,"messages"),{text:u,imageUrl:g,userId:a.uid,userName:a.email?a.email.split("@")[0]:"Anonymous",timestamp:xe()}),f(""),D(null),A(null),x.current&&(x.current.value="")}catch(g){console.error("Error sending message:",g),alert("Failed to send message. Please try again.")}};(0,t.useEffect)(()=>{R.current?.scrollIntoView({behavior:"smooth"})},[o]);const H=l=>l?l.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"";return a?(0,e.jsxs)("div",{className:"flex flex-col h-screen bg-gradient-to-b from-gray-50 to-gray-100 font-sans text-gray-800 max-w-4xl mx-auto w-full",children:[(0,e.jsx)("div",{className:"chat-header",children:(0,e.jsxs)("div",{className:"chat-header-avatar",children:[a?.email?.charAt(0).toUpperCase()||"U",(0,e.jsx)("div",{className:`online-status-indicator ${z(c[a?.uid]?.lastActive)?"online":"offline"}`,title:z(c[a?.uid]?.lastActive)?"Online":"Offline"})]})}),(0,e.jsx)("div",{className:"mx-4 mb-2 bg-white/70 backdrop-blur-md rounded-xl shadow-sm p-3",children:(0,e.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,e.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,e.jsxs)("span",{className:"text-xs text-gray-600",children:[Object.keys(p).length," online"]}),(0,e.jsx)("br",{}),(0,e.jsxs)("p",{className:"text-sm text-gray-500",children:[o.length," Messages"]})]})}),(0,e.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 flex flex-col gap-4 max-w-full",children:[m?(0,e.jsx)("div",{className:"flex justify-center p-6",children:(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)("div",{className:"w-2.5 h-2.5 bg-indigo-500 rounded-full animate-bounce"}),(0,e.jsx)("div",{className:"w-2.5 h-2.5 bg-indigo-500 rounded-full animate-bounce",style:{animationDelay:"0.16s"}}),(0,e.jsx)("div",{className:"w-2.5 h-2.5 bg-indigo-500 rounded-full animate-bounce",style:{animationDelay:"0.32s"}})]})}):o.length===0?(0,e.jsxs)("div",{className:"flex flex-col items-center justify-center text-gray-500 p-10 bg-white rounded-2xl shadow-lg m-5",children:[(0,e.jsx)("div",{className:"text-4xl mb-3 opacity-70",children:"ðŸ’¬"}),(0,e.jsx)("div",{className:"text-sm text-center max-w-xs",children:"No messages yet. Start a conversation!"})]}):o.map(l=>(0,e.jsxs)("div",{className:`flex ${l.userId===a.uid?"justify-end":"justify-start"} animate-fade-in`,children:[l.userId!==a.uid&&(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"w-9 h-9 rounded-full flex items-center justify-center bg-white text-indigo-600 font-bold flex-shrink-0 shadow-sm mr-2",children:l.userName?l.userName.charAt(0).toUpperCase():"U"}),(0,e.jsx)("div",{className:`absolute bottom-[60px] right-7 w-3.5 h-3.5 rounded-full border-2 border-white ${p[l.userId]?"bg-green-500":"bg-gray-400"}`,title:p[l.userId]?"Online":"Offline"})]}),(0,e.jsxs)("div",{className:`max-w-[72%] p-3 rounded-2xl relative shadow-md transition-all duration-300 hover:shadow-lg ${l.userId===a.uid?"bg-gradient-to-br from-indigo-50 to-indigo-100 border border-indigo-100 rounded-br-md":"bg-white border border-gray-200 rounded-bl-md"}`,children:[l.imageUrl&&(0,e.jsx)("div",{className:"message-image",children:(0,e.jsx)("img",{src:l.imageUrl,alt:"Uploaded content",style:{maxWidth:"100%",width:"200px",height:"200px",borderRadius:"8px",marginBottom:"8px"}})}),l.text&&(0,e.jsx)("div",{className:"text-sm text-gray-800 leading-relaxed",children:l.text}),(0,e.jsx)("div",{className:"text-xs text-gray-400 text-right mt-2",children:H(l.timestamp)})]}),l.userId===a.uid&&(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"w-9 h-9 rounded-full flex items-center justify-center bg-gradient-to-br from-indigo-500 to-indigo-600 text-white font-bold flex-shrink-0 shadow-sm ml-2",children:l.userName?l.userName.charAt(0).toUpperCase():"U"}),(0,e.jsx)("div",{className:`absolute bottom-[60px] right-6 w-3.5 h-3.5 rounded-full border-2 border-white ${z(c[a?.uid]?.lastActive)?"bg-green-500":"bg-gray-400"}`,title:z(c[a?.uid]?.lastActive)?"Online":"Offline"})]})]},l.id)),(0,e.jsx)("div",{ref:R})]}),(0,e.jsxs)("form",{onSubmit:q,className:"flex flex-col p-4 gap-3 sticky bottom-0 bg-white/70 backdrop-blur-md border-t border-gray-200",children:[v&&(0,e.jsxs)("div",{className:"image-preview-container",children:[(0,e.jsx)("img",{src:v,alt:"Preview",style:{maxWidth:"100px",maxHeight:"100px",objectFit:"cover",borderRadius:"8px"}}),(0,e.jsx)("div",{style:{marginLeft:"12px",flex:1,minWidth:0},children:(0,e.jsx)("p",{style:{margin:0,fontSize:"0.85rem",color:"#4b5563",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:k?.name})}),(0,e.jsx)("button",{type:"button",onClick:W,className:"remove-image-button",style:{background:"none",border:"none",fontSize:"18px",cursor:"pointer",color:"#ef4444"},children:"Ã—"})]}),(0,e.jsxs)("div",{className:"flex items-center gap-3",children:[(0,e.jsx)("div",{className:"flex-1 flex items-center bg-white p-2 pl-4 rounded-full shadow-md transition-all duration-300 focus-within:shadow-lg focus-within:border focus-within:border-indigo-500",children:(0,e.jsx)("input",{type:"text",className:"flex-1 border-0 outline-none p-2 bg-transparent text-sm text-gray-800",placeholder:"Type a message...",value:u,onChange:l=>f(l.target.value)})}),(0,e.jsx)("input",{type:"file",ref:x,onChange:U,accept:"image/*",style:{display:"none"}}),(0,e.jsx)("button",{type:"button",className:"w-11 h-11 rounded-full flex items-center justify-center bg-white text-indigo-600 border-none cursor-pointer shadow-md transition-all duration-300 hover:shadow-lg hover:-translate-y-0.5 active:translate-y-0",onClick:()=>x.current.click(),children:(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-5 h-5",children:(0,e.jsx)("path",{fillRule:"evenodd",d:"M1.5 6a2.25 2.25 0 012.25-2.25h16.5A2.25 2.25 0 0122.5 6v12a2.25 2.25 0 01-2.25 2.25H3.75A2.25 2.25 0 011.5 18V6zM3 16.06V18c0 .414.336.75.75.75h16.5A.75.75 0 0021 18v-1.94l-2.69-2.689a1.5 1.5 0 00-2.12 0l-.88.879.97.97a.75.75 0 11-1.06 1.06l-5.16-5.159a1.5 1.5 0 00-2.12 0L3 16.061zm10.125-7.81a1.125 1.125 0 112.25 0 1.125 1.125 0 01-2.25 0z",clipRule:"evenodd"})})}),(0,e.jsx)("button",{type:"submit",className:"w-11 h-11 rounded-full flex items-center justify-center bg-gradient-to-br from-indigo-500 to-indigo-600 text-white border-none cursor-pointer shadow-md transition-all duration-300 hover:shadow-lg hover:-translate-y-0.5 active:translate-y-0 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",disabled:!u.trim()&&!k,children:(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-4.5 h-4.5",children:(0,e.jsx)("path",{d:"M3.478 2.404a.75.75 0 0 0-.926.941l2.432 7.905H13.5a.75.75 0 0 1 0 1.5H4.984l-2.432 7.905a.75.75 0 0 0 .926.94 60.519 60.519 0 0 0 18.445-8.986.75.75 0 0 0 0-1.218A60.517 60.517 0 0 0 3.478 2.404Z"})})})]})]})]}):(0,e.jsx)("div",{className:"flex flex-col h-screen bg-gradient-to-b from-gray-50 to-gray-100 items-center justify-center font-sans text-gray-800",children:(0,e.jsxs)("div",{className:"text-center p-6 bg-white rounded-2xl shadow-lg max-w-md",children:[(0,e.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Please log in to use chat"}),(0,e.jsx)("p",{className:"text-gray-600",children:"You need to be logged in to send and receive messages."})]})})}var Ls=()=>(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(As,{})}),Us=Ls,Es=()=>{const[a,o]=(0,t.useState)(!1),{currentUser:n}=ue(),u=Lt(),f=be(),{logout:m}=ue(),w=async()=>{try{await m(),f("/login")}catch(c){console.error("Failed to log out",c)}};(0,t.useEffect)(()=>{const c=()=>{window.innerWidth>=1024&&o(!1)};return window.addEventListener("resize",c),()=>window.removeEventListener("resize",c)},[]),(0,t.useEffect)(()=>{const c=h=>{a&&!h.target.closest(".sidebar-content")&&!h.target.closest(".sidebar-toggle")&&o(!1)};return document.addEventListener("click",c),()=>document.removeEventListener("click",c)},[a]),(0,t.useEffect)(()=>{o(!1)},[u.pathname]);const p=[{name:"Dashboard",href:"/dashboard",icon:ss},{name:"Deposits",href:"/deposits",icon:ts},{name:"loans",href:"/loans",icon:ls},{name:"Chat",href:"/chat",icon:ns},{name:"Users",href:"/users",icon:ot},{name:"Payback",href:"/payback",icon:Qt},{name:"Settings",href:"/settings",icon:Ge},{name:"Block users",href:"/admin-users",icon:Ge},{name:"Annual Reports",href:"/annual-reports",icon:Ce}],y=c=>u.pathname===c;return(0,e.jsxs)("div",{className:"flex h-screen w-screen max-w-full bg-gray-50",children:[(0,e.jsx)("div",{className:`fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-lg transform ${a?"translate-x-0":"-translate-x-full"} transition-transform duration-300 ease-in-out lg:translate-x-0 lg:static lg:inset-0 sidebar-content`,children:(0,e.jsxs)("div",{className:"flex flex-col h-full",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between h-16 px-6 border-b border-gray-200",children:[(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("div",{className:"flex-shrink-0",children:(0,e.jsx)("div",{className:"w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center",children:(0,e.jsx)("span",{className:"text-white font-bold",children:"MB"})})}),(0,e.jsx)("div",{className:"ml-3",children:(0,e.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"MoneyBox"})})]}),(0,e.jsx)("button",{onClick:()=>o(!1),className:"lg:hidden text-gray-500 hover:text-gray-700",children:(0,e.jsx)(De,{size:20})})]}),(0,e.jsx)("nav",{className:"flex-1 px-4 py-6 overflow-y-auto",children:(0,e.jsx)("ul",{className:"space-y-1",children:p.map(c=>(0,e.jsx)("li",{children:(0,e.jsxs)($e,{to:c.href,className:`flex items-center px-4 py-3 text-sm font-medium rounded-lg transition-all duration-200 ${y(c.href)?"bg-indigo-50 text-indigo-700":"text-gray-700 hover:bg-gray-100"}`,children:[(0,e.jsx)(c.icon,{className:"mr-3 h-5 w-5"}),c.name]})},c.name))})}),(0,e.jsxs)("div",{className:"px-4 py-6 border-t border-gray-200",children:[(0,e.jsxs)("div",{className:"flex items-center mb-4",children:[(0,e.jsx)("div",{className:"flex-shrink-0",children:(0,e.jsx)("div",{className:"w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center",children:(0,e.jsx)("div",{className:"w-11 h-11 rounded-full flex items-center justify-center bg-gradient-to-br from-indigo-500 to-indigo-600 text-white font-bold shadow-md",children:n?.email?.charAt(0).toUpperCase()||"U"})})}),(0,e.jsxs)("div",{className:"ml-3",children:[(0,e.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:["Admin  is           ",n?.email?.slice(0,5).toUpperCase()||"U"]}),(0,e.jsx)("p",{className:"text-xs text-gray-500",children:n?.email?.slice(0,104).toLowerCase()||"U"})]})]}),(0,e.jsxs)("button",{onClick:w,className:"flex items-center w-full px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors duration-200",children:[(0,e.jsx)(qe,{className:"mr-3 h-5 w-5"}),"Logout"]})]})]})}),(0,e.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,e.jsx)("header",{className:"bg-white shadow-sm z-10",children:(0,e.jsxs)("div",{className:"flex items-center justify-between h-16 px-6",children:[(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("button",{onClick:()=>o(!0),className:"lg:hidden text-gray-500 hover:text-gray-700 mr-4 sidebar-toggle",children:(0,e.jsx)(os,{size:20})}),(0,e.jsxs)("h2",{className:"text-xl font-semibold text-gray-800",children:[u.pathname==="/dashboard"&&"ðŸ’° Dashboard",u.pathname==="/deposits"&&"ðŸ’° Deposits Overview",u.pathname==="/loans"&&"ðŸ’¸ loans Overview",u.pathname==="/users"&&"ðŸ‘¥ Users Overview",u.pathname==="/chat"&&"ðŸ‘¥ Users Overview"]})]}),(0,e.jsx)("div",{className:"flex items-center space-x-4",children:(0,e.jsxs)("button",{onClick:w,className:"flex items-center text-sm font-medium text-gray-700 hover:text-gray-900",children:[(0,e.jsx)(qe,{className:"mr-2 h-5 w-5"}),"Logout"]})})]})}),(0,e.jsx)("main",{className:"flex-1 overflow-y-auto bg-gray-50 p-6",children:(0,e.jsx)("div",{className:"h-full w-full",children:(0,e.jsx)(Ct,{})})})]})]})},Ps=Es,Fs=()=>{const[a,o]=(0,t.useState)([]),[n,u]=(0,t.useState)([]),[f,m]=(0,t.useState)(!0),[w,p]=(0,t.useState)(!1),[y,c]=(0,t.useState)(null),[h,k]=(0,t.useState)(""),[D,v]=(0,t.useState)("All"),[A,R]=(0,t.useState)({}),[M,x]=(0,t.useState)({});(0,t.useEffect)(()=>{const s=ae(X(E,"users")),r=ie(s,S=>{const P=S.docs.map($=>({id:$.id,...$.data()}));u(P),p(!0),console.log(`Loaded ${P.length} users`)},S=>{console.error("Error loading users:",S),c("Failed to load users: "+S.message),p(!0)});return()=>r()},[]),(0,t.useEffect)(()=>{if(!w)return;const s=ae(X(E,"loans"),me("timestamp","desc")),r=ie(s,S=>{const P=S.docs.map(I=>({id:I.id,...I.data()}));console.log(`Processing ${P.length} loans with ${n.length} users`);const $=P.map(I=>{const i=Y=>typeof Y=="string"?Y.trim():Y!=null?String(Y).trim():"",O=i(I.userId);let T=n.find(Y=>{const _=i(Y.id);return _===O&&_!==""});return!T&&O&&P.filter(Y=>!n.find(_=>i(_.id)===i(Y.userId))).length<5&&(console.log(`No user found for loan ID: ${I.id} with normalized userId: '${O}'`),console.log("Available normalized user IDs:",n.map(Y=>`('${i(Y.id)}')`).slice(0,10))),{...I,userFullName:T?T.fullName||T.name||"Unknown name":I.userId?`Unknown User (${I.userId})`:"Unknown User (No ID Provided)",userEmail:T&&T.email||"No Email Found"}});console.log(`Merged ${$.length} loans with user data`),o($),m(!1)},S=>{console.error("Error loading loans:",S),c("Failed to load loans: "+S.message),m(!1)});return()=>r()},[n,w]);const F=s=>{switch(s){case"accepted":return"bg-green-100 text-green-800";case"denied":return"bg-red-100 text-red-800";case"Pending":case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},C=s=>{if(!s)return"N/A";if(s.seconds){const r=new Date(s.seconds*1e3);return r.toLocaleDateString()+" "+r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}if(s.toDate){const r=s.toDate();return r.toLocaleDateString()+" "+r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}return s.toString()},z=(s,r)=>{const S=r.target.files[0];S&&x(P=>({...P,[s]:S}))},B=async s=>{const r="dlrxomdfh",S="Shop-preset",P=new FormData;return P.append("file",s),P.append("upload_preset",S),P.append("cloud_name",r),(await(await fetch(`https://api.cloudinary.com/v1_1/${r}/image/upload`,{method:"POST",body:P})).json()).secure_url},U=async s=>{if(window.confirm("Are you sure you want to accept this loan?")){if(!M[s]){alert("Please upload a receipt image before accepting the loan.");return}R(r=>({...r,[s]:!0}));try{const r=await B(M[s]),S=te(E,"loans",s);await de(S,{status:"accepted",receiptUrl:r,acceptedAt:xe()}),x(P=>{const $={...P};return delete $[s],$})}catch(r){console.error("Error accepting loan:",r),c("Failed to accept loan: "+r.message)}finally{R(r=>{const S={...r};return delete S[s],S})}}},W=async s=>{if(window.confirm("Are you sure you want to deny this loan?")){R(r=>({...r,[s]:!0}));try{const r=te(E,"loans",s);await de(r,{status:"denied",deniedAt:xe()})}catch(r){console.error("Error denying loan:",r),c("Failed to deny loan: "+r.message)}finally{R(r=>{const S={...r};return delete S[s],S})}}},q=a.reduce((s,r)=>s+(parseFloat(r.amount)||0),0),H=a.filter(s=>s.status==="pending").length,l=a.filter(s=>s.status==="accepted").length,g=a.filter(s=>s.status==="denied").length,j=a.filter(s=>s.status==="accepted").reduce((s,r)=>s+(parseFloat(r.amount)||0),0),N=a.filter(s=>s.status==="denied").reduce((s,r)=>s+(parseFloat(r.amount)||0),0),d=a.filter(s=>{const r=s.userFullName?.toLowerCase().includes(h.toLowerCase())||s.userId?.toLowerCase().includes(h.toLowerCase())||s.message?.toLowerCase().includes(h.toLowerCase()),S=D==="All"||s.status===D;return r&&S});return f?(0,e.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading loans..."})]})}):y?(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6 text-center",children:[(0,e.jsxs)("p",{className:"text-red-500",children:["Error: ",y]}),(0,e.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200",children:"Retry"})]}):(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:[(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total loans"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",q.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-blue-100",children:(0,e.jsx)(Ce,{className:"h-6 w-6 text-blue-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Pending loans"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:H})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-yellow-100",children:(0,e.jsx)(it,{className:"h-6 w-6 text-yellow-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Paid loans"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:l})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,e.jsx)(Xt,{className:"h-6 w-6 text-green-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Declined loans"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:g})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-red-100",children:(0,e.jsx)(ye,{className:"h-6 w-6 text-red-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Accepted Amount"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",j.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,e.jsx)(Me,{className:"h-6 w-6 text-green-600"})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Declined Amount"}),(0,e.jsxs)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:["$",N.toFixed(2)]})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-red-100",children:(0,e.jsx)(ye,{className:"h-6 w-6 text-red-600"})})]})})]}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6",children:(0,e.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0",children:[(0,e.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Loans Records"}),(0,e.jsxs)("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4",children:[(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,e.jsx)(je,{className:"h-5 w-5 text-gray-400"})}),(0,e.jsx)("input",{type:"text",placeholder:"Search by name, user ID or message...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:h,onChange:s=>k(s.target.value)})]}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsxs)("select",{className:"block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-lg bg-gray-50",value:D,onChange:s=>v(s.target.value),children:[(0,e.jsx)("option",{value:"All",children:"All Statuses"}),(0,e.jsx)("option",{value:"Pending",children:"Pending"}),(0,e.jsx)("option",{value:"accepted",children:"Paid"}),(0,e.jsx)("option",{value:"denied",children:"Declined"})]}),(0,e.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:(0,e.jsx)(lt,{className:"h-5 w-5 text-gray-400"})})]})]})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden",children:(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User Email"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:d.length>0?d.map(s=>(0,e.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsx)("div",{className:"text-sm text-gray-500",children:s.userEmail})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsxs)("div",{className:"text-sm font-semibold text-gray-900",children:["$",s.amount?parseFloat(s.amount).toFixed(2):"0.00"]})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${F(s.status)}`,children:s.status==="accepted"?"Paid":s.status||"Pending"})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:C(s.timestamp)}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,e.jsxs)("div",{className:"flex items-center space-x-3",children:[s.status==="pending"?(0,e.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,e.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,e.jsx)("label",{className:"text-xs text-gray-500",children:"Upload receipt"}),(0,e.jsx)("input",{type:"file",accept:"image/*",onChange:r=>z(s.id,r),className:"block text-sm border rounded-lg p-1 cursor-pointer bg-gray-50"})]}),(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)("button",{disabled:!!A[s.id]||!M[s.id],onClick:()=>U(s.id),className:`px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-200 ${!M[s.id]||A[s.id]?"opacity-50 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"}`,children:A[s.id]?"Processing...":"Accept"}),(0,e.jsx)("button",{disabled:!!A[s.id],onClick:()=>W(s.id),className:"px-3 py-1 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors duration-200 disabled:opacity-50",children:A[s.id]?"Processing...":"Deny"})]})]}):(0,e.jsx)("span",{className:"text-sm text-gray-500",children:s.status==="accepted"?"Paid":s.status}),s.receiptUrl&&(0,e.jsx)("button",{onClick:()=>window.open(s.receiptUrl,"_blank"),className:"text-indigo-600 hover:text-indigo-900 flex items-center",title:"View receipt",children:(0,e.jsx)(is,{className:"h-4 w-4"})})]})})]},s.id)):(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:"6",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No loans found."})})})]})})})]})},Ts=Fs,Is=()=>{const[a,o]=(0,t.useState)([]),[n,u]=(0,t.useState)(!0),[f,m]=(0,t.useState)(null),[w,p]=(0,t.useState)(""),[y,c]=(0,t.useState)(!1),[h,k]=(0,t.useState)(null),[D,v]=(0,t.useState)([]),[A,R]=(0,t.useState)([]),[M,x]=(0,t.useState)(!1),[F,C]=(0,t.useState)(!1),[z,B]=(0,t.useState)(null),[U,W]=(0,t.useState)(null),[q,H]=(0,t.useState)({}),l=(0,t.useRef)(null),g=(0,t.useRef)(null);(0,t.useEffect)(()=>{if(!E){m("Firestore instance not available"),u(!1);return}const i=ae(X(E,"users")),O=ie(i,T=>{try{const Y=T.docs.map(_=>({id:_.id,..._.data()})).sort((_,ee)=>_.createdAt&&ee.createdAt?ee.createdAt.toMillis()-_.createdAt.toMillis():_.createdAt?-1:ee.createdAt?1:0);o(Y),u(!1)}catch(Y){console.error("Error processing users snapshot:",Y),m("Failed to process users data"),u(!1)}},T=>{console.error("Error fetching users:",T),T.code==="permission-denied"?m("Permission denied. Check Firestore rules."):m("Failed to load users: "+(T.message||"Unknown error")),u(!1)});return()=>O()},[]),(0,t.useEffect)(()=>{if(l.current&&(l.current(),l.current=null),g.current&&(g.current(),g.current=null),!h){v([]),R([]);return}x(!0),B(null);const i=ae(X(E,"deposits"),me("timestamp","desc"));l.current=ie(i,T=>{try{const Y=T.docs.map(_=>({id:_.id,..._.data()})).filter(_=>_.userId===h.uid);v(Y),x(!1)}catch(Y){console.error("Error processing deposits snapshot:",Y),B("Failed to process deposits data"),x(!1)}},T=>{console.error("Error fetching deposits:",T),B("Failed to load deposits: "+(T.message||"Unknown error")),x(!1)}),C(!0),W(null);const O=ae(X(E,"loans"),me("timestamp","desc"));return g.current=ie(O,T=>{try{const Y=T.docs.map(_=>({id:_.id,..._.data()})).filter(_=>_.userId===h.uid);R(Y),C(!1)}catch(Y){console.error("Error processing loans snapshot:",Y),W("Failed to process loans data"),C(!1)}},T=>{console.error("Error fetching loans:",T),W("Failed to load loans: "+(T.message||"Unknown error")),C(!1)}),()=>{l.current&&(l.current(),l.current=null),g.current&&(g.current(),g.current=null)}},[h]);const j=i=>{if(!i)return"N/A";if(i.seconds)return new Date(i.seconds*1e3).toLocaleString();if(i.toDate)return i.toDate().toLocaleString();try{return new Date(i).toLocaleString()}catch{return String(i)}},N=i=>{switch(i?.toLowerCase()){case"accepted":return"bg-green-100 text-green-800";case"denied":case"rejected":return"bg-red-100 text-red-800";case"pending":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},d=i=>{k(i),c(!0)},s=()=>{c(!1)},r=i=>{window.open(i,"_blank")},S=(i,O)=>{const T=document.createElement("a");T.href=i,T.download=O||"proof-image.jpg",document.body.appendChild(T),T.click(),document.body.removeChild(T)},P=D.reduce((i,O)=>i+(O.amount||0),0),$=A.reduce((i,O)=>i+(O.amount||0),0);D.filter(i=>i.status==="pending").length,D.filter(i=>i.status==="accepted").length,D.filter(i=>i.status==="denied"||i.status==="rejected").length,A.filter(i=>i.status==="pending").length,A.filter(i=>i.status==="accepted").length,A.filter(i=>i.status==="denied"||i.status==="rejected").length;const I=a.filter(i=>{const O=w.trim().toLowerCase();return O?(i.fullName||"").toLowerCase().includes(O)||(i.email||"").toLowerCase().includes(O)||(i.phoneNumber||"").toLowerCase().includes(O)||(i.uid||"").toLowerCase().includes(O):!0});return n?(0,e.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading users..."})]})}):f?(0,e.jsxs)("div",{className:"bg-white rounded-2xl shadow-sm p-6 text-center",children:[(0,e.jsxs)("p",{className:"text-red-500",children:["Error: ",f]}),(0,e.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors duration-200",children:"Retry"})]}):(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6 md:col-span-1",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Total Users"}),(0,e.jsx)("p",{className:"mt-2 text-3xl font-bold text-gray-900",children:a.length})]}),(0,e.jsx)("div",{className:"p-3 rounded-full bg-green-100",children:(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,e.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a4 4 0 00-4-4h-1M9 20H4v-2a4 4 0 014-4h1m0-4a4 4 0 100-8 4 4 0 000 8z"})})})]})}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm p-6 md:col-span-3",children:(0,e.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0",children:[(0,e.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"User Records"}),(0,e.jsx)("div",{className:"flex items-center w-full sm:w-64",children:(0,e.jsxs)("div",{className:"relative w-full",children:[(0,e.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,e.jsx)(je,{className:"h-5 w-5 text-gray-400"})}),(0,e.jsx)("input",{type:"text",placeholder:"Search users...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:w,onChange:i=>p(i.target.value)})]})})]})})]}),(0,e.jsx)("div",{className:"bg-white rounded-2xl shadow-sm overflow-hidden",children:(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Phone"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Gender"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Age"}),(0,e.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Joined"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:I.length>0?I.map(i=>(0,e.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors duration-150 cursor-pointer",onClick:()=>d(i),children:[(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsxs)("div",{className:"flex items-center",children:[i.imageUrl?(0,e.jsx)("img",{src:i.imageUrl,alt:i.fullName||"avatar",className:"h-10 w-10 rounded-full object-cover",onError:O=>{O.target.style.display="none"}}):(0,e.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center text-sm font-medium text-gray-700",children:(i.fullName||"U").split(" ").map(O=>O[0]).slice(0,2).join("").toUpperCase()}),(0,e.jsxs)("div",{className:"ml-3",children:[(0,e.jsx)("div",{className:"text-sm font-medium text-gray-900",children:i.fullName||"No name"}),(0,e.jsx)("div",{className:"text-xs text-gray-500",children:i.uid||""})]})]})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:i.email||"N/A"}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:i.phoneNumber||"N/A"}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 capitalize",children:i.gender||"N/A"}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:i.age||"N/A"}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:j(i.createdAt)})]},i.id)):(0,e.jsx)("tr",{children:(0,e.jsx)("td",{colSpan:"6",className:"px-6 py-4 text-center text-sm text-gray-500",children:"No users found."})})})]})})}),y&&h&&(0,e.jsx)("div",{className:"fixed inset-0 z-50 overflow-auto bg-black bg-opacity-50 flex items-center justify-center p-4",children:(0,e.jsxs)("div",{className:"bg-white rounded-xl shadow-xl max-w-6xl w-full max-h-[90vh] overflow-auto",children:[(0,e.jsxs)("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center",children:[(0,e.jsxs)("h2",{className:"text-xl font-semibold text-gray-900",children:["User Details: ",h.fullName]}),(0,e.jsx)("button",{onClick:s,className:"p-1 rounded-full hover:bg-gray-100 transition-colors",children:(0,e.jsx)(De,{className:"h-5 w-5 text-gray-500"})})]}),(0,e.jsxs)("div",{className:"p-6",children:[(0,e.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[(0,e.jsxs)("div",{className:"flex items-center mb-4",children:[h.imageUrl?(0,e.jsx)("img",{src:h.imageUrl,alt:h.fullName||"avatar",className:"h-16 w-16 rounded-full object-cover mr-4"}):(0,e.jsx)("div",{className:"h-16 w-16 rounded-full bg-gray-200 flex items-center justify-center text-xl font-medium text-gray-700 mr-4",children:(h.fullName||"U").split(" ").map(i=>i[0]).slice(0,2).join("").toUpperCase()}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:h.fullName||"No name"}),(0,e.jsxs)("p",{className:"text-sm text-gray-500",children:["ID: ",h.uid||"N/A"]})]})]}),(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Email"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:h.email||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Phone Number"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:h.phoneNumber||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"MoMo Number"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:h.momoNumber||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Credit card Number"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:h.creditCardNumber||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Gender"}),(0,e.jsx)("p",{className:"text-sm text-gray-900 capitalize",children:h.gender||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Age"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:h.age||"N/A"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium text-gray-500",children:"Joined Date"}),(0,e.jsx)("p",{className:"text-sm text-gray-900",children:j(h.createdAt)})]})]})]}),(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,e.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,e.jsxs)("div",{className:"flex items-center mb-4",children:[(0,e.jsx)("div",{className:"p-2 rounded-full bg-green-100 mr-3",children:(0,e.jsx)(ke,{className:"h-6 w-6 text-green-600"})}),(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Deposits Summary"})]}),(0,e.jsx)("div",{className:"space-y-3",children:(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Total Amount:"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",P.toFixed(2)]})]})})]}),(0,e.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,e.jsxs)("div",{className:"flex items-center mb-4",children:[(0,e.jsx)("div",{className:"p-2 rounded-full bg-blue-100 mr-3",children:(0,e.jsx)(as,{className:"h-6 w-6 text-blue-600"})}),(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Loans Summary"})]}),(0,e.jsx)("div",{className:"space-y-3",children:(0,e.jsxs)("div",{className:"flex justify-between",children:[(0,e.jsx)("span",{className:"text-sm text-gray-500",children:"Total Amount:"}),(0,e.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:["$",$.toFixed(2)]})]})})]})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Deposits"}),M?(0,e.jsx)("div",{className:"flex justify-center py-4",children:(0,e.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):z?(0,e.jsx)("div",{className:"bg-red-50 p-4 rounded-md",children:(0,e.jsx)("p",{className:"text-sm text-red-800",children:z})}):D.length>0?(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Message"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Proof"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:D.map(i=>(0,e.jsxs)("tr",{children:[(0,e.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:["$",i.amount||"0"]}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap",children:(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${N(i.status)}`,children:i.status||"Unknown"})}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:j(i.timestamp)}),(0,e.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900 max-w-xs truncate",title:i.message,children:i.message||"N/A"}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:i.proofImage?(0,e.jsxs)("div",{className:"flex space-x-2",children:[(0,e.jsx)("button",{onClick:()=>r(i.proofImage),className:"text-indigo-600 hover:text-indigo-900",title:"View",children:(0,e.jsx)(ze,{className:"h-5 w-5"})}),(0,e.jsx)("button",{onClick:()=>S(i.proofImage,`deposit-proof-${i.id}.jpg`),className:"text-indigo-600 hover:text-indigo-900",title:"Download",children:(0,e.jsx)(nt,{className:"h-5 w-5"})})]}):"N/A"})]},i.id))})]})}):(0,e.jsx)("div",{className:"text-center py-4 text-sm text-gray-500",children:"No deposits found."})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Loans"}),F?(0,e.jsx)("div",{className:"flex justify-center py-4",children:(0,e.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):U?(0,e.jsx)("div",{className:"bg-red-50 p-4 rounded-md",children:(0,e.jsx)("p",{className:"text-sm text-red-800",children:U})}):A.length>0?(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Reason"}),(0,e.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Approved By"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:A.map(i=>(0,e.jsxs)("tr",{children:[(0,e.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:["$",i.amount||"0"]}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap",children:(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${N(i.status)}`,children:i.status||"Unknown"})}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:j(i.timestamp)}),(0,e.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900 max-w-xs truncate",title:i.reason,children:i.reason||"N/A"}),(0,e.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:i.approvedBy||"N/A"})]},i.id))})]})}):(0,e.jsx)("div",{className:"text-center py-4 text-sm text-gray-500",children:"No loans found."})]})]})]})})]})},Rs=Is,Ms=()=>{const[a,o]=(0,t.useState)("10.00"),[n,u]=(0,t.useState)(!0),[f,m]=(0,t.useState)(!1),[w,p]=(0,t.useState)(null),[y,c]=(0,t.useState)("success"),[h,k]=(0,t.useState)([]),[D,v]=(0,t.useState)(!1),[A,R]=(0,t.useState)(null);(0,t.useEffect)(()=>{(async()=>{try{const F=ae(X(E,"interest"),me("timestamp","desc"),Rt(10)),C=await pe(F);if(C.empty)o("10.00");else{const z=C.docs[0];o(z.data().interest.toFixed(2)),R(z.id);const B=C.docs.map(U=>({date:new Date(U.data().timestamp?.toDate()||Date.now()).toLocaleDateString(),rate:parseFloat(U.data().interest)})).reverse();k(B)}}catch(F){console.error("Error fetching interest:",F),p("Failed to load interest rate"),c("error"),setTimeout(()=>p(null),3e3)}finally{u(!1)}})()},[]);const M=async()=>{if(isNaN(a)||a<1||a>100){p("Please enter a valid interest rate between 1% and 100%"),c("error"),setTimeout(()=>p(null),3e3);return}m(!0);try{const x=new Date;if(A){const F=te(E,"interest",A);await de(F,{interest:Number(a),timestamp:x})}else await rt(te(E,"interest","globalRate"),{interest:Number(a),timestamp:x}),R("globalRate");p("Interest rate updated successfully!"),c("success"),k(F=>[...F.slice(-9),{date:x.toLocaleDateString(),rate:Number(a)}])}catch(x){console.error("Error updating interest:",x),p("Failed to update interest rate"),c("error")}finally{m(!1),setTimeout(()=>p(null),3e3)}};return n?(0,e.jsx)("div",{className:"flex justify-center items-center min-h-screen px-4",children:(0,e.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-10 w-full max-w-md text-center",children:[(0,e.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600 dark:text-gray-300",children:"Loading interest rate..."})]})}):(0,e.jsxs)("div",{className:"flex justify-center items-center min-h-screen px-4 bg-gray-50 dark:bg-gray-900",children:[(0,e.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-4 sm:p-6 md:p-10 w-full max-w-md",children:[(0,e.jsx)("h2",{className:"text-xl sm:text-2xl font-bold text-gray-800 dark:text-gray-100 mb-6 text-center",children:"Interest Rate Settings"}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("label",{className:"block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2",children:"Current Interest Rate (%)"}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("input",{type:"number",step:"0.01",min:"1",max:"100",value:a,onChange:x=>o(x.target.value),className:"border border-gray-300 dark:border-gray-700 rounded-lg p-3 w-full focus:ring-2 focus:ring-blue-500 outline-none pr-12",disabled:f,placeholder:"Enter interest rate (1â€“100)"}),(0,e.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"%"})]}),(0,e.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Enter as a percentage (e.g., 5 for 5%)"})]}),(0,e.jsx)("button",{onClick:M,disabled:f,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200 w-full disabled:opacity-50 flex items-center justify-center text-sm sm:text-base",children:f?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2"}),"Saving..."]}):"Save Changes"}),(0,e.jsx)("div",{className:"mt-6 text-center",children:(0,e.jsxs)("button",{onClick:()=>v(!D),className:"text-blue-600 dark:text-blue-400 text-sm font-medium hover:underline",children:[D?"Hide":"Show"," Rate History"]})}),D&&h.length>0&&(0,e.jsxs)("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[(0,e.jsx)("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300 mb-4",children:"Interest Rate History"}),(0,e.jsx)("div",{className:"h-48",children:(0,e.jsx)(Fe,{width:"100%",height:"100%",children:(0,e.jsxs)(st,{data:h,children:[(0,e.jsx)(Te,{strokeDasharray:"3 3",stroke:"#e0e0e0"}),(0,e.jsx)(Pe,{dataKey:"date",tick:{fontSize:12}}),(0,e.jsx)(Ie,{tick:{fontSize:12},domain:["dataMin - 0.5","dataMax + 0.5"]}),(0,e.jsx)(Ee,{formatter:x=>`${x.toFixed(2)}%`,contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.9)",border:"1px solid #ccc",borderRadius:"4px"}}),(0,e.jsx)(Ue,{type:"monotone",dataKey:"rate",stroke:"#3b82f6",strokeWidth:2,dot:{fill:"#3b82f6",r:4},activeDot:{r:6}})]})})})]})]}),w&&(0,e.jsx)("div",{className:`fixed top-5 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-lg text-white font-semibold shadow-md transition-all duration-300 ${y==="success"?"bg-green-500":"bg-red-500"}`,children:w})]})},$s=Ms;hs();var Le=Ae(us()),zs=(a,o)=>{const n=new ps({orientation:"portrait",unit:"mm",format:"a4"}),u=n.internal.pageSize.getWidth(),f=n.internal.pageSize.getHeight(),m=20;u-m*2,n.setFont("helvetica");const w=x=>x?(x.toDate?x.toDate():new Date(x)).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A",p=x=>`$${x.toFixed(2)}`,y=x=>x==="approved"?[0,128,0]:[255,0,0],c=x=>x==="approved"?"PAID":x?x.toUpperCase():"UNPAID",h=()=>{n.setFillColor(41,98,255),n.rect(0,0,u,30,"F"),n.setTextColor(255,255,255),n.setFontSize(20),n.setFont("helvetica","bold"),n.text("Annual User Reports",u/2,20,{align:"center"}),n.setFontSize(14),n.setFont("helvetica","normal"),n.text(`${o}`,u/2,26,{align:"center"}),n.setTextColor(0,0,0)},k=x=>{const F=f-10;n.setFontSize(8),n.setTextColor(100,100,100),n.text(`Page ${x}`,u/2,F,{align:"center"})},D=()=>{h(),n.setFontSize(28),n.setTextColor(41,98,255),n.text("Annual User Reports",u/2,100,{align:"center"}),n.setFontSize(22),n.text(`${o}`,u/2,115,{align:"center"}),n.setFontSize(12),n.setTextColor(100,100,100);const x=new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});n.text(`Generated on ${x}`,u/2,130,{align:"center"}),n.setTextColor(0,0,0),n.setFontSize(14),n.setFont("helvetica","bold"),n.text("Summary Statistics",m,160),n.setFont("helvetica","normal"),n.setFontSize(12);const F=a.length,C=a.reduce((W,q)=>W+q.totalDeposits,0),z=a.reduce((W,q)=>W+q.totalLoans,0),B=a.reduce((W,q)=>W+q.paidLoansCount,0),U=a.reduce((W,q)=>W+q.unpaidLoansCount,0);n.text(`Total Users: ${F}`,m,175),n.text(`Total Deposits: ${p(C)}`,m,185),n.text(`Total Loans: ${p(z)}`,m,195),n.text(`Total Paid Loans: ${B}`,m,205),n.text(`Total Unpaid Loans: ${U}`,m,215),k(1),n.addPage()};let v=0;const A=()=>{h();const x=[[{content:"User Name",dataKey:"name"}],[{content:"Total Deposits ($)",dataKey:"totalDeposits"}],[{content:"Paid Loans",dataKey:"paidLoansCount"}],[{content:"Unpaid Loans",dataKey:"unpaidLoansCount"}],[{content:"Total Loans ($)",dataKey:"totalLoans"}]],F=a.map(C=>[C.user.name||"Unknown User",p(C.totalDeposits),C.paidLoansCount,C.unpaidLoansCount,p(C.totalLoans)]);(0,Le.default)(n,{head:x,body:F,startY:40,theme:"grid",styles:{font:"helvetica",fontSize:10,cellPadding:5},headStyles:{fillColor:[41,98,255],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[245,245,245]},margin:{left:20,right:20},didDrawPage:C=>{v=C.cursor.y}}),v=n.lastAutoTable.finalY+10,k(n.internal.getNumberOfPages())},R=x=>f-v-20<x?(n.addPage(),h(),v=40,k(n.internal.getNumberOfPages()),!0):!1,M=(x,F=!1)=>{const C=60+x.deposits.length*10+x.loans.length*10;if(R(C),n.setFontSize(16),n.setFont("helvetica","bold"),n.setTextColor(41,98,255),n.text(x.user.name||"Unknown User",m,v),v+=10,n.setFontSize(12),n.setFont("helvetica","normal"),n.setTextColor(0,0,0),n.text(`Email: ${x.user.email||"N/A"}`,m,v),v+=10,n.text(`Phone: ${x.user.phone||"N/A"}`,m,v),v+=15,x.deposits.length>0){const z=[[{content:"Amount",dataKey:"amount"}],[{content:"Date",dataKey:"date"}]],B=x.deposits.map(U=>[p(U.amount),w(U.timestamp)]);R(30),(0,Le.default)(n,{head:z,body:B,startY:v,theme:"grid",styles:{font:"helvetica",fontSize:10,cellPadding:5},headStyles:{fillColor:[75,192,192],textColor:255,fontStyle:"bold"},margin:{left:m,right:m},didDrawPage:U=>{v=U.cursor.y}}),v=n.lastAutoTable.finalY+10}else R(20),n.setFontSize(10),n.setTextColor(100,100,100),n.text("No deposits found",m,v),n.setTextColor(0,0,0),v+=10;if(x.loans.length>0){const z=[[{content:"Amount",dataKey:"amount"}],[{content:"Date",dataKey:"date"}],[{content:"Status",dataKey:"status"}]],B=x.loans.map(U=>[p(U.amount),w(U.timestamp),c(U.paymentStatus)]);R(30),(0,Le.default)(n,{head:z,body:B,startY:v,theme:"grid",styles:{font:"helvetica",fontSize:10,cellPadding:5},headStyles:{fillColor:[255,99,132],textColor:255,fontStyle:"bold"},didDrawCell:U=>{if(U.section==="body"&&U.column.index===2){const W=U.row.index,q=x.loans[W];if(q){const H=y(q.paymentStatus);n.setTextColor(H[0],H[1],H[2])}}},didDrawPage:U=>{v=U.cursor.y},margin:{left:m,right:m}}),v=n.lastAutoTable.finalY+15}else R(20),n.setFontSize(10),n.setTextColor(100,100,100),n.text("No loans found",m,v),n.setTextColor(0,0,0),v+=15};try{D(),A(),a.length>0&&(n.addPage(),h(),v=40),a.forEach((C,z)=>{M(C,z===0)});const x=n.internal.getNumberOfPages();for(let C=1;C<=x;C++)n.setPage(C),k(C);const F=`annual-reports-${o}.pdf`;return n.save(F),{success:!0,filename:F}}catch(x){return console.error("Error generating PDF:",x),{success:!1,error:x.message}}},Os=zs;Vt.register(Bt,zt,Wt,_t,Ot,Yt,qt);var Ze=a=>gs(new Date(a,0,1)),Qe=a=>ms(new Date(a,0,1)),xt=(a,o)=>new Date(a,o-1,1),ut=(a,o)=>new Date(a,o,0),Je=a=>{if(!a)return"N/A";const o=a.toDate?a.toDate():new Date(a);return dt(o,"MMM dd, yyyy")},_s=(a,o)=>{const n=a.reduce((w,p)=>w+p.amount,0),u=o.reduce((w,p)=>w+p.amount,0),f=o.filter(w=>w.paymentStatus==="approved").length,m=o.filter(w=>w.paymentStatus!=="approved").length;return{totalDeposits:n,totalLoans:u,paidLoansCount:f,unpaidLoansCount:m}},Ys=(a,o)=>{if(!o.trim())return a;const n=o.toLowerCase();return a.filter(u=>u.user?.name?.toLowerCase().includes(n)||u.user?.email?.toLowerCase().includes(n)||u.user?.phone?.toLowerCase().includes(n))},Bs=(a,o)=>{const n=["User","Total Deposits","Total Loans","Paid Loans","Unpaid Loans"],u=a.map(y=>[y.user.name,y.totalDeposits,y.totalLoans,y.paidLoansCount,y.unpaidLoansCount]);let f=n.join(",")+`
`;u.forEach(y=>{f+=y.join(",")+`
`});const m=new Blob([f],{type:"text/csv;charset=utf-8;"}),w=URL.createObjectURL(m),p=document.createElement("a");p.setAttribute("href",w),p.setAttribute("download",o),p.style.visibility="hidden",document.body.appendChild(p),p.click(),document.body.removeChild(p)},Xe=(a,o,n)=>{const u=[];for(let f=1;f<=12;f++){const m=xt(n,f),w=ut(n,f),p=a.filter(c=>{const h=c.timestamp.toDate?c.timestamp.toDate():new Date(c.timestamp);return h>=m&&h<=w}),y=o.filter(c=>{const h=c.timestamp.toDate?c.timestamp.toDate():new Date(c.timestamp);return h>=m&&h<=w});u.push({month:dt(m,"MMM"),deposits:p.reduce((c,h)=>c+h.amount,0),loans:y.reduce((c,h)=>c+h.amount,0)})}return u},Ws=a=>a==="approved"?{text:"PAID",className:"bg-green-100 text-green-800"}:{text:a?a.toUpperCase():"UNPAID",className:"bg-red-100 text-red-800"},et=({data:a,columns:o,itemsPerPage:n=10})=>{const[u,f]=(0,t.useState)(1),m=Math.ceil(a.length/n),w=(u-1)*n,p=w+n,y=a.slice(w,p);return(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsx)("tr",{children:o.map((c,h)=>(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:c.header},h))})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:y.map((c,h)=>(0,e.jsx)("tr",{children:o.map((k,D)=>(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:k.render?k.render(c):c[k.accessor]},D))},h))})]})}),m>1&&(0,e.jsxs)("div",{className:"px-6 py-3 flex items-center justify-between border-t border-gray-200",children:[(0,e.jsxs)("div",{className:"flex-1 flex justify-between sm:hidden",children:[(0,e.jsx)("button",{onClick:()=>f(c=>Math.max(c-1,1)),disabled:u===1,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Previous"}),(0,e.jsx)("button",{onClick:()=>f(c=>Math.min(c+1,m)),disabled:u===m,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Next"})]}),(0,e.jsxs)("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[(0,e.jsx)("div",{children:(0,e.jsxs)("p",{className:"text-sm text-gray-700",children:["Showing ",(0,e.jsx)("span",{className:"font-medium",children:w+1})," to"," ",(0,e.jsx)("span",{className:"font-medium",children:Math.min(p,a.length)})," of"," ",(0,e.jsx)("span",{className:"font-medium",children:a.length})," results"]})}),(0,e.jsx)("div",{children:(0,e.jsxs)("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[(0,e.jsx)("button",{onClick:()=>f(c=>Math.max(c-1,1)),disabled:u===1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50",children:"Previous"}),Array.from({length:m},(c,h)=>h+1).map(c=>(0,e.jsx)("button",{onClick:()=>f(c),className:`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${u===c?"z-10 bg-blue-50 border-blue-500 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,children:c},c)),(0,e.jsx)("button",{onClick:()=>f(c=>Math.min(c+1,m)),disabled:u===m,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50",children:"Next"})]})})]})]})]})},Vs=({isOpen:a,onClose:o,user:n,deposits:u,loans:f})=>{if(!a)return null;const m=[{header:"Amount",accessor:"amount",render:p=>`$${p.amount.toFixed(2)}`},{header:"Date",accessor:"timestamp",render:p=>Je(p.timestamp)}],w=[{header:"Amount",accessor:"amount",render:p=>`$${p.amount.toFixed(2)}`},{header:"Date",accessor:"timestamp",render:p=>Je(p.timestamp)},{header:"Status",accessor:"paymentStatus",render:p=>{const y=Ws(p.paymentStatus);return(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${y.className}`,children:y.text})}}];return(0,e.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,e.jsxs)("div",{className:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[(0,e.jsx)("div",{className:"fixed inset-0 transition-opacity","aria-hidden":"true",children:(0,e.jsx)("div",{className:"absolute inset-0 bg-gray-500 opacity-75",onClick:o})}),(0,e.jsx)("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"â€‹"}),(0,e.jsx)("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-3xl sm:w-full",children:(0,e.jsxs)("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:[(0,e.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,e.jsxs)("h3",{className:"text-lg leading-6 font-medium text-gray-900",id:"modal-title",children:[n.name,"'s Report"]}),(0,e.jsx)("button",{type:"button",className:"text-gray-400 hover:text-gray-500 focus:outline-none",onClick:o,children:(0,e.jsx)("svg",{className:"h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,e.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,e.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,e.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,e.jsx)("p",{className:"text-sm text-gray-500",children:"Email"}),(0,e.jsx)("p",{className:"text-base font-medium",children:n.email||"N/A"})]}),(0,e.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,e.jsx)("p",{className:"text-sm text-gray-500",children:"Phone"}),(0,e.jsx)("p",{className:"text-base font-medium",children:n.phone||"N/A"})]})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Deposits"}),u.length===0?(0,e.jsx)("p",{className:"text-gray-500",children:"No deposits found"}):(0,e.jsx)(et,{data:u,columns:m,itemsPerPage:5})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Loans"}),f.length===0?(0,e.jsx)("p",{className:"text-gray-500",children:"No loans found"}):(0,e.jsx)(et,{data:f,columns:w,itemsPerPage:5})]})]})})]})})},qs=(a,o)=>{const[n,u]=(0,t.useState)(a);return(0,t.useEffect)(()=>{const f=setTimeout(()=>{u(a)},o);return()=>{clearTimeout(f)}},[a,o]),n},Ks=()=>{const a=new Date().getFullYear(),[o,n]=(0,t.useState)(a),[u,f]=(0,t.useState)("all"),[m,w]=(0,t.useState)(""),[p,y]=(0,t.useState)(!1),[c,h]=(0,t.useState)([]),[k,D]=(0,t.useState)({}),[v,A]=(0,t.useState)(null),[R,M]=(0,t.useState)(!1),[x,F]=(0,t.useState)(null),[C,z]=(0,t.useState)(null),[B,U]=(0,t.useState)(!0),[W,q]=(0,t.useState)(null),[H,l]=(0,t.useState)({deposits:null,loans:null}),[g,j]=(0,t.useState)(1),N=20,d=qs(m,300),s=(0,t.useMemo)(()=>{if(Object.keys(k).length===0)return[];let b=Object.values(k);return d&&(b=Ys(b,d)),p&&(b=b.filter(Z=>Z.unpaidLoansCount>0)),b},[k,d,p]),r=Math.ceil(s.length/N),S=(g-1)*N,P=S+N,$=s.slice(S,P);(0,t.useEffect)(()=>{j(1)},[s.length]);const I=(0,t.useMemo)(()=>x?{labels:x.labels,datasets:x.datasets}:null,[x]),i=(0,t.useMemo)(()=>C?{currentYear:{totalDeposits:C.currentYear.totalDeposits,totalLoans:C.currentYear.totalLoans,monthlyData:C.currentYear.monthlyData},previousYear:{totalDeposits:C.previousYear.totalDeposits,totalLoans:C.previousYear.totalLoans,monthlyData:C.previousYear.monthlyData}}:null,[C]),O=async()=>{try{const b=ae(X(E,"users")),Z=await pe(b),le=[];return Z.forEach(G=>{le.push({id:G.id,...G.data()})}),h(le),le}catch(b){return console.error("Error fetching users:",b),q("Failed to fetch users data"),[]}},T=async(b,Z,le)=>{try{try{const G=ae(X(E,"deposits"),he("userId","in",b),he("timestamp",">=",Z),he("timestamp","<=",le),me("timestamp","desc")),ce=await pe(G),se={};return ce.forEach(Q=>{const V={id:Q.id,...Q.data()};se[V.userId]||(se[V.userId]=[]),se[V.userId].push(V)}),se}catch(G){if(G.message.includes("requires an index")){console.warn("Index not found for deposits query, using fallback"),l(V=>({...V,deposits:G.message}));const ce=ae(X(E,"deposits"),he("userId","in",b)),se=await pe(ce),Q={};return se.forEach(V=>{const K={id:V.id,...V.data()},re=K.timestamp.toDate?K.timestamp.toDate():new Date(K.timestamp);re>=Z&&re<=le&&(Q[K.userId]||(Q[K.userId]=[]),Q[K.userId].push(K))}),Object.keys(Q).forEach(V=>{Q[V].sort((K,re)=>{const fe=K.timestamp.toDate?K.timestamp.toDate():new Date(K.timestamp);return(re.timestamp.toDate?re.timestamp.toDate():new Date(re.timestamp))-fe})}),Q}else throw G}}catch(G){return console.error("Error fetching deposits:",G),{}}},Y=async(b,Z,le)=>{try{try{const G=ae(X(E,"loans"),he("userId","in",b),he("timestamp",">=",Z),he("timestamp","<=",le),me("timestamp","desc")),ce=await pe(G),se={};return ce.forEach(Q=>{const V={id:Q.id,...Q.data()};se[V.userId]||(se[V.userId]=[]),se[V.userId].push(V)}),se}catch(G){if(G.message.includes("requires an index")){console.warn("Index not found for loans query, using fallback"),l(V=>({...V,loans:G.message}));const ce=ae(X(E,"loans"),he("userId","in",b)),se=await pe(ce),Q={};return se.forEach(V=>{const K={id:V.id,...V.data()},re=K.timestamp.toDate?K.timestamp.toDate():new Date(K.timestamp);re>=Z&&re<=le&&(Q[K.userId]||(Q[K.userId]=[]),Q[K.userId].push(K))}),Object.keys(Q).forEach(V=>{Q[V].sort((K,re)=>{const fe=K.timestamp.toDate?K.timestamp.toDate():new Date(K.timestamp);return(re.timestamp.toDate?re.timestamp.toDate():new Date(re.timestamp))-fe})}),Q}else throw G}}catch(G){return console.error("Error fetching loans:",G),{}}},_=(0,t.useCallback)(async()=>{U(!0),q(null);try{const b=await O(),Z={};let le=[],G=[],ce,se;u==="all"?(ce=Ze(o),se=Qe(o)):(ce=xt(o,parseInt(u)),se=ut(o,parseInt(u)));const Q=b.map(L=>L.id),V=[];for(let L=0;L<Q.length;L+=10)V.push(Q.slice(L,L+10));const K=V.map(L=>T(L,ce,se)),re=V.map(L=>Y(L,ce,se)),fe=await Promise.all(K),ft=await Promise.all(re),Oe={},_e={};fe.forEach(L=>{Object.keys(L).forEach(J=>{Oe[J]=L[J],le=[...le,...L[J]]})}),ft.forEach(L=>{Object.keys(L).forEach(J=>{_e[J]=L[J],G=[...G,...L[J]]})}),b.forEach(L=>{const J=Oe[L.id]||[],We=_e[L.id]||[],vt=_s(J,We);Z[L.id]={user:L,deposits:J,loans:We,...vt}});const we=Xe(le,G,o);F({labels:we.map(L=>L.month),datasets:[{label:"Deposits",data:we.map(L=>L.deposits),borderColor:"rgb(75, 192, 192)",backgroundColor:"rgba(75, 192, 192, 0.5)"},{label:"Loans",data:we.map(L=>L.loans),borderColor:"rgb(255, 99, 132)",backgroundColor:"rgba(255, 99, 132, 0.5)"}]});const Ye=Ze(o-1),Be=Qe(o-1),yt=V.map(L=>T(L,Ye,Be)),jt=V.map(L=>Y(L,Ye,Be)),bt=await Promise.all(yt),wt=await Promise.all(jt);let Ne=[],ve=[];bt.forEach(L=>{Object.keys(L).forEach(J=>{Ne=[...Ne,...L[J]]})}),wt.forEach(L=>{Object.keys(L).forEach(J=>{ve=[...ve,...L[J]]})});const Nt=Xe(Ne,ve,o-1);z({currentYear:{totalDeposits:le.reduce((L,J)=>L+J.amount,0),totalLoans:G.reduce((L,J)=>L+J.amount,0),monthlyData:we},previousYear:{totalDeposits:Ne.reduce((L,J)=>L+J.amount,0),totalLoans:ve.reduce((L,J)=>L+J.amount,0),monthlyData:Nt}}),D(Z),U(!1)}catch(b){console.error("Error fetching user reports:",b),q("Failed to fetch reports data"),U(!1)}},[o,u]),ee=(0,t.useCallback)(b=>{A(b),M(!0)},[]),oe=(0,t.useCallback)(()=>{M(!1),A(null)},[]),ht=(0,t.useCallback)(()=>{const b=Object.values(k);Bs(b,`annual-reports-${o}.csv`)},[k,o]),gt=(0,t.useCallback)(()=>{const b=Object.values(k),Z=Os(b,o);Z.success?console.log(`PDF "${Z.filename}" generated successfully!`):console.error("Failed to generate PDF:",Z.error)},[k,o]);(0,t.useEffect)(()=>{_()},[_]);const pt=()=>{const b=[];for(let Z=a;Z>=2022;Z--)b.push(Z);return b};return(0,e.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,e.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Annual Reports"}),(H.deposits||H.loans)&&(0,e.jsx)("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6",children:(0,e.jsxs)("div",{className:"flex",children:[(0,e.jsx)("div",{className:"flex-shrink-0",children:(0,e.jsx)("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,e.jsx)("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),(0,e.jsxs)("div",{className:"ml-3",children:[(0,e.jsx)("p",{className:"text-sm text-yellow-700",children:"Some queries require Firestore indexes for optimal performance. We're using fallback queries, but you can create the indexes for better performance:"}),(0,e.jsxs)("div",{className:"mt-2",children:[H.deposits&&(0,e.jsx)("a",{href:"https://console.firebase.google.com/v1/r/project/ecommerce-74229/firestore/indexes?create_composite=ClBwcm9qZWN0cy9lY29tbWVyY2UtNzQyMjkvZGF0YWJhc2VzLyhkZWZhdWx0KS9jb2xsZWN0aW9uR3JvdXBzL2RlcG9zaXRzL2luZGV4ZXMvXxABGgoKBnVzZXJJZBABGg0KCXRpbWVzdGFtcBACGgwKCF9fbmFtZV9fEAI",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline hover:text-blue-800 mr-4",children:"Create Deposits Index"}),H.loans&&(0,e.jsx)("a",{href:"https://console.firebase.google.com/v1/r/project/ecommerce-74229/firestore/indexes?create_composite=Ck1wcm9qZWN0cy9lY29tbWVyY2UtNzQyMjkvZGF0YWJhc2VzLyhkZWZhdWx0KS9jb2xsZWN0aW9uR3JvdXBzL2xvYW5zL2luZGV4ZXMvXxABGgoKBnVzZXJJZBABGg0KCXRpbWVzdGFtcBACGgwKCF9fbmFtZV9fEAI",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline hover:text-blue-800",children:"Create Loans Index"})]})]})]})}),(0,e.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{htmlFor:"year",className:"block text-sm font-medium text-gray-700 mb-1",children:"Year"}),(0,e.jsx)("select",{id:"year",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",value:o,onChange:b=>n(parseInt(b.target.value)),children:pt().map(b=>(0,e.jsx)("option",{value:b,children:b},b))})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{htmlFor:"month",className:"block text-sm font-medium text-gray-700 mb-1",children:"Month (Optional)"}),(0,e.jsxs)("select",{id:"month",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",value:u,onChange:b=>f(b.target.value),children:[(0,e.jsx)("option",{value:"all",children:"All Months"}),(0,e.jsx)("option",{value:"1",children:"January"}),(0,e.jsx)("option",{value:"2",children:"February"}),(0,e.jsx)("option",{value:"3",children:"March"}),(0,e.jsx)("option",{value:"4",children:"April"}),(0,e.jsx)("option",{value:"5",children:"May"}),(0,e.jsx)("option",{value:"6",children:"June"}),(0,e.jsx)("option",{value:"7",children:"July"}),(0,e.jsx)("option",{value:"8",children:"August"}),(0,e.jsx)("option",{value:"9",children:"September"}),(0,e.jsx)("option",{value:"10",children:"October"}),(0,e.jsx)("option",{value:"11",children:"November"}),(0,e.jsx)("option",{value:"12",children:"December"})]})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{htmlFor:"search",className:"block text-sm font-medium text-gray-700 mb-1",children:"Search User"}),(0,e.jsx)("input",{type:"text",id:"search",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Name, email, or phone",value:m,onChange:b=>w(b.target.value)})]}),(0,e.jsx)("div",{className:"flex items-end",children:(0,e.jsx)("button",{className:"w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",onClick:_,children:"Apply Filters"})})]}),(0,e.jsxs)("div",{className:"flex flex-wrap gap-4 items-center",children:[(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("input",{id:"showUnpaid",type:"checkbox",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded",checked:p,onChange:b=>y(b.target.checked)}),(0,e.jsx)("label",{htmlFor:"showUnpaid",className:"ml-2 block text-sm text-gray-700",children:"Show only users with unpaid loans"})]}),(0,e.jsx)("button",{className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2",onClick:ht,children:"Export CSV"}),(0,e.jsx)("button",{className:"bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2",onClick:gt,children:"Export PDF"})]})]}),i&&(0,e.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,e.jsx)("h2",{className:"text-lg font-medium text-gray-800 mb-4",children:"Year Comparison"}),(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"text-md font-medium text-gray-700 mb-2",children:"Total Deposits"}),(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsxs)("div",{className:"text-2xl font-bold text-green-600",children:["$",i.currentYear.totalDeposits.toFixed(2)]}),(0,e.jsxs)("div",{className:"ml-4 text-sm text-gray-500",children:[i.currentYear.totalDeposits>i.previousYear.totalDeposits?(0,e.jsxs)("span",{className:"text-green-600",children:["â†‘ ",((i.currentYear.totalDeposits-i.previousYear.totalDeposits)/i.previousYear.totalDeposits*100).toFixed(1),"%"]}):(0,e.jsxs)("span",{className:"text-red-600",children:["â†“ ",((i.previousYear.totalDeposits-i.currentYear.totalDeposits)/i.previousYear.totalDeposits*100).toFixed(1),"%"]}),(0,e.jsxs)("span",{children:[" vs ",o-1]})]})]})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"text-md font-medium text-gray-700 mb-2",children:"Total Loans"}),(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsxs)("div",{className:"text-2xl font-bold text-blue-600",children:["$",i.currentYear.totalLoans.toFixed(2)]}),(0,e.jsxs)("div",{className:"ml-4 text-sm text-gray-500",children:[i.currentYear.totalLoans>i.previousYear.totalLoans?(0,e.jsxs)("span",{className:"text-green-600",children:["â†‘ ",((i.currentYear.totalLoans-i.previousYear.totalLoans)/i.previousYear.totalLoans*100).toFixed(1),"%"]}):(0,e.jsxs)("span",{className:"text-red-600",children:["â†“ ",((i.previousYear.totalLoans-i.currentYear.totalLoans)/i.previousYear.totalLoans*100).toFixed(1),"%"]}),(0,e.jsxs)("span",{children:[" vs ",o-1]})]})]})]})]})]}),I&&(0,e.jsxs)("div",{className:"bg-white shadow rounded-lg p-6 mb-6",children:[(0,e.jsx)("h2",{className:"text-lg font-medium text-gray-800 mb-4",children:"Deposits vs Loans by Month"}),(0,e.jsx)("div",{className:"h-64",children:(0,e.jsx)(Kt,{data:I,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},title:{display:!1}}}})})]}),(0,e.jsxs)("div",{className:"bg-white shadow rounded-lg overflow-hidden",children:[(0,e.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,e.jsx)("h2",{className:"text-lg font-medium text-gray-800",children:"Users Summary"})}),B?(0,e.jsx)("div",{className:"px-6 py-4 text-center",children:(0,e.jsx)("p",{className:"text-gray-500",children:"Loading reports..."})}):W?(0,e.jsx)("div",{className:"px-6 py-4 text-center",children:(0,e.jsx)("p",{className:"text-red-500",children:W})}):s.length===0?(0,e.jsx)("div",{className:"px-6 py-4 text-center",children:(0,e.jsx)("p",{className:"text-gray-500",children:"No users found"})}):(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Deposits"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Loans"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Paid Loans"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Unpaid Loans"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Action"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:$.map(b=>(0,e.jsxs)("tr",{className:b.unpaidLoansCount>0?"border-l-4 border-red-500":"",children:[(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("div",{className:"flex-shrink-0 h-10 w-10",children:(0,e.jsx)("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:(0,e.jsx)("span",{className:"text-gray-600 font-medium",children:b.user.name?b.user.name.charAt(0).toUpperCase():"U"})})}),(0,e.jsxs)("div",{className:"ml-4",children:[(0,e.jsx)("div",{className:"text-sm font-medium text-gray-900",children:b.user.name||"Unknown User"}),(0,e.jsx)("div",{className:"text-sm text-gray-500",children:b.user.email||"N/A"})]})]})}),(0,e.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["$",b.totalDeposits.toFixed(2)]}),(0,e.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["$",b.totalLoans.toFixed(2)]}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:b.paidLoansCount}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${b.unpaidLoansCount>0?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:b.unpaidLoansCount})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,e.jsx)("button",{onClick:()=>ee(b.user.id),className:"text-blue-600 hover:text-blue-900",children:"viewDetails"})})]},b.user.id))})]})}),r>1&&(0,e.jsxs)("div",{className:"px-6 py-3 flex items-center justify-between border-t border-gray-200",children:[(0,e.jsxs)("div",{className:"flex-1 flex justify-between sm:hidden",children:[(0,e.jsx)("button",{onClick:()=>j(b=>Math.max(b-1,1)),disabled:g===1,className:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Previous"}),(0,e.jsx)("button",{onClick:()=>j(b=>Math.min(b+1,r)),disabled:g===r,className:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Next"})]}),(0,e.jsxs)("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[(0,e.jsx)("div",{children:(0,e.jsxs)("p",{className:"text-sm text-gray-700",children:["Showing ",(0,e.jsx)("span",{className:"font-medium",children:S+1})," to"," ",(0,e.jsx)("span",{className:"font-medium",children:Math.min(P,s.length)})," of"," ",(0,e.jsx)("span",{className:"font-medium",children:s.length})," results"]})}),(0,e.jsx)("div",{children:(0,e.jsxs)("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination",children:[(0,e.jsx)("button",{onClick:()=>j(b=>Math.max(b-1,1)),disabled:g===1,className:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50",children:"Previous"}),Array.from({length:r},(b,Z)=>Z+1).map(b=>(0,e.jsx)("button",{onClick:()=>j(b),className:`relative inline-flex items-center px-4 py-2 border text-sm font-medium ${g===b?"z-10 bg-blue-50 border-blue-500 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50"}`,children:b},b)),(0,e.jsx)("button",{onClick:()=>j(b=>Math.min(b+1,r)),disabled:g===r,className:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50",children:"Next"})]})})]})]})]})]}),v&&(0,e.jsx)(Vs,{isOpen:R,onClose:oe,user:k[v].user,deposits:k[v].deposits,loans:k[v].loans})]})},Gs=Ks,Hs=({onAccessGranted:a})=>{const[o,n]=(0,t.useState)(""),[u,f]=(0,t.useState)(!1),[m,w]=(0,t.useState)(""),[p,y]=(0,t.useState)(""),[c,h]=(0,t.useState)(!1),[k,D]=(0,t.useState)(""),[v,A]=(0,t.useState)(""),[R,M]=(0,t.useState)(""),[x,F]=(0,t.useState)(!1),[C,z]=(0,t.useState)(!1),[B,U]=(0,t.useState)(!1),W="Communitysavings4@gmail.com";(0,t.useEffect)(()=>{if(v){z(!0);const N=setTimeout(()=>{z(!1),setTimeout(()=>A(""),500)},3e3);return()=>clearTimeout(N)}},[v]),(0,t.useEffect)(()=>{if(R){U(!0);const N=setTimeout(()=>{U(!1),setTimeout(()=>{M(""),c&&h(!1)},500)},3e3);return()=>clearTimeout(N)}},[R,c]);const q=async N=>{N.preventDefault(),F(!0);try{const d=te(E,"adminSettings","security"),s=await Se(d);if(s.exists()){const{password:r}=s.data();o===r?a():A("Incorrect password. Please try again.")}else A("Admin settings not found. Please contact support.")}catch(d){console.error("Error fetching admin password:",d),A("Failed to verify password. Please try again.")}finally{F(!1)}},H=async N=>{N.preventDefault(),F(!0);try{const d=cs(),s=new Date;s.setMinutes(s.getMinutes()+15),await rt(te(E,"passwordResets",d),{token:d,expiresAt:s,used:!1});const r=`${window.location.origin}/admin-login?reset=true&token=${d}`;await xs.send("service_rbtk5y8","template_i85brpa",{to_email:W,reset_link:r},"zcAI9wNXtOd3ooJ67"),M("Password reset email sent! Check your inbox."),setTimeout(()=>{f(!1)},3e3)}catch(d){console.error("Error sending password reset email:",d),A("Failed to send reset email. Please try again.")}finally{F(!1)}},l=async N=>{if(N.preventDefault(),m!==p){A("Passwords do not match.");return}if(m.length<6){A("Password must be at least 6 characters long.");return}F(!0);try{const d=te(E,"adminSettings","security");await de(d,{password:m});const s=te(E,"passwordResets",k);await de(s,{used:!0}),M("Password updated successfully!"),w(""),y(""),setTimeout(()=>{window.location.href="/admin-login"},3e3)}catch(d){console.error("Error updating password:",d),A("Failed to update password. Please try again.")}finally{F(!1)}};return(0,t.useEffect)(()=>{const N=new URLSearchParams(window.location.search),d=N.get("reset"),s=N.get("token");d==="true"&&s&&(async()=>{try{const S=te(E,"passwordResets",s),P=await Se(S);if(!P.exists()){A("Invalid or expired reset link.");return}const $=P.data();if($.used||new Date>$.expiresAt.toDate()){A("This reset link has expired.");return}h(!0),D(s)}catch(S){console.error("Error verifying reset token:",S),A("Failed to verify reset link.")}})()},[]),c?(0,e.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,e.jsxs)("div",{className:"bg-white shadow-lg rounded-2xl p-8 w-96 max-w-md",children:[(0,e.jsx)("h2",{className:"text-2xl font-bold text-center mb-6 text-gray-800",children:"Reset Admin Password"}),(0,e.jsxs)("form",{onSubmit:l,children:[(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"New Password"}),(0,e.jsx)("input",{type:"password",id:"newPassword",value:m,onChange:N=>w(N.target.value),className:"border border-gray-300 rounded-md p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-full transition-colors",required:!0})]}),(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm New Password"}),(0,e.jsx)("input",{type:"password",id:"confirmPassword",value:p,onChange:N=>y(N.target.value),className:"border border-gray-300 rounded-md p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-full transition-colors",required:!0})]}),(0,e.jsx)("button",{type:"submit",disabled:x,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md w-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Updating...":"Reset Password"})]}),(0,e.jsx)("div",{className:"mt-4 text-center",children:(0,e.jsx)("button",{onClick:()=>h(!1),className:"text-blue-600 text-sm hover:underline",children:"Back to login"})}),v&&(0,e.jsx)("div",{className:`text-red-500 mt-4 transition-opacity duration-500 ${C?"opacity-100":"opacity-0"}`,children:v}),R&&(0,e.jsx)("div",{className:`text-green-500 mt-4 transition-opacity duration-500 ${B?"opacity-100":"opacity-0"}`,children:R})]})}):(0,e.jsxs)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:[(0,e.jsxs)("div",{className:"bg-white shadow-lg rounded-2xl p-8 w-96 max-w-md",children:[(0,e.jsx)("h2",{className:"text-2xl font-bold text-center mb-6 text-gray-800",children:"Admin Access"}),(0,e.jsxs)("form",{onSubmit:q,children:[(0,e.jsxs)("div",{className:"mb-4",children:[(0,e.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,e.jsx)("input",{type:"password",id:"password",value:o,onChange:N=>n(N.target.value),className:"border border-gray-300 rounded-md p-3 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 w-full transition-colors",required:!0})]}),(0,e.jsx)("button",{type:"submit",disabled:x,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md w-full mt-4 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Verifying...":"Access Admin Dashboard"})]}),v&&(0,e.jsx)("div",{className:`text-red-500 mt-2 transition-opacity duration-500 ${C?"opacity-100":"opacity-0"}`,children:v}),R&&(0,e.jsx)("div",{className:`text-green-500 mt-2 transition-opacity duration-500 ${B?"opacity-100":"opacity-0"}`,children:R}),(0,e.jsx)("div",{className:"text-blue-600 text-sm mt-3 hover:underline cursor-pointer text-center",onClick:()=>f(!0),children:"Forgot password?"})]}),u&&(0,e.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:(0,e.jsxs)("div",{className:"bg-white shadow-lg rounded-2xl p-8 w-96 max-w-md",children:[(0,e.jsx)("h2",{className:"text-xl font-bold text-center mb-4 text-gray-800",children:"Reset Password"}),(0,e.jsx)("p",{className:"text-gray-600 text-sm mb-6",children:"A reset link will be sent to the admin email."}),(0,e.jsx)("div",{className:"mb-6 p-3 bg-gray-100 rounded-md",children:(0,e.jsxs)("p",{className:"text-sm text-gray-700",children:[(0,e.jsx)("span",{className:"font-medium",children:"Email:"})," ",W]})}),(0,e.jsx)("form",{onSubmit:H,children:(0,e.jsxs)("div",{className:"flex space-x-3",children:[(0,e.jsx)("button",{type:"button",onClick:()=>f(!1),className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded-md w-1/2 transition-colors",children:"Cancel"}),(0,e.jsx)("button",{type:"submit",disabled:x,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md w-1/2 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Sending...":"Send Reset Link"})]})}),v&&(0,e.jsx)("div",{className:`text-red-500 mt-4 transition-opacity duration-500 ${C?"opacity-100":"opacity-0"}`,children:v}),R&&(0,e.jsx)("div",{className:`text-green-500 mt-4 transition-opacity duration-500 ${B?"opacity-100":"opacity-0"}`,children:R})]})})]})},Zs=Hs,Qs=()=>{const a=be(),o=()=>{a("/")};return(0,e.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:(0,e.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-8 max-w-md w-full text-center",children:[(0,e.jsx)("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-red-100",children:(0,e.jsx)(es,{className:"h-10 w-10 text-red-600"})}),(0,e.jsx)("h2",{className:"mt-4 text-2xl font-bold text-gray-900",children:"Account Blocked"}),(0,e.jsx)("p",{className:"mt-2 text-gray-600",children:"Your account has been blocked. Contact support if this is a mistake."}),(0,e.jsx)("button",{onClick:o,className:"mt-6 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200",children:"Back to Home"})]})})},Js=Qs,Xs=()=>{const[a,o]=(0,t.useState)([]),[n,u]=(0,t.useState)(!0),[f,m]=(0,t.useState)(null);(0,t.useEffect)(()=>{const y=ae(X(E,"users")),c=ie(y,h=>{try{const k=h.docs.map(D=>({id:D.id,...D.data()})).sort((D,v)=>D.createdAt&&v.createdAt?v.createdAt.toMillis()-D.createdAt.toMillis():D.createdAt?-1:v.createdAt?1:0);o(k),u(!1)}catch(k){console.error("Error processing users snapshot:",k),m("Failed to process users data"),u(!1)}},h=>{console.error("Error fetching users:",h),m("Failed to fetch users"),u(!1)});return()=>c()},[]);const w=async(y,c)=>{try{const h=te(E,"users",y);await de(h,{isBlocked:!c})}catch(h){console.error("Error updating user block status:",h),m("Failed to update user status")}},p=y=>{if(!y)return"N/A";try{return y.toDate().toLocaleDateString()}catch{return"Invalid Date"}};return n?(0,e.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,e.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading users..."})]})}):f?(0,e.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,e.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 max-w-md w-full text-center",children:[(0,e.jsx)("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-red-100",children:(0,e.jsx)(Ke,{className:"h-10 w-10 text-red-600"})}),(0,e.jsx)("h3",{className:"mt-4 text-lg font-medium text-gray-900",children:"Error Loading Users"}),(0,e.jsx)("p",{className:"mt-2 text-gray-600",children:f})]})}):(0,e.jsxs)("div",{className:"p-4 md:p-6",children:[(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"User Management"}),(0,e.jsx)("p",{className:"mt-1 text-gray-600",children:"Manage user accounts and block/unblock users"})]}),(0,e.jsx)("div",{className:"bg-white rounded-xl shadow-md overflow-hidden",children:(0,e.jsxs)("div",{className:"overflow-x-auto",children:[(0,e.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,e.jsx)("thead",{className:"bg-gray-50",children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Join Date"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,e.jsx)("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,e.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:a.map(y=>(0,e.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-indigo-100 flex items-center justify-center",children:(0,e.jsx)("span",{className:"text-indigo-800 font-medium",children:y.name?.charAt(0)?.toUpperCase()||"U"})}),(0,e.jsx)("div",{className:"ml-4",children:(0,e.jsx)("div",{className:"text-sm font-medium text-gray-900",children:y.name||"N/A"})})]})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsx)("div",{className:"text-sm text-gray-900",children:y.email||"N/A"})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsxs)("div",{className:"flex items-center text-sm text-gray-500",children:[(0,e.jsx)(ds,{className:"flex-shrink-0 mr-1.5 h-4 w-4 text-gray-400"}),p(y.createdAt)]})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,e.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${y.isBlocked?"bg-red-100 text-red-700":"bg-green-100 text-green-700"}`,children:y.isBlocked?"Blocked":"Active"})}),(0,e.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,e.jsx)("button",{onClick:()=>w(y.id,y.isBlocked),className:`px-3 py-1 rounded-lg text-sm font-medium transition-colors duration-200 ${y.isBlocked?"bg-green-600 hover:bg-green-700 text-white":"bg-red-600 hover:bg-red-700 text-white"}`,children:y.isBlocked?"Unblock":"Block"})})]},y.id))})]}),a.length===0&&(0,e.jsxs)("div",{className:"text-center py-12",children:[(0,e.jsx)(Ke,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,e.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No users found"}),(0,e.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"There are no users in the system yet."})]})]})})]})},ea=Xs;const ta=async()=>{try{const a=ge.currentUser;if(!a)return!1;const o=te(E,"users",a.uid),n=await Se(o);return n.exists()?n.data().isBlocked===!0:!1}catch(a){return console.error("Error checking user block status:",a),!1}},sa=async a=>{try{await Re(ge),a&&a("/blocked")}catch(o){console.error("Error signing out blocked user:",o)}},aa=async a=>{const o=await ta();return o&&await sa(a),o};var ra=({children:a})=>{const o=be(),{currentUser:n}=ue();return(0,t.useEffect)(()=>{const u=async()=>{if(n)try{await aa(o)}catch(m){console.error("Error checking user block status:",m)}};u();const f=setInterval(u,6e4);return()=>clearInterval(f)},[n,o]),(0,e.jsx)(e.Fragment,{children:a})},na=ra;function ia({children:a}){const{currentUser:o}=ue();return o?a:(0,e.jsx)(at,{to:"/login"})}function tt({children:a}){const{currentUser:o}=ue();return o?(0,e.jsx)(at,{to:"/dashboard"}):a}function la(){const[a,o]=(0,t.useState)(!1);return a?(0,e.jsxs)(At,{children:[(0,e.jsx)(ne,{path:"/login",element:(0,e.jsx)(tt,{children:(0,e.jsx)(js,{})})}),(0,e.jsx)(ne,{path:"/signup",element:(0,e.jsx)(tt,{children:(0,e.jsx)(bs,{})})}),(0,e.jsx)(ne,{path:"/blocked",element:(0,e.jsx)(Js,{})}),(0,e.jsxs)(ne,{path:"/",element:(0,e.jsx)(ia,{children:(0,e.jsx)(na,{children:(0,e.jsx)(Ps,{})})}),children:[(0,e.jsx)(ne,{index:!0,element:(0,e.jsx)(He,{})}),(0,e.jsx)(ne,{path:"profile",element:(0,e.jsx)(Ns,{})}),(0,e.jsx)(ne,{path:"dashboard",element:(0,e.jsx)(He,{})}),(0,e.jsx)(ne,{path:"deposits",element:(0,e.jsx)(Cs,{})}),(0,e.jsx)(ne,{path:"loans",element:(0,e.jsx)(Ts,{})}),(0,e.jsx)(ne,{path:"payback",element:(0,e.jsx)(Ds,{})}),(0,e.jsx)(ne,{path:"users",element:(0,e.jsx)(Rs,{})}),(0,e.jsx)(ne,{path:"admin-users",element:(0,e.jsx)(ea,{})}),(0,e.jsx)(ne,{path:"settings",element:(0,e.jsx)($s,{})}),(0,e.jsx)(ne,{path:"chat",element:(0,e.jsx)(Us,{})}),(0,e.jsx)(ne,{path:"annual-reports",element:(0,e.jsx)(Gs,{})})]})]}):(0,e.jsx)(Zs,{onAccessGranted:()=>o(!0)})}var oa=la;(0,fs.createRoot)(document.getElementById("root")).render((0,e.jsx)(t.StrictMode,{children:(0,e.jsx)(ys,{children:(0,e.jsx)(Ut,{children:(0,e.jsx)(oa,{})})})}));
